#!/usr/bin/bash
#RHEL7 required! 
cd /home/mgreen/mscloudserver
 
#register rhsm
#subscription-manager register 
#subscription-manager auto-attach
 
#enable redhat yum repos
subscription-manager repos --enable=rhel-7-server-rpms 
subscription-manager repos --enable=rhel-7-server-extras-rpms
subscription-manager repos --enable=rhel-7-server-optional-rpms 
subscription-manager repos --enable=rhel-server-rhscl-7-rpms

# install ntp
yum -y install ntp
# sync date/time otherwise AWS auth will fail
ntpdate pool.ntp.org
 
#install required packages
yum -y install net-tools yum-langpacks gtk3 python27-python-pip ksh wget firewalld tigervnc-server-minimal mailx
#yum -y localinstall $ROOTDIR/bin/websocketd.0.3.0.x86_64.rpm
#something weird next. if i leave the scl command in, the script wont progress past the scl command. no clue.
#scl enable python27 bash 2>&1
pip install --upgrade pip 2>&1

#install docker
yum -y install docker device-mapper-libs device-mapper-event-libs
#add redhat container registry
echo "ADD_REGISTRY='--add-registry registry.access.redhat.com'">>/etc/sysconfig/docker
systemctl start docker
systemctl enable docker

#createcontainer.sh reqs
yum -y install lorax
yum -y install anaconda-tui

#install amazon command line interface
pip install awscli

# add custom scripts to /usr/local/bin
find . -name "*monthname.sh" -exec cp -f {} /usr/local/bin/. \;
find . -name "*recon.sh" -exec cp -f {} /usr/local/bin/. \;

# install web server for php menu
yum -y install httpd php
systemctl enable httpd
systemctl start httpd

# lastly, update everything
yum -y update
