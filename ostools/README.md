<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@osx327.sd.apple.com" />
</head>

<body style="background-color: white">



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#VERSION">VERSION</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#OPTIONS">OPTIONS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#EXAMPLES">EXAMPLES</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#FILES">FILES</a></li>
  <li><a href="#EXIT-STATUS">EXIT STATUS</a></li>
  <li><a href="#SEE-ALSO">SEE ALSO</a></li>
  <li><a href="#NAME1">NAME</a></li>
  <li><a href="#VERSION1">VERSION</a></li>
  <li><a href="#USAGE">USAGE</a></li>
  <li><a href="#OPTIONS1">OPTIONS</a></li>
  <li><a href="#DESCRIPTION1">DESCRIPTION</a></li>
  <li><a href="#FILES1">FILES</a></li>
  <li><a href="#DIAGNOSTICS">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO1">SEE ALSO</a></li>
  <li><a href="#NAME2">NAME</a></li>
  <li><a href="#VERSION2">VERSION</a></li>
  <li><a href="#USAGE1">USAGE</a></li>
  <li><a href="#OPTIONS2">OPTIONS</a></li>
  <li><a href="#DESCRIPTION2">DESCRIPTION</a></li>
  <li><a href="#FILES2">FILES</a></li>
  <li><a href="#DIAGNOSTICS1">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO2">SEE ALSO</a></li>
  <li><a href="#NAME3">NAME</a></li>
  <li><a href="#VERSION3">VERSION</a></li>
  <li><a href="#USAGE2">USAGE</a></li>
  <li><a href="#OPTIONS3">OPTIONS</a></li>
  <li><a href="#DESCRIPTION3">DESCRIPTION</a>
    <ul>
      <li><a href="#CONFIG-FILE">CONFIG FILE</a></li>
      <li><a href="#COMMAND-LINE-OPTIONS">COMMAND LINE OPTIONS</a></li>
    </ul>
  </li>
  <li><a href="#FILES3">FILES</a></li>
  <li><a href="#DIAGNOSTICS2">DIAGNOSTICS</a></li>
  <li><a href="#BUGS">BUGS</a></li>
  <li><a href="#SEE-ALSO3">SEE ALSO</a></li>
  <li><a href="#NAME4">NAME</a></li>
  <li><a href="#VERSION4">VERSION</a></li>
  <li><a href="#USAGE3">USAGE</a></li>
  <li><a href="#OPTIONS4">OPTIONS</a></li>
  <li><a href="#DESCRIPTION4">DESCRIPTION</a>
    <ul>
      <li><a href="#COMMAND-LINE-OPTIONS1">COMMAND LINE OPTIONS</a></li>
    </ul>
  </li>
  <li><a href="#FILES4">FILES</a></li>
  <li><a href="#DIAGNOSTICS3">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO4">SEE ALSO</a></li>
  <li><a href="#NAME5">NAME</a></li>
  <li><a href="#VERSION5">VERSION</a></li>
  <li><a href="#OPTIONS5">OPTIONS</a></li>
  <li><a href="#DESCRIPTION5">DESCRIPTION</a>
    <ul>
      <li><a href="#Command-Line-Options">Command Line Options</a></li>
      <li><a href="#Definition-of-Installed-and-Enabled">Definition of Installed and Enabled</a></li>
      <li><a href="#Daisy-Logevents">Daisy Logevents</a></li>
      <li><a href="#Sending-Email">Sending Email</a></li>
    </ul>
  </li>
  <li><a href="#EXAMPLES1">EXAMPLES</a></li>
  <li><a href="#FILES5">FILES</a></li>
  <li><a href="#DIAGNOSTICS4">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO5">SEE ALSO</a></li>
  <li><a href="#NAME6">NAME</a></li>
  <li><a href="#VERSION6">VERSION</a></li>
  <li><a href="#USAGE4">USAGE</a></li>
  <li><a href="#OPTIONS6">OPTIONS</a></li>
  <li><a href="#DESCRIPTION6">DESCRIPTION</a></li>
  <li><a href="#FILES6">FILES</a></li>
  <li><a href="#DIAGNOSTICS5">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO6">SEE ALSO</a></li>
  <li><a href="#NAME7">NAME</a></li>
  <li><a href="#VERSION7">VERSION</a></li>
  <li><a href="#USAGE5">USAGE</a></li>
  <li><a href="#OPTIONS7">OPTIONS</a></li>
  <li><a href="#DESCRIPTION7">DESCRIPTION</a></li>
  <li><a href="#EXAMPLE">EXAMPLE</a></li>
  <li><a href="#FILES7">FILES</a></li>
  <li><a href="#DIAGNOSTICS6">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO7">SEE ALSO</a></li>
  <li><a href="#NAME8">NAME</a></li>
  <li><a href="#VERSION8">VERSION</a></li>
  <li><a href="#SYNOPSIS1">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION8">DESCRIPTION</a>
    <ul>
      <li><a href="#Overview">Overview</a></li>
      <li><a href="#Details">Details</a></li>
      <li><a href="#Command-Line-Options1">Command Line Options</a></li>
    </ul>
  </li>
  <li><a href="#EXAMPLES2">EXAMPLES</a></li>
  <li><a href="#FILES8">FILES</a></li>
  <li><a href="#EXIT-STATUS1">EXIT STATUS</a>
    <ul>
      <li><a href="#SEE-ALSO8">SEE ALSO</a></li>
    </ul>
  </li>
  <li><a href="#NAME9">NAME</a></li>
  <li><a href="#VERSION9">VERSION</a></li>
  <li><a href="#USAGE6">USAGE</a></li>
  <li><a href="#OPTIONS8">OPTIONS</a></li>
  <li><a href="#DESCRIPTION9">DESCRIPTION</a></li>
  <li><a href="#FILES9">FILES</a></li>
  <li><a href="#DIAGNOSTICS7">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO9">SEE ALSO</a></li>
  <li><a href="#NAME10">NAME</a></li>
  <li><a href="#VERSION10">VERSION</a></li>
  <li><a href="#USAGE7">USAGE</a></li>
  <li><a href="#OPTIONS9">OPTIONS</a></li>
  <li><a href="#DESCRIPTION10">DESCRIPTION</a></li>
  <li><a href="#FILES10">FILES</a></li>
  <li><a href="#DIAGNOSTICS8">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO10">SEE ALSO</a></li>
  <li><a href="#NAME11">NAME</a></li>
  <li><a href="#VERSION11">VERSION</a></li>
  <li><a href="#SYNOPSIS2">SYNOPSIS</a></li>
  <li><a href="#OPTIONS10">OPTIONS</a>
    <ul>
      <li><a href="#Commands">Commands</a></li>
      <li><a href="#Command-Modifiers">Command Modifiers</a></li>
    </ul>
  </li>
  <li><a href="#DESCRIPTION11">DESCRIPTION</a>
    <ul>
      <li><a href="#Installation">Installation</a></li>
      <li><a href="#Installation-on-the-Production-Server">Installation on the Production Server</a></li>
      <li><a href="#Installation-on-the-Backup-Server">Installation on the Backup Server</a></li>
      <li><a href="#Uninstall-on-the-Backup-Server">Uninstall on the Backup Server</a></li>
      <li><a href="#Backup-Retries">Backup Retries</a></li>
      <li><a href="#Sending-Email1">Sending Email</a></li>
      <li><a href="#Rsync-of-Summary-Log-File">Rsync of Summary Log File</a></li>
      <li><a href="#Config-File">Config File</a></li>
      <li><a href="#Backup-to-a-LUKS-Device">Backup to a LUKS Device</a></li>
      <li><a href="#Production-Server-Info-File">Production Server Info File</a></li>
      <li><a href="#Backup-Summary-Log-File">Backup Summary Log File</a></li>
    </ul>
  </li>
  <li><a href="#EXAMPLES3">EXAMPLES</a></li>
  <li><a href="#FILES11">FILES</a></li>
  <li><a href="#DIAGNOSTICS9">DIAGNOSTICS</a></li>
  <li><a href="#EXIT-STATUS2">EXIT STATUS</a></li>
  <li><a href="#SEE-ALSO11">SEE ALSO</a></li>
  <li><a href="#NAME12">NAME</a></li>
  <li><a href="#VERSION12">VERSION</a></li>
  <li><a href="#USAGE8">USAGE</a></li>
  <li><a href="#OPTIONS11">OPTIONS</a></li>
  <li><a href="#DESCRIPTION12">DESCRIPTION</a></li>
  <li><a href="#FILES12">FILES</a></li>
  <li><a href="#DIAGNOSTICS10">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO12">SEE ALSO</a></li>
  <li><a href="#NAME13">NAME</a></li>
  <li><a href="#VERSION13">VERSION</a></li>
  <li><a href="#USAGE9">USAGE</a></li>
  <li><a href="#OPTIONS12">OPTIONS</a></li>
  <li><a href="#DESCRIPTION13">DESCRIPTION</a>
    <ul>
      <li><a href="#COMMAND-LINE-OPTIONS2">COMMAND LINE OPTIONS</a></li>
      <li><a href="#Linux-Audit-System-Configuration">Linux Audit System Configuration</a></li>
    </ul>
  </li>
  <li><a href="#EXAMPLES4">EXAMPLES</a></li>
  <li><a href="#FILES13">FILES</a></li>
  <li><a href="#DIAGNOSTICS11">DIAGNOSTICS</a></li>
  <li><a href="#SEE-ALSO13">SEE ALSO</a></li>
  <li><a href="#POD-ERRORS">POD ERRORS</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>dsycheck.pl - Check a Daisy Installation</p>

<h1 id="VERSION">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.11 $</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>dsycheck.pl --help</p>

<p>dsycheck.pl --version</p>

<p>dsycheck.pl [option]</p>

<h1 id="OPTIONS">OPTIONS</h1>

<dl>

<dt id="help"><b>--help</b></dt>
<dd>

<p>Output a usage help message and exit.</p>

</dd>
<dt id="version"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="verbose"><b>--verbose</b></dt>
<dd>

<p>Write log messages to screen as well as to log file.</p>

</dd>
<dt id="logfile-dir-s"><b>--logfile-dir=s</b></dt>
<dd>

<p>Set the location of the log file rather than to the default <i>/d/daisy/log</i>.</p>

</dd>
<dt id="report-os-version"><b>--report-os-version</b></dt>
<dd>

<p>Output the string for the platform, either &quot;RHEL6&quot; or &quot;RHEL7&quot;.</p>

</dd>
<dt id="report-ostools-version"><b>--report-ostools-version</b></dt>
<dd>

<p>Output the version number of the OSTools package.</p>

</dd>
<dt id="report-hostname"><b>--report-hostname</b></dt>
<dd>

<p>Output the hostname of the system.</p>

</dd>
<dt id="report-ip-addr"><b>--report-ip-addr</b></dt>
<dd>

<p>Output the IP address of the network interface (default named &quot;eth0&quot;)</p>

</dd>
<dt id="report-public-ip-addr"><b>--report-public-ip-addr</b></dt>
<dd>

<p>Output the public IP address of the system as reported by &quot;icanhazip.com&quot;.</p>

</dd>
<dt id="report-gateway-ip-addr"><b>--report-gateway-ip-addr</b></dt>
<dd>

<p>Output the IP address of the gateway, usually the router.</p>

</dd>
<dt id="report-boot-protocol"><b>--report-boot-protocol</b></dt>
<dd>

<p>Output the type of boot protocol.</p>

</dd>
<dt id="report-disk-free"><b>--report-disk-free</b></dt>
<dd>

<p>Output the amount of available disk space on the &quot;/d&quot; file system.</p>

</dd>
<dt id="report-fstab-changes"><b>--report-fstab-changes</b></dt>
<dd>

<p>Verify that the changes to the file &quot;/etc/fstab&quot; have been made. The changes are different between &quot;RHEL6&quot; and &quot;RHEL7&quot;.</p>

</dd>
<dt id="report-mount-points"><b>--report-mount-points</b></dt>
<dd>

<p>Verify the existence of the mount points &quot;/mnt/cdrom&quot; and &quot;/mnt/usb&quot;.</p>

</dd>
<dt id="report-samba-conf"><b>--report-samba-conf</b></dt>
<dd>

<p>Verify the changes made to the Samba config file.</p>

</dd>
<dt id="report-samba-password"><b>--report-samba-password</b></dt>
<dd>

<p>Verify the &quot;daisy&quot; user has a Samba password.</p>

</dd>
<dt id="report-system-locale"><b>--report-system-locale</b></dt>
<dd>

<p>Verify the system locale has been set appropriately for &quot;RHEL6&quot; and &quot;RHEL7&quot;.</p>

</dd>
<dt id="report-system-audit-rules"><b>--report-system-audit-rules</b></dt>
<dd>

<p>Report whether system audit rules for Daisy have been configured.</p>

</dd>
<dt id="report-cloud-backup"><b>--report-cloud-backup</b></dt>
<dd>

<p>Report whether the system is configured for Cloud backup.</p>

</dd>
<dt id="report-server-backup"><b>--report-server-backup</b></dt>
<dd>

<p>Report whether the system is configured for Server to Server backup.</p>

</dd>
<dt id="report-virtual-console-count"><b>--report-virtual-console-count</b></dt>
<dd>

<p>Report the nunber of configured virtual consoles.</p>

</dd>
<dt id="report-virtual-console-files"><b>--report-virtual-console-files</b></dt>
<dd>

<p>Verify the existence of virtual console config files.</p>

</dd>
<dt id="report-virtual-console-perms"><b>--report-virtual-console-perms</b></dt>
<dd>

<p>Verify the perms and modes on the virtual console config files.</p>

</dd>
<dt id="report-tfsupport-user"><b>--report-tfsupport-user</b></dt>
<dd>

<p>Verify the existence of the &quot;tfsupport&quot; user.</p>

</dd>
<dt id="report-daisy-user"><b>--report-daisy-user</b></dt>
<dd>

<p>Verify the existence of the &quot;daisy&quot; user.</p>

</dd>
<dt id="report-daisy-version"><b>--report-daisy-version</b></dt>
<dd>

<p>Report the Daisy version number.</p>

</dd>
<dt id="report-shopcode"><b>--report-shopcode</b></dt>
<dd>

<p>Report the Teleflora shopcode.</p>

</dd>
<dt id="report-shopname"><b>--report-shopname</b></dt>
<dd>

<p>Report the Teleflora shop name.</p>

</dd>
<dt id="report-country-code"><b>--report-country-code</b></dt>
<dd>

<p>Report the country code.</p>

</dd>
<dt id="report-florist-directory-version"><b>--report-florist-directory-version</b></dt>
<dd>

<p>Report the version string for the installed florist directory package.</p>

</dd>
<dt id="report-tcc-version"><b>--report-tcc-version</b></dt>
<dd>

<p>Report the version number of TCC.</p>

</dd>
<dt id="report-card-url"><b>--report-card-url</b></dt>
<dd>

<p>Report the URL for the configured credit card processor.</p>

</dd>
<dt id="report-card-start-number"><b>--report-card-start-number</b></dt>
<dd>

<p>Report the allowed credit card start number from the Daisy control file.</p>

</dd>
<dt id="report-next-ticket-number"><b>--report-next-ticket-number</b></dt>
<dd>

<p>Report the next ticket number from the Daisy POS control file.</p>

</dd>
<dt id="report-large-file"><b>--report-large-file</b></dt>
<dd>

<p>Report files larger than 10MB in &#39;/d&#39;.</p>

</dd>
<dt id="report-encrypted-daisydir"><b>--report-encrypted-daisydir</b></dt>
<dd>

<p>Report the encrypted tar archive files of old Daisy dirs located in the top level of the Daisy file system. After an upgrade installation has been verfied as successful and has operated correctly for an appropriate amount of time, these files should be removed since they can consume significant disk space.</p>

</dd>
</dl>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>The <code>dsycheck.pl</code> script scans key elements of a Daisy installation on a Red Hat Enterprise Linux system and reports the values of many attributes. This information can be of major interest to Teleflora personnel installing, testing, and supporting Daisy systems.</p>

<h1 id="EXAMPLES">EXAMPLES</h1>

<p>To run <code>dsycheck.pl</code> and report all attributes:</p>

<pre><code>  $ sudo perl dsycheck.pl</code></pre>

<p>To run <code>dsycheck.pl</code> and report only specific attributes:</p>

<pre><code>  $ sudo perl dsycheck.pl --report-daisy-version --report-tcc-version</code></pre>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Script conceived, developed, debugged, and documented by George Smith of the Teleflora Linux Technologies Group. Any comments, suggestions, bug reports, or feedback welcome - call Daisy Support at 888-324-7963.</p>

<h1 id="FILES">FILES</h1>

<dl>

<dt id="home-tfsupport"><i>/home/tfsupport</i></dt>
<dd>

<p>The home directory of the Teleflora support account.</p>

</dd>
<dt id="home-daisy"><i>/home/daisy</i></dt>
<dd>

<p>The home directory of the quentessential Daisy account.</p>

</dd>
<dt id="d"><i>/d</i></dt>
<dd>

<p>Top level Daisy directory.</p>

</dd>
<dt id="d-daisy"><i>/d/daisy</i></dt>
<dd>

<p>The default Daisy database directory.</p>

</dd>
<dt id="d-daisy-YYYYMMDDHHSS.tar.asc"><i>/d/daisy-YYYYMMDDHHSS.tar.asc</i></dt>
<dd>

<p>After an upgrade install of Daisy, the previous <i>/d/daisy</i> will be left as an encrypted tar archive in <i>/d</i>. The name of the tar archive consists of &quot;daisy-&quot; followed by a date stamp followed by the suffix &quot;.tar.asc&quot;. The date stamp is of the form &quot;YYYMMDDHHSS&quot; where &quot;YYYY&quot; is the 4 digit year, &quot;MM&quot; is the month, &quot;DD&quot; is the day, &quot;HH&quot; is the hour, and &quot;SS&quot; is the seconds. For exmple, an upgrade install of Daisy on May 10th, 2017 at 8:22am, will have a file name of <i>/d/daisy-201705100822.tar.asc</i>.</p>

</dd>
<dt id="d-tfrsync"><i>d/tfrsync</i></dt>
<dd>

<p>The top level cloud or server-to-server backup directory; this directory will only exist if the cloud or server to server backup package is installed.</p>

</dd>
<dt id="d-daisy-log"><i>/d/daisy/log</i></dt>
<dd>

<p>On a Daisy system, the location of the log files. If this directory does not exist, the log file will be put in <i>/tmp</i>.</p>

</dd>
<dt id="d-daisy-control.dsy"><i>/d/daisy/control.dsy</i></dt>
<dd>

<p>The Daisy control file. This file contains amoung other items, the country code and the allowed credit card start number.</p>

</dd>
<dt id="d-daisy-posctrl.pos"><i>/d/daisy/posctrl.pos</i></dt>
<dd>

<p>The Daisy POS control file. This file contains amoung other items, the next ticket number.</p>

</dd>
<dt id="d-daisy-crdinet.pos"><i>/d/daisy/crdinet.pos</i></dt>
<dd>

<p>File which contains the credit card url.</p>

</dd>
<dt id="d-ostools"><i>/d/ostools</i></dt>
<dd>

<p>The OSTools directory on a Daisy system. This directory is created when the OSTools package is installed.</p>

</dd>
<dt id="d-ostools-config"><i>/d/ostools/config</i></dt>
<dd>

<p>The location of the OSTools config directory for a Daisy system.</p>

</dd>
<dt id="d-ostools-bin"><i>/d/ostools/bin</i></dt>
<dd>

<p>This directory contains the OSTools scripts.</p>

</dd>
<dt id="etc-redhat-release"><i>/etc/redhat-release</i></dt>
<dd>

<p>This system file contains the OS version string.</p>

</dd>
<dt id="etc-shells"><i>/etc/shells</i></dt>
<dd>

<p>This file has a list of all the allowed shells on the system; it must contain an entry for the Daisy shell.</p>

</dd>
<dt id="etc-cron.d-daisy-service"><i>/etc/cron.d/daisy-service</i></dt>
<dd>

<p>The Daisy cron job file.</p>

</dd>
<dt id="etc-sysconfig-init"><i>/etc/sysconfig/init</i></dt>
<dd>

<p>This system config file contains a value for the maximum number of allowed virtual consoles on a RHEL6 system.</p>

</dd>
<dt id="etc-sysconfig-i18n"><i>/etc/sysconfig/i18n</i></dt>
<dd>

<p>System locale config file for &quot;RHEL6&quot;.</p>

</dd>
<dt id="etc-audit-rules.d-daisy.rules"><i>/etc/audit/rules.d/daisy.rules</i></dt>
<dd>

<p>Config file for Daisy audit system configuration.</p>

</dd>
<dt id="etc-sysconfig-network-scripts-ifcfg-eth0"><i>/etc/sysconfig/network-scripts/ifcfg-eth0</i></dt>
<dd>

<p>Config file for network interface; contains setting for boot protocol.</p>

</dd>
<dt id="etc-fstab"><i>/etc/fstab</i></dt>
<dd>

<p>The file system table config file.</p>

</dd>
<dt id="etc-samba-smb.conf"><i>/etc/samba/smb.conf</i></dt>
<dd>

<p>The Samba config file.</p>

</dd>
</dl>

<h1 id="EXIT-STATUS">EXIT STATUS</h1>

<dl>

<dt id="Exit-status-0-EXIT_OK">Exit status 0 ($EXIT_OK)</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1-EXIT_COMMAND_LINE">Exit status 1 ($EXIT_COMMAND_LINE)</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
<dt id="Exit-status-2-EXIT_MUST_BE_ROOT">Exit status 2 ($EXIT_MUST_BE_ROOT)</dt>
<dd>

<p>The script must run as root or with sudo(1).</p>

</dd>
<dt id="Exit-status-3-EXIT_LOGFILE_SETUP">Exit status 3 ($EXIT_LOGFILE_SETUP)</dt>
<dd>

<p>A new empty log file could not be established.</p>

</dd>
<dt id="Exit-status-4-EXIT_PLATFORM">Exit status 4 ($EXIT_PLATFORM)</dt>
<dd>

<p>Either the operating system is unknown or it is not one of the supported platforms: &quot;RHEL6&quot; or &quot;RHEL7&quot;.</p>

</dd>
<dt id="Exit-status-5-EXIT_OSTOOLSDIR">Exit status 5 ($EXIT_OSTOOLSDIR)</dt>
<dd>

<p>The OSTools directory does not exist and thus OSTools must not be installed. OSTools 1.14.0 or better required.</p>

</dd>
<dt id="Exit-status-9-EXIT_OS_VERSION">Exit status 9 ($EXIT_OS_VERSION)</dt>
<dd>

<p>Could not get the OS version string.</p>

</dd>
<dt id="Exit-status-11-EXIT_DAISY_VERSION">Exit status 11 ($EXIT_DAISY_VERSION)</dt>
<dd>

<p>Could not get the Daisy version string.</p>

</dd>
<dt id="Exit-status-13-EXIT_OSTOOLS_VERSION">Exit status 13 ($EXIT_OSTOOLS_VERSION)</dt>
<dd>

<p>Could not get the OSTools version string.</p>

</dd>
<dt id="Exit-status-14-EXIT_SHOPCODE">Exit status 14 ($EXIT_SHOPCODE)</dt>
<dd>

<p>Could not get the Teleflora shop code.</p>

</dd>
<dt id="Exit-status-15-EXIT_COUNTRY_CODE">Exit status 15 ($EXIT_COUNTRY_CODE)</dt>
<dd>

<p>Could not get the Daisy country code.</p>

</dd>
<dt id="Exit-status-16-EXIT_FLORIST_DIRECTORY_VERSION">Exit status 16 ($EXIT_FLORIST_DIRECTORY_VERSION)</dt>
<dd>

<p>Could not get the Daisy florist directory version string.</p>

</dd>
<dt id="Exit-status-17-EXIT_TCC_VERSION">Exit status 17 ($EXIT_TCC_VERSION)</dt>
<dd>

<p>Could not get the TCC version string.</p>

</dd>
<dt id="Exit-status-18-EXIT_CARD_URL">Exit status 18 ($EXIT_CARD_URL)</dt>
<dd>

<p>Could not get the credit card url.</p>

</dd>
<dt id="Exit-status-19-EXIT_SHOPNAME">Exit status 19 ($EXIT_SHOPNAME)</dt>
<dd>

<p>Could not get the Teleflora shop name.</p>

</dd>
<dt id="Exit-status-20-EXIT_SAMBA_CONF">Exit status 20 ($EXIT_SAMBA_CONF)</dt>
<dd>

<p>Could not verify Samba config file.</p>

</dd>
<dt id="Exit-status-21-EXIT_SAMBA_PASSWORD">Exit status 21 ($EXIT_SAMBA_PASSWORD)</dt>
<dd>

<p>Could not verify Samba Daisy user</p>

</dd>
<dt id="Exit-status-22-EXIT_CARD_START_NUMBER">Exit status 22 ($EXIT_CARD_START_NUMBER)</dt>
<dd>

<p>Could not report credit card start number</p>

</dd>
<dt id="Exit-status-23-EXIT_NEXT_TICKET_NUMBER">Exit status 23 ($EXIT_NEXT_TICKET_NUMBER)</dt>
<dd>

<p>Could not report the next ticket number</p>

</dd>
<dt id="Exit-status-24-EXIT_LARGE_FILE">Exit status 24 ($EXIT_LARGE_FILE)</dt>
<dd>

<p>Could not read Daisy top level directory</p>

</dd>
<dt id="Exit-status-50-EXIT_HOSTNAME">Exit status 50 ($EXIT_HOSTNAME)</dt>
<dd>

<p>Could not get the system hostname.</p>

</dd>
<dt id="Exit-status-51-EXIT_IPADDR">Exit status 51 ($EXIT_IPADDR)</dt>
<dd>

<p>Could not determine the IP address of the default network interface.</p>

</dd>
<dt id="Exit-status-52-EXIT_GATEWAY_IPADDR">Exit status 52 ($EXIT_GATEWAY_IPADDR)</dt>
<dd>

<p>Could not determine the IP address of the gateway (router).</p>

</dd>
<dt id="Exit-status-55-EXIT_ACCOUNT_INFO">Exit status 55 ($EXIT_ACCOUNT_INFO)</dt>
<dd>

<p>There is no info for given account.</p>

</dd>
</dl>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<p>install-daisy.pl</p>

<p>#!/usr/bin/perl # # $Revision: 1.16 $ # Copyright 2009 Teleflora # # dsyperms.pl # # Setup file permissions in a Daisy tree. #</p>

<p>use strict; use warnings; use POSIX; use Getopt::Long; use English; use File::Basename; use File::Find;</p>

<p>my $CVS_REVISION = &#39;$Revision: 1.16 $&#39;; my $TIMESTAMP = strftime(&quot;%Y%m%d%H%M%S&quot;, localtime()); my $PROGNAME = basename($0);</p>

<p>my $DEFAULT_DSYDIR = &#39;/d/daisy&#39;; my $DSYROOT = &quot;/d&quot;; my $DSYDIR = &quot;&quot;; my $HELP = 0; my $VERSION = 0; my $INSTALL = 0; my $DRY_RUN = 0; my $TOOLSDIR = &quot;&quot;;</p>

<p>GetOptions( &quot;help&quot; =&gt; \$HELP, &quot;version&quot; =&gt; \$VERSION, &quot;install&quot; =&gt; \$INSTALL, &quot;dry-run&quot; =&gt; \$DRY_RUN, ) or exit(1);</p>

<p># --help if ($HELP) { usage(); exit(0); }</p>

<p># --version if ($VERSION) { print &quot;OSTools Version: 1.15.0\n&quot;; print &quot;$PROGNAME: $CVS_REVISION\n&quot;; exit(0); }</p>

<p># Where do &quot;OSTOOLS&quot; typically reside? if (-e &quot;/teleflora/ostools/bin&quot;) { $TOOLSDIR = &quot;/teleflora/ostools&quot;; } elsif (-e &quot;/usr2/ostools/bin&quot;) { $TOOLSDIR = &quot;/usr2/ostools&quot;; } elsif (-e &quot;/d/ostools/bin&quot;) { $TOOLSDIR = &quot;/d/ostools&quot;; } unless (-d &quot;$TOOLSDIR/bin&quot;) { logerror(&quot;required directory $TOOLSDIR/bin does not exist... can&#39;t continue&quot;); exit(1); }</p>

<p># --install if ($INSTALL != 0) { install_dsyperms(); exit(0); }</p>

<p># # If there is more than one command line argument, it&#39;s an error. # If there is one command line argument, use it as the path to the # daisy database directory. If there are no command line args, # then use the default value. # if (@ARGV &gt; 1) { usage(); exit(1); } elsif (@ARGV == 1) { $DSYDIR = $ARGV[0]; } else { $DSYDIR = $DEFAULT_DSYDIR; }</p>

<p># # Validate user input. # $DSYDIR = validate_input($DSYDIR); unless ($DSYDIR) { $DSYDIR = $DEFAULT_DSYDIR; }</p>

<p># make sure the daisy database dir is an absolute path unless (substr($DSYDIR, 0, 1) eq &#39;/&#39;) { print(&quot;$PROGNAME: the Daisy database dir must be an absolute path\n&quot;); usage(); exit(1); }</p>

<p># make sure the daisy database dir is a directory located in &quot;/d&quot; my $daisy_dir_name = basename($DSYDIR); unless (-d &quot;/d/$daisy_dir_name&quot;) { print(&quot;$PROGNAME: the Daisy database dir must be a dirctory located in \&quot;/d\&quot;\n&quot;); usage(); exit(1); }</p>

<p># make sure it&#39;s a daisy database directory unless (is_daisy_db_dir($DSYDIR)) { print(&quot;$PROGNAME: \&quot;$DSYDIR\&quot; is not a Daisy database directory\n&quot;); usage(); exit(1); }</p>

<p># Make sure we are running as the root user. if ($UID != 0) { print(&quot;$PROGNAME: sudo privileges are required for execution\n&quot;); exit(2); }</p>

<p># &quot;New PABP&quot; permission sets. if (assign_pabp_permissions($DSYROOT, $DSYDIR) != 0) { exit(1); }</p>

<p>exit(0);</p>

<p>################################################################### ################################################################### ###################################################################</p>

<p>sub usage { print(&quot;$PROGNAME $CVS_REVISION\n&quot;); print(&quot;\n&quot;); print(&quot;Usage:\n&quot;); print(&quot;$PROGNAME --help\n&quot;); print(&quot;$PROGNAME --version\n&quot;); print(&quot;$PROGNAME --install\n&quot;); print(&quot;$PROGNAME [daisy_dir]\n&quot;); print(&quot;\n&quot;); print(&quot;--version: Output version number and exit.\n&quot;); print(&quot;--help: Output this Help Text and exit.\n&quot;); print(&quot;--install: Install and exit.\n&quot;); print(&quot;--dry-run: Just report actions, don&#39;t perform them.\n&quot;); print(&quot;daisy_dir: path to a daisy database directory\n&quot;); print(&quot;no arguments: defaults to \&quot;/d/daisy\&quot;\n&quot;);</p>

<pre><code>        return(1);
}</code></pre>

<p># # PCI 6.3 # Develop software appliations in accordance with PCI DSS and # based on industry best practices, and incorporate information # security throughout the software development life cycle. # # PCI 6.3.1.1 # Validation of all input. # # Examples of how potentially dangerous input is converted: # # &quot;some string; `cat /etc/passwd`&quot; -&gt; &quot;some string cat /etc/passwd&quot; # &quot;`echo $ENV; $(sudo ls)`&quot; -&gt; &quot;echo ENV sudo ls&quot; # sub validate_input { my ($var) = @_;</p>

<pre><code>        my $temp = &quot;&quot;;

        if(! $var) {
                return &quot;&quot;;
        }

        $temp = $var;

        # &quot;`bad command`&quot; -&gt; &quot;bad command&quot;
        $temp =~ s/\`//g;

        # &quot;$(bad command)&quot; -&gt; &quot;bad command&quot;
        $temp =~ s/(\$\()(.*.)(\))/$2/g;


        # &quot;stuff ; bad command&quot; -&gt; &quot;stuff bad command&quot;
        $temp =~ s/\;//g;

        # &quot;stuff &amp;&amp; bad command&quot; -&gt; &quot;stuff bad command&quot;
        $temp =~ s/\&amp;//g;

        # &quot;stuff | bad command&quot; -&gt; &quot;stuff bad command&quot;
        $temp =~ s/\|//g;

        # &quot;stuff &gt; bad command&quot; -&gt; &quot;stuff bad command&quot;
        $temp =~ s/\&gt;//g;

        # &quot;stuff &lt; bad command&quot; -&gt; &quot;stuff bad command&quot;
        $temp =~ s/\&lt;//g;

        # Filter non printables
        $temp =~ s/[[:cntrl:]]//g;


        return($temp);
}</code></pre>

<p>sub install_dsyperms { logit(&quot;---- BEGIN Installation $PROGNAME $CVS_REVISION ----&quot;, &#39;I&#39;);</p>

<pre><code>        # If file exists and is the same, then it&#39;s already installed.
        my $already_installed = 0;
        if (-f &quot;$TOOLSDIR/bin/dsyperms.pl&quot;) {
                system(&quot;diff $0 $TOOLSDIR/bin&quot;);
                $already_installed = 1 if ($? == 0);
        }

        # If file is not already installed, then copy instance to bin directory.
        unless ($already_installed) {
                system(&quot;cp $0 $TOOLSDIR/bin/dsyperms.pl&quot;);
        }

        # Always set owner:group and modes.
        system(&quot;chown tfsupport:daisy $TOOLSDIR/bin/dsyperms.pl&quot;);
        system(&quot;chmod 550 $TOOLSDIR/bin/dsyperms.pl&quot;);

        #
        # Always remember: there can be more than one daisy database dir.
        #
        # Now remove the old version in the &quot;bin&quot; directory of a daisy db dir and
        # make symlink to ostools script.
        #
        my @daisy_db_dirs = glob(&quot;/d/*&quot;);

        for my $daisy_db_dir (@daisy_db_dirs) {

                # must be a directory
                next unless (-d $daisy_db_dir);

                # skip old daisy dirs
                next if ($daisy_db_dir =~ /.+-\d{12}$/);

                # must contain the magic files
                next unless(-e &quot;$daisy_db_dir/flordat.tel&quot;);
                next unless(-e &quot;$daisy_db_dir/control.dsy&quot;);

                # must be daisy 8.0+
                next unless (-d &quot;$daisy_db_dir/bin&quot;);

                system(&quot;rm -f $daisy_db_dir/bin/dsyperms.pl&quot;);
                system(&quot;ln -sf $TOOLSDIR/bin/dsyperms.pl $daisy_db_dir/bin/dsyperms.pl&quot;);
        }

        logit(&quot;---- END Installation $PROGNAME $CVS_REVISION ----&quot;, &#39;I&#39;);

        return(1);
}</code></pre>

<p>my @FilePaths = ();</p>

<p>sub assign_pabp_permissions { my ($dsyroot, $dsydir) = @_;</p>

<pre><code>        if ( (! defined $dsyroot) or ($dsyroot eq &quot;&quot;) ) {
                return(-1);
        }

        # top level directories
        my @dsy_top_level_dirs = qw(
                backup
                config
                daisy
                menus
                ostools
                putty
                server
                startup
                utils
        ); 

        #
        # Always remember, there can be daisy database dirs other than &#39;/d/daisy&#39;.
        # So add the current daisy db dir to the list if it&#39;s not &#39;/d/daisy&#39;.
        #
        if ($dsydir ne &#39;/d/daisy&#39;) {
                push(@dsy_top_level_dirs, basename($dsydir));
        }

        foreach my $thisdir (@dsy_top_level_dirs) {

                # the &quot;ostools&quot; dir does not have to exist
                if ($thisdir eq &quot;ostools&quot;) {
                        next if (! -d &quot;$dsyroot/$thisdir&quot;);
                }

                unless (-d &quot;$dsyroot/$thisdir&quot;) {
                        print(&quot;Warning! Expecting to find \&quot;$dsyroot/$thisdir\&quot; but directory not found!\n&quot;);
                        next;
                }

                if ($thisdir eq &quot;backup&quot; || $thisdir eq &quot;config&quot;) {
                        if ($DRY_RUN) {
                            dry_run_chown(&quot;root&quot;, &quot;root&quot;, &quot;$dsyroot/$thisdir&quot;);
                            dry_run_chmod(&quot;770&quot;, &quot;$dsyroot/$thisdir&quot;);
                        }
                        else {
                            system(&quot;chown root:root $dsyroot/$thisdir&quot;);
                            system(&quot;chmod 770 $dsyroot/$thisdir&quot;);
                        }
                } else {
                        if ($DRY_RUN) {
                            dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, &quot;$dsyroot/$thisdir&quot;);
                            dry_run_chmod(&quot;770&quot;, &quot;$dsyroot/$thisdir&quot;);
                        }
                        else {
                            system(&quot;chown tfsupport:daisy $dsyroot/$thisdir&quot;);
                            system(&quot;chmod 770 $dsyroot/$thisdir&quot;);
                        }
                }
        }


        #
        # Default permissions for all directories at the top of the daisy tree that
        # are not in the list of known directories.
        #
        # Each file should be owned by the &quot;support&quot; user and in the &quot;admins&quot; group.
        # We do not want the &quot;non-privileged&quot; daisy user being able to write these files.
        #
        # Note that skip setting defaults for known files/directories at the top level.
        # If this script is executed on a running system we could break software when
        # we &quot;flip&quot; file permissions from writable, to readable, back to writable.
        # See tracker 104357.
        #
        opendir(DIR, &quot;$dsyroot&quot;);
        foreach my $thisdir (readdir(DIR)) {
                #
                # Skip the typical file system stuff
                #
                next if ($thisdir =~ /\.$/);
                next if ($thisdir =~ /\.\.$/);
                next if ($thisdir =~ /lost\+found/);

                #
                # Skip the standard, expected dirs
                #
                next if (grep { /$thisdir/ }  @dsy_top_level_dirs); 

                #
                # Remember, there can be daisy database dirs other than &#39;/d/daisy&#39;
                # at the top level... so determine if a dir is a daisy db dir, and
                # if it is, skip it.  A directory is classified as a daisy db dir
                # if it is a dir in the top level, ie in &quot;/d&quot;, and it contains a
                # file named &quot;control.dsy&quot;.
                #
                if (-d &quot;$dsyroot/$thisdir&quot;) {
                        next if (-f &quot;$dsyroot/$thisdir/control.dsy&quot;);
                }

                #
                # Don&#39;t know what this file is, so log a message and leave it
                # alone. (formerly, items like this were affected but that
                # policy backfired when adding new directories and this script
                # could not be changed in unison - think offcycle edir project)
                #
                logit(&quot;unknown directory entry: $dsyroot/$thisdir&quot;, &#39;W&#39;);

        }
        closedir(DIR);


        my @dsy_bin_dirs = qw(
                bin
                utils
        );

        # Executable directories and their contents in /d/daisy
        foreach my $thisdir (@dsy_bin_dirs) {

                if (! -d &quot;$dsydir/$thisdir&quot;) {
                        print(&quot;Warning! \&quot;$dsydir/$thisdir\&quot; directory not found!\n&quot;);
                        next;
                }

                # very special case - if the symlink &quot;/d/daisy/bin/pcl6&quot; exists,
                # it comes out of the tar archive with arbitarary owner and group
                # so it needs to be set.
                if ($thisdir eq &quot;bin&quot;) {
                    if (-e &quot;$dsydir/$thisdir/pcl6&quot;) {
                        system(&quot;chown -h root:root $dsydir/$thisdir/pcl6&quot;);
                    }
                }

                # directory
                if ($DRY_RUN) {
                    dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, &quot;$dsydir/$thisdir&quot;);
                    dry_run_chmod(&quot;770&quot;, &quot;$dsydir/$thisdir&quot;);
                }
                else {
                    system(&quot;chown tfsupport:daisy $dsydir/$thisdir&quot;);
                    system(&quot;chmod 770 $dsydir/$thisdir&quot;);
                }
                # files &amp; files referenced by symlinks
                if ($DRY_RUN) {
                    foreach my $path (glob(&quot;$dsydir/$thisdir/*&quot;)) {
                        # if the directory is &quot;utils&quot; and it&#39;s a &quot;screen file&quot;
                        # (why are there any screen files in &quot;utils&quot;???), then
                        # the mode is set to &quot;660&quot; later on.
                        my $mode = &quot;550&quot;;
                        if (($thisdir eq &quot;utils&quot;) &amp;&amp; ($path =~ /\.scr$/)) {
                            $mode = &quot;660&quot;;
                        }
                        dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, $path);
                        dry_run_chmod($mode, $path);
                    }
                }
                else {
                    system(&quot;chown tfsupport:daisy $dsydir/$thisdir/*&quot;);
                    system(&quot;chmod 550 $dsydir/$thisdir/*&quot;);
                }
        }

        # Explicitly handle tools from OSTools package since they are vital to daisy
        if ($DRY_RUN) {
            dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, &quot;$dsyroot/ostools&quot;);
            dry_run_chmod(&quot;770&quot;, &quot;$dsyroot/ostools&quot;);
            dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, &quot;$dsyroot/ostools/bin&quot;);
            dry_run_chmod(&quot;770&quot;, &quot;$dsyroot/ostools/bin&quot;);
            foreach my $path (glob(&quot;$dsyroot/ostools/bin/*&quot;)) {
                dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, $path);
                dry_run_chmod(&quot;550&quot;, $path);
            }
        }
        else {
            system(&quot;chown tfsupport:daisy $dsyroot/ostools&quot;);
            system(&quot;chmod 770 $dsyroot/ostools&quot;);
            system(&quot;chown tfsupport:daisy $dsyroot/ostools/bin&quot;);
            system(&quot;chmod 770 $dsyroot/ostools/bin&quot;);
            system(&quot;chown tfsupport:daisy $dsyroot/ostools/bin/*&quot;);
            system(&quot;chmod 550 $dsyroot/ostools/bin/*&quot;);
        }

        my @dsy_dirs = qw(
                backup.dir
                blankdata
                comms
                config
                cubby
                dcom_email
                docs
                dsy
                errors
                export
                log
                pospool
                recv
                submit
                tfm
        );

        # Directories and their contents in /d/daisy
        foreach my $thisdir (@dsy_dirs) {

                if (! -d &quot;$dsydir/$thisdir&quot;) {
                        print(&quot;Warning! \&quot;$dsydir/$thisdir\&quot; directory not found!\n&quot;);
                        next;
                }

                # Since the &quot;export&quot; directory is mainly for exchanging
                # files with Windows PCs, don&#39;t try to set anything
                # inside that directory.
                if ($thisdir eq &quot;export&quot;) {
                    if ($DRY_RUN) {
                        dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, &quot;$dsydir/$thisdir&quot;);
                        dry_run_chmod(&quot;770&quot;, &quot;$dsydir/$thisdir&quot;);
                    }
                    else {
                        system(&quot;chown tfsupport:daisy $dsydir/$thisdir&quot;);
                        system(&quot;chmod 770 $dsydir/$thisdir&quot;);
                    }
                    next;
                }

                # it&#39;s unknown how the Daisy code uses this directory -
                # set it to known value rather than leaving it as it comes
                # out of the tar archive and don&#39;t do anything with it&#39;s
                # contents.
                if ($thisdir eq &quot;dcom_email&quot;) {
                    if ($DRY_RUN) {
                        dry_run_chown(&quot;daisy&quot;, &quot;daisy&quot;, &quot;$dsydir/$thisdir&quot;);
                        dry_run_chmod(&quot;750&quot;, &quot;$dsydir/$thisdir&quot;);
                    }
                    else {
                        system(&quot;chown daisy:daisy $dsydir/$thisdir&quot;);
                        system(&quot;chmod 750 $dsydir/$thisdir&quot;);
                    }
                    next;
                }

                if ($thisdir eq &quot;config&quot;) {
                    if ($DRY_RUN) {
                        dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, &quot;$dsydir/$thisdir&quot;);
                        dry_run_chmod(&quot;770&quot;, &quot;$dsydir/$thisdir&quot;);
                    }
                    else {
                        system(&quot;chown tfsupport:daisy $dsydir/$thisdir&quot;);
                        system(&quot;chmod 770 $dsydir/$thisdir&quot;);
                    }
                    next;
                }

                if ($DRY_RUN) {
                    dry_run_find_file_paths(&quot;$dsydir/$thisdir&quot;);
                    foreach my $path (@FilePaths) {
                        dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, $path);
                    }
                    dry_run_chmod(&quot;770&quot;, &quot;$dsydir/$thisdir&quot;);
                }
                else {
                    system(&quot;chown -R tfsupport:daisy $dsydir/$thisdir&quot;);
                    system(&quot;chmod 770 $dsydir/$thisdir&quot;);
                }

                if ($thisdir eq &quot;log&quot;) {
                        foreach my $logpath (glob(&quot;$dsydir/$thisdir/*&quot;)) {
                                my $logfile = basename($logpath);
                                if ($logfile =~ /dove-.*\.log/) {
                                    if ($DRY_RUN) {
                                        dry_run_chmod(&quot;660&quot;, &quot;$dsydir/$thisdir/$logfile&quot;);
                                    }
                                    else {
                                        system(&quot;chmod 660 $dsydir/$thisdir/$logfile&quot;);
                                    }
                                } elsif ($logfile =~ /dove\.log/) {
                                    if ($DRY_RUN) {
                                        dry_run_chmod(&quot;664&quot;, &quot;$dsydir/$thisdir/$logfile&quot;);
                                    }
                                    else {
                                        system(&quot;chmod 664 $dsydir/$thisdir/$logfile&quot;);
                                    }
                                } elsif ($logfile =~ /rtibackup-.*\.log/) {
                                    if ($DRY_RUN) {
                                        foreach my $path (glob(&quot;$dsyroot/$thisdir/$logfile*&quot;)) {
                                            dry_run_chmod(&quot;666&quot;, &quot;$path&quot;);
                                        }
                                    }
                                    else {
                                        system(&quot;chmod 666 $dsydir/$thisdir/$logfile*&quot;);
                                    }
                                }
                        }

                }
                elsif ($thisdir eq &quot;comms&quot;) {
                        if (-d &quot;$dsydir/$thisdir/tmp&quot;) {
                            if ($DRY_RUN) {
                                dry_run_chmod(&quot;770&quot;, &quot;$dsydir/$thisdir/tmp&quot;);
                            }
                            else {
                                system(&quot;chmod 770 $dsydir/$thisdir/tmp&quot;);
                            }
                        }
                }
                else {
                        # following dirs set explicitly below
                        next if ($thisdir eq &quot;dsy&quot;);
                        next if ($thisdir eq &quot;config&quot;);

                        if (count_dir_entries(&quot;$dsydir/$thisdir&quot;) &gt; 2) {
                            if ($DRY_RUN) {
                                foreach my $path (glob(&quot;$dsydir/$thisdir/*&quot;)) {
                                    dry_run_find_file_paths(&quot;$path&quot;);
                                    foreach my $file_path (@FilePaths) {
                                        dry_run_chmod(&quot;660&quot;, $file_path);
                                    }
                                }
                            }
                            else {
                                system(&quot;chmod -R 660 $dsydir/$thisdir/*&quot;);
                            }
                        }
                }
        }

        # Files in daisy db dir config directories
        my @dsy_config_files = (
                [ &#39;.&#39;,        &#39;control.dsy&#39;,        &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;660&#39; ],
                [ &#39;config&#39;,   &#39;backups.config&#39;,     &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;440&#39; ],
                [ &#39;config&#39;,   &#39;backups.config.new&#39;, &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;660&#39; ],
                [ &#39;config&#39;,   &#39;consolechars&#39;,       &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;770&#39; ],
                [ &#39;config&#39;,   &#39;daisybuildinfo.txt&#39;, &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;440&#39; ],
                [ &#39;config&#39;,   &#39;daisy-init.d&#39;,       &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;770&#39; ],
                [ &#39;config&#39;,   &#39;dell5200.ppd&#39;,       &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;660&#39; ],
                [ &#39;config&#39;,   &#39;dos.sfm&#39;,            &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;770&#39; ],
                [ &#39;config&#39;,   &#39;edir_update.conf&#39;,   &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;660&#39; ],
                [ &#39;config&#39;,   &#39;hpjl4200.ppd&#39;,       &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;660&#39; ],
                [ &#39;config&#39;,   &#39;hplj4200.ppd&#39;,       &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;660&#39; ],
                [ &#39;config&#39;,   &#39;zeedaisy-init.d&#39;,    &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;770&#39; ],
                [ &#39;dsy&#39;,      &#39;control.dsy&#39;,        &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;440&#39; ],
                [ &#39;dsy&#39;,      &#39;printers&#39;,           &#39;tfsupport&#39;, &#39;daisy&#39;, &#39;440&#39; ],
        );

        for my $i (0 .. $#dsy_config_files) {
                my $cfgdir = $dsy_config_files[$i][0];
                my $filename = $dsy_config_files[$i][1];
                my $owner = $dsy_config_files[$i][2];
                my $group = $dsy_config_files[$i][3];
                my $mode = $dsy_config_files[$i][4];
                if (-f &quot;$dsydir/$cfgdir/$filename&quot;) {
                    if ($DRY_RUN) {
                        dry_run_chown($owner, $group, &quot;$dsydir/$cfgdir/$filename&quot;);
                        dry_run_chmod($mode, &quot;$dsydir/$cfgdir/$filename&quot;);
                    }
                    else {
                        system(&quot;chown $owner:$group $dsydir/$cfgdir/$filename&quot;);
                        system(&quot;chmod $mode $dsydir/$cfgdir/$filename&quot;);
                    }
                }
        }

        # Executable files in daisy db dir
        my @dsy_bin_files = qw(
                0branch
                convpos crd crdmenu crdpos crdterm crunch custpro
                daisy data dayend dcom delvmgr delvzip designer dove dpos drawer dump
                fileutil edir einvoice
                glexport
                invlist invoice import
                marketpr map
                payroll pool poolmain pos posctrl poslist posmerc posxfer pzlookup
                qrest
                route rundriv
                setup
                terreset timeclck
                *.sh
                pdayend.new
        );

        # are there any typical extra files in daisy db dir
        my @dsy_extra_file_types = qw(
                *.sh.orig
                *.new.orig
        );
        for my $file_type (@dsy_extra_file_types) {
            my @extra_files = glob($file_type);
            if (scalar(@extra_files)) {
                push(@dsy_bin_files, $file_type);
            }
        }

        # these files were either added or dropped as of Daisy 9.2
        my @changed_bin_files = qw(
                activate
                poll
                dquery
                posdraw
                posfax
        );

        # so only add them to Daisy binary file list if they exist
        foreach my $changed_bin_file (@changed_bin_files) {
            if (-e &quot;$dsydir/$changed_bin_file&quot;) {
                push(@dsy_bin_files, $changed_bin_file);
            }
        }

        # Change permissions of all daisy executable files
        foreach my $file (@dsy_bin_files) {
            if ($DRY_RUN) {
                foreach my $path (glob(&quot;$dsydir/$file&quot;)) {
                    if (-e $path) {
                        dry_run_chown(&quot;tfsupport&quot;, &quot;daisy&quot;, &quot;$path&quot;);
                        dry_run_chmod(550, &quot;$path&quot;);
                    }
                }
            }
            else {
                system(&quot;chown tfsupport:daisy $dsydir/$file&quot;);
                system(&quot;chmod 550 $dsydir/$file&quot;);
            }
        }

        my @dsy_data_files = qw(
                *.arc
                *.dsy
                *.ftd
                *.hsp
                *.idx
                *.lok
                *.log
                *.map
                *.pr
                *.pos
                *.sal
                *.scr
                *.tel
                *.tgz
                *.txt
                *.rep
                hp5ctrl.*
                dcom.alv
                dcom_lock
                macros
                macros.*
                panelp.cnf
                poolflor.dat
                printers
                tcktlist.dat
                pospool/poolflor.*
                pospool/ticket.*
        );

        # Set permissions of all daisy data files
        foreach my $file (@dsy_data_files) {

                foreach my $datafile (glob(&quot;$dsydir/$file&quot;)) {
                        my $owner = &quot;tfsupport&quot;;
                        my $group;
                        my $perms;

                        # control.dsy was already taken care of
                        next if ($datafile eq &quot;$dsydir/control.dsy&quot;);

                        next unless (-e &quot;$datafile&quot;);

                        if ($datafile eq &quot;$dsydir/crddata.pos&quot;) {
                                $group = &quot;dsyadmins&quot;;
                                $perms = &quot;464&quot;;
                        }
                        elsif ($datafile eq &quot;$dsydir/dcom.alv&quot;) {
                                $owner = &quot;daisy&quot;;
                                $group = &quot;daisy&quot;;
                                $perms = &quot;664&quot;;
                        }
                        elsif ($datafile eq &quot;$dsydir/dcom_lock&quot;) {
                                $owner = &quot;daisy&quot;;
                                $group = &quot;daisy&quot;;
                                $perms = &quot;755&quot;;
                        }
                        else {
                                $group = &quot;daisy&quot;;
                                $perms = &quot;660&quot;;
                        }

                        if ($DRY_RUN) {
                            dry_run_chown($owner, $group, $datafile);
                            dry_run_chmod($perms, $datafile);
                        }
                        else {
                            system(&quot;chown $owner:$group $datafile&quot;);
                            system(&quot;chmod $perms $datafile&quot;);
                        }
                }
        }

        # list of files in /d/backup
        my @backup_dir_files = qw(
                error.txt
                log
                verify
        );

        # Change owners and modes for files in /d/backup dir
        foreach my $file (@backup_dir_files) {

                my $file_path = &quot;$dsyroot/backup/$file&quot;;

                if (-d $file_path) {
                        system(&quot;chown -R tfsupport:daisy $file_path&quot;);
                        system(&quot;chmod 660 $file_path&quot;);
                }

                unless (-f $file_path) {
                        next;
                }

                system(&quot;chown tfsupport:daisy $file_path&quot;);
                system(&quot;chmod 660 $file_path&quot;);
        }

        # Change permissions on the config files (if any)
        if (-d &quot;$dsyroot/config/stuff&quot;) {
                system(&quot;chown -R root:root $dsyroot/config/*&quot;);
                system(&quot;chmod 750 $dsyroot/config/*&quot;);
        }

        # Change permissions on the crawl menu files
        # Note: skip changing the perms on the &quot;market_input&quot; script which
        # is a perl script that used to be located in /d/daisy/menus but is
        # is located in /d/daisy/bin... now there is just a symlink pointing
        # from /d/daisy/menus to /d/daisy/bin.

        foreach my $menufile (glob(&quot;$dsyroot/menus/*&quot;)) {

                next if ($menufile eq &quot;$dsyroot/menus/market_input&quot;);

                system(&quot;chown tfsupport:dsyadmins $menufile&quot;);
                system(&quot;chmod 444 $menufile&quot;);
        }

        # Change permissions on the crawl program files
        my @crawl_prog_files = qw(
                crawlmenu
        );
        foreach my $file (@crawl_prog_files) {
                system(&quot;chown tfsupport:dsyadmins $dsyroot/menus/$file&quot;);
                system(&quot;chmod 555 $dsyroot/menus/$file&quot;);
        }

        # Change permissions on the putty config files
        system(&quot;chown tfsupport:dsyadmins $dsyroot/putty/*&quot;);
        system(&quot;chmod 755 $dsyroot/putty/*&quot;);

        # Change permissions on the &quot;server&quot; (misnomer!) scripts
        system(&quot;chown tfsupport:daisy $dsyroot/server/*&quot;);
        system(&quot;chmod 750 $dsyroot/server/*&quot;);

        # Change permissions on the startup scripts
        system(&quot;chown tfsupport:daisy $dsyroot/startup/*&quot;);
        system(&quot;chmod 750 $dsyroot/startup/*&quot;);

        # Change perms on tcc dir and files
        system(&quot;chown -R tfsupport:daisy $dsydir/tcc&quot;);
        system(&quot;chmod 770 $dsydir/tcc&quot;);
        system(&quot;chown -R tfsupport:daisy $dsydir/tcc/*&quot;);
        system(&quot;chmod 550 $dsydir/tcc/*&quot;);

        # handle one or more optional credit card processing directories
        # within daisy db dir... usually there is only &quot;crd2&quot; if any.

        my @alt_crd_dirs = qw(
                crd2
                crd3
                crd4
                crd5
        );

        foreach my $alt_crd_dir (@alt_crd_dirs) {

                my $alt_crd_dir_path = &quot;$dsydir/$alt_crd_dir&quot;;

                next unless (-d $alt_crd_dir_path);

                # The alternate card dir itself
                system(&quot;chown tfsupport:daisy $alt_crd_dir_path&quot;);
                system(&quot;chmod 770 $alt_crd_dir_path&quot;);

                # Executable files in alternate card dir
                my @alt_crd_binaries = qw(
                        crd
                        crdmenu
                        crdpos
                        crdterm
                );
                foreach my $binary (@alt_crd_binaries) {
                        next unless (-f &quot;$alt_crd_dir_path/$binary&quot;);
                        system(&quot;chown tfsupport:daisy $alt_crd_dir_path/$binary&quot;);
                        system(&quot;chmod 550 $alt_crd_dir_path/$binary&quot;);
                }

                # Data files in alternate card dir
                my @alt_crd_datafiles = qw(
                        authdat.pos
                        crdaudi0.pos
                        crdaudi1.pos
                        crdaudi2.pos
                        crdctrl.pos
                        crdinet.pos
                        crdinput.pos
                        crdmodem.pos
                        crd_scr.scr
                        cutilscr.scr
                        doserror.log
                        firsctrl.pos
                        moductrl.pos
                        ncrctrl.pos
                        ndc2ctrl.pos
                        panelp.cnf
                        paymctrl.pos
                        posctrl.pos
                        prsetscr.scr
                        settfil0.pos
                        settfil1.pos
                        settfil2.pos
                        settfile.pos
                        vnetctrl.pos
                );
                foreach my $datafile (@alt_crd_datafiles) {
                        next unless (-f &quot;$alt_crd_dir_path/$datafile&quot;);
                        system(&quot;chown tfsupport:daisy $alt_crd_dir_path/$datafile&quot;);
                        system(&quot;chmod 660 $alt_crd_dir_path/$datafile&quot;);
                }

                # Sub directories in alternate card dir
                my @alt_crd_subdirs = qw(
                        dsy
                );
                foreach my $subdir (@alt_crd_subdirs) {
                        next unless (-d &quot;$alt_crd_dir_path/$subdir&quot;);
                        system(&quot;chown tfsupport:daisy $alt_crd_dir_path/$subdir&quot;);
                        system(&quot;chmod 770 $alt_crd_dir_path/$subdir&quot;);

                        next unless (-d &quot;$alt_crd_dir_path/$subdir/printers&quot;);
                        system(&quot;chown tfsupport:daisy $alt_crd_dir_path/$subdir/printers&quot;);
                        system(&quot;chmod 660 $alt_crd_dir_path/$subdir/printers&quot;);
                }

                # The tcc sub dir in the alternate card dir

                next unless (-d &quot;$alt_crd_dir_path/tcc&quot;);

                system(&quot;chown -R tfsupport:daisy $alt_crd_dir_path/tcc&quot;);
                system(&quot;chmod 770 $alt_crd_dir_path/tcc&quot;);
                system(&quot;chown -R tfsupport:daisy $alt_crd_dir_path/tcc/*&quot;);
                system(&quot;chmod 550 $alt_crd_dir_path/tcc/*&quot;);
        }

        return 0;
}</code></pre>

<p>sub dry_run_process_file { if ($File::Find::name ne &quot;&quot;) { push(@FilePaths, $File::Find::name); } }</p>

<p>sub dry_run_find_file_paths { my (@dir_path) = @_;</p>

<pre><code>    @FilePaths = ();
    find(\&amp;dry_run_process_file, @dir_path);
}</code></pre>

<p>sub dry_run_chown { my ($owner, $group, $path) = @_;</p>

<pre><code>    my $file_owner = getpwuid((stat($path))[4]);
    my $file_group = getgrgid((stat($path))[5]);

    if ($file_owner ne $owner &amp;&amp; $file_group ne $group) {
        print &quot;chown $owner:$group $path\n&quot;;
    }
    elsif ($file_owner ne $owner) {
        print &quot;chown $owner $path\n&quot;;
    }
    elsif ($file_group ne $group) {
        print &quot;chgrp $group $path\n&quot;;
    }

    return(1);
}</code></pre>

<p>sub dry_run_chmod { my ($mode, $path) = @_;</p>

<pre><code>    my $file_mode = sprintf &#39;%03o&#39;, (stat $path)[2] &amp; 07777;

    if ($file_mode ne $mode) {
        print &quot;chmod $mode $path\n&quot;;
    }

    return(1);
}</code></pre>

<p># # Function to determine if an arbitrary path is a path to a # daisy databse directory. # sub is_daisy_db_dir { my ($path) = @_;</p>

<pre><code>        # must begin with &#39;/d/&#39;
        return(0) unless ($path =~ /^\/d\//);

        # must be a directory
        return(0) unless (-d $path);

        # skip old daisy dirs
        return(0) if ($path =~ /^\/d\/.+-\d{12}$/);

        # must contain the magic files
        return(0) unless (-e &quot;$path/flordat.tel&quot;);
        return(0) unless (-e &quot;$path/control.dsy&quot;);

        # must be daisy 8.0+
        return(0) unless (-d &quot;$path/bin&quot;);

        return(1);
}</code></pre>

<p>sub count_dir_entries { my ($dirpath) = @_;</p>

<pre><code>        opendir(DIR, $dirpath) or return(0);
                my @dirents = readdir(DIR) or return(0);
        closedir(DIR);

        return(scalar @dirents);
}</code></pre>

<p>sub set_dir_perms { my ($dirpath, $perms) = @_;</p>

<pre><code>        opendir(DIR, $dirpath);
        foreach my $dirent (readdir(DIR)) {
                next if ($dirent =~ /\.$/);     # Non-admin writable directory
                next if ($dirent =~ /\.\.$/);   # A must have &quot;skip&quot;.

                system(&quot;chmod -R $perms $dirpath/$dirent&quot;);

        }
        closedir(DIR);

        return(1);
}</code></pre>

<p>sub loginfo { my ($msg) = @_;</p>

<pre><code>        print(&quot;$msg\n&quot;);
        logit($msg, &#39;I&#39;);

        return(1);
}</code></pre>

<p>sub logwarning { my ($msg) = @_;</p>

<pre><code>        print(&quot;Warning: $msg\n&quot;);
        logit($msg, &#39;W&#39;);

        return(1);
}</code></pre>

<p>sub logerror { my ($msg) = @_;</p>

<pre><code>        print(&quot;Error: $msg\n&quot;);
        logit($msg, &#39;E&#39;);

        return(1);
}</code></pre>

<p>sub logit { my ($msg, $msg_type) = @_; my $tag = &quot;$PROGNAME&quot;;</p>

<pre><code>        system(&quot;/usr/bin/logger -i -t $tag -- \&quot;$UID: &lt;$msg_type&gt; $msg\&quot;&quot;);

        return($?);
}</code></pre>

<p>__END__</p>

<h1 id="NAME1">NAME</h1>

<p>dsyperms.pl - set the perms of files and directories in a Daisy tree</p>

<h1 id="VERSION1">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.16 $</p>

<h1 id="USAGE">USAGE</h1>

<p>dsyperms.pl <b>--version</b></p>

<p>dsyperms.pl <b>--help</b></p>

<p>dsyperms.pl <b>--install</b></p>

<p>dsyperms.pl [--dry-run] /path/to/daisydb</p>

<h1 id="OPTIONS1">OPTIONS</h1>

<dl>

<dt id="version1"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help1"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="install"><b>--install</b></dt>
<dd>

<p>Copy the script to the ostools directory and make the links to it in all of the Daisy database directories.</p>

</dd>
<dt id="dry-run"><b>--dry-run</b></dt>
<dd>

<p>Don&#39;t actually change any perms, merely output to stdout the list of files that would have been changed had this option not been specified and how they would be changed.</p>

</dd>
</dl>

<h1 id="DESCRIPTION1">DESCRIPTION</h1>

<p>The <i>dsyperms.pl</i> script sets the perms and modes for all the files and directories in the Daisy database directory specified as the one and only allowed command line argument.</p>

<h1 id="FILES1">FILES</h1>

<dl>

<dt id="d-daisy1"><b>/d/daisy</b></dt>
<dd>

<p>The default Daisy database directory.</p>

</dd>
<dt id="d-ostools-bin1"><b>/d/ostools/bin</b></dt>
<dd>

<p>The ostools bin directory on a Daisy system.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-0">Exit status 0</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1">Exit status 1</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
<dt id="Exit-status-2">Exit status 2</dt>
<dd>

<p>Other than the command line options &quot;--version&quot; and &quot;--help&quot;, the user must be root or running under &quot;sudo&quot;.</p>

</dd>
</dl>

<h1 id="SEE-ALSO1">SEE ALSO</h1>

<p>chmod(1), chown(1)</p>

<h1 id="NAME2">NAME</h1>

<p>dsyuser.pl - manage Daisy user and Daisy admin accounts</p>

<h1 id="VERSION2">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.12 $</p>

<h1 id="USAGE1">USAGE</h1>

<p>dsyuser.pl</p>

<p>dsyuser.pl <b>--version</b></p>

<p>dsyuser.pl <b>--help</b></p>

<p>dsyuser.pl <b>--add</b></p>

<p>dsyuser.pl <b>--enable-admin</b></p>

<p>dsyuser.pl <b>--disable-admin</b></p>

<p>dsyuser.pl <b>--remove</b></p>

<p>dsyuser.pl <b>--info</b></p>

<p>dsyuser.pl <b>--list</b></p>

<p>dsyuser.pl <b>--profile</b></p>

<p>dsyuser.pl <b>--lock</b></p>

<p>dsyuser.pl <b>--unlock</b></p>

<p>dsyuser.pl <b>--update</b></p>

<p>dsyuser.pl <b>--resetpw</b></p>

<p>dsyuser.pl <b>--expirepw</b></p>

<h1 id="OPTIONS2">OPTIONS</h1>

<dl>

<dt id="version2"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help2"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="add"><b>--add</b></dt>
<dd>

<p>Add a new Daisy user account.</p>

</dd>
</dl>

<h1 id="DESCRIPTION2">DESCRIPTION</h1>

<p>This script performs all operations to manage Daisy user accounts and Daisy admin accounts. It should be used in lieu of other interfaces because it ensures that operations conform to the applicable security policies with regard to accounts on a Daisy system.</p>

<p>When adding a new <code>daisy</code> user via <code>--add username</code> option, the new account will also be added to the following system groups:</p>

<dl>

<dt id="daisy"><code>daisy</code></dt>
<dd>

</dd>
<dt id="floppy"><code>floppy</code></dt>
<dd>

</dd>
<dt id="lp"><code>lp</code></dt>
<dd>

</dd>
<dt id="lock"><code>lock</code></dt>
<dd>

</dd>
</dl>

<p>On <code>RHEL5</code> and <code>RHEL6</code>, it will also be added to the <code>uucp</code> group.</p>

<h1 id="FILES2">FILES</h1>

<dl>

<dt id="bash_profile"><b>~/.bash_profile</b></dt>
<dd>

<p>Upon addition of every a Daisy account, whether a user account or an admin account, a new <b>~/.bash_profile</b> file is generated.</p>

</dd>
<dt id="var-log-messages"><b>/var/log/messages</b></dt>
<dd>

<p>The log file that all log messages are written to.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS1">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-01">Exit status 0</dt>
<dd>

<p>Successful completion or when the &quot;--version&quot; and &quot;--help&quot; command line options are specified.</p>

</dd>
</dl>

<h1 id="SEE-ALSO2">SEE ALSO</h1>

<p><b>dsyperms.pl</b></p>

<h1 id="NAME3">NAME</h1>

<p>harden_linux.pl - Linux operating systems security hardener</p>

<h1 id="VERSION3">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.136 $</p>

<h1 id="USAGE2">USAGE</h1>

<p>harden_linux.pl <b>--version</b></p>

<p>harden_linux.pl <b>--help</b></p>

<p>harden_linux.pl <b>--install [--upgrade-12-13]</b></p>

<p>harden_linux.pl <b>--install-configfile [--configfile=path]</b></p>

<p>harden_linux.pl <b>--convert-configfile [--configfile=path]</b></p>

<p>harden_linux.pl <b>--iptables-port=string</b></p>

<p>harden_linux.pl <b>[--configfile=path]</b></p>

<p>harden_linux.pl <b>--all [--configfile=path]</b></p>

<p>harden_linux.pl <b>(--ipv6 | --hostsallow | --pam | --services | --bastille | --logging | --logrotate | --ssh | --time | --ids) [--configfile=path]</b></p>

<p>harden_linux.pl <b>(--iptables | --sudo) [--configfile=path] [--revert-delay=n]</b></p>

<p>harden_linux.pl <b>(--revert-iptables | --revert-sudo)</b></p>

<h1 id="OPTIONS3">OPTIONS</h1>

<dl>

<dt id="version3"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help3"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="install1"><b>--install</b></dt>
<dd>

<p>Install the script.</p>

</dd>
<dt id="upgrade-12-13"><b>--upgrade-12-13</b></dt>
<dd>

<p>Force an upgrade from the 1.12.x version of the script to a 1.13.x version.</p>

</dd>
<dt id="all"><b>--all</b></dt>
<dd>

<p>For convenience, this option is the same as specifying all options.</p>

</dd>
<dt id="install-configfile"><b>--install-configfile</b></dt>
<dd>

<p>Install a default version of the config file.</p>

</dd>
<dt id="convert-configfile"><b>--convert-configfile</b></dt>
<dd>

<p>Convert any &quot;append&quot; directives to &quot;directory&quot; style.</p>

</dd>
<dt id="configfile-path"><b>--configfile=path</b></dt>
<dd>

<p>Specify the location of the config file. This option may be added to any of the other options.</p>

</dd>
<dt id="revert-delay-n"><b>--revert-delay=n</b></dt>
<dd>

<p>Setup an &quot;at job&quot; which will revert a change after &#39;n&#39; minutes. This option may only be specified with the <b>--iptables</b> or <b>--sudoers</b> options.</p>

</dd>
<dt id="revert-iptables"><b>--revert-iptables</b></dt>
<dd>

<p>Revert the last iptables change.</p>

</dd>
<dt id="revert-sudo"><b>--revert-sudo</b></dt>
<dd>

<p>Revert the last sudo change.</p>

</dd>
<dt id="iptables-port-string"><b>--iptables-port=string</b></dt>
<dd>

<p>Allows specification of ports to open in the &quot;iptables&quot; firewall.</p>

</dd>
<dt id="iptables"><b>--iptables</b></dt>
<dd>

<p>Configure the iptables system service.</p>

</dd>
<dt id="ipv6"><b>--ipv6</b></dt>
<dd>

<p>Disable the IPv6 features of the system.</p>

</dd>
<dt id="hostsallow"><b>--hostsallow</b></dt>
<dd>

<p>Generate a new &quot;/etc/hosts.allow&quot; file.</p>

</dd>
<dt id="pam"><b>--pam</b></dt>
<dd>

<p>Configure login parameters via PAM.</p>

</dd>
<dt id="sudo"><b>--sudo</b></dt>
<dd>

<p>Generate a new &quot;/etc/sudoers&quot; file.</p>

</dd>
<dt id="services"><b>--services</b></dt>
<dd>

<p>Stop and disable system services not on an allowed white list.</p>

</dd>
<dt id="bastille"><b>--bastille</b></dt>
<dd>

<p>No function, present for backward compatability only.</p>

</dd>
<dt id="logging---logrotate"><b>--logging|--logrotate</b></dt>
<dd>

<p>Configure the log file rotation schedule.</p>

</dd>
<dt id="ssh"><b>--ssh</b></dt>
<dd>

<p>Generate a new instance of the sshd config file.</p>

</dd>
<dt id="time"><b>--time</b></dt>
<dd>

<p>Generate a new NTP &quot;step-tickers&quot; config file.</p>

</dd>
<dt id="ids"><b>--ids</b></dt>
<dd>

<p>No function, present for backward compatability only.</p>

</dd>
</dl>

<h1 id="DESCRIPTION3">DESCRIPTION</h1>

<p>The <code>&quot;harden_linux.pl&quot;</code> improves the security of the system, chiefly with respect to PCI security requirements. It performs this system &quot;hardening&quot;, in a manner of speaking, by editing or generating config files which control or dictate the actions of several of the system facilities; some of these system facilities include: iptables, PAM, sudoers, hosts.allow, system services, ssh, etc.</p>

<p>The &quot;harden script&quot; must be run as <code>&quot;root&quot;</code>, ie either from the <code>&quot;root&quot;</code> account or via the <code>&quot;sudo&quot;</code> command; if not, the script will exit with a non-zero exit status .</p>

<p>Each of these facilities may be changed all at once, or individually. The selection of which facilities to configure is accomplished via the configuration command line options.</p>

<p>Running <code>&quot;harden_linux.pl&quot;</code> with no configuration command line options means to configure all the facilities under the purview of <code>&quot;harden_linux.pl&quot;</code>. Likewise, the <code>&quot;--all&quot;</code> option is the same as if no configuration command line options were specified.</p>

<p>There are no command line arguments expected and any specifed are ignored.</p>

<p>Running <code>&quot;harden_linux.pl&quot;</code> with select configuration options means to configure just the facility specified. For example, the command:</p>

<pre><code>    harden_linux.pl --iptables</code></pre>

<p>will only configure the iptables facility.</p>

<p>There are other command line options that deal with details other than the facility to configure. There are options like <code>&quot;--version&quot;</code> to report the version number, and <code>&quot;--help&quot;</code> to output a brief help message.</p>

<h2 id="CONFIG-FILE">CONFIG FILE</h2>

<p>There is a config file for the <code>&quot;harden_linux.pl&quot;</code> command. The name of the config file is <code>&quot;harden_linux.conf&quot;</code>. The default location of the config file is located in <code>&quot;/usr2/ostools/config&quot;</code> for RTI systems and in <code>&quot;/d/ostools/config&quot;</code> for Daisy systems. The path to a custom config file may be specified with the <code>&quot;--configfile=path&quot;</code> command line option.</p>

<p>Blank lines, or lines that have only &quot;white space&quot;, or lines that begin with a <code>&quot;#&quot;</code> character are ignored. Otherwise, each line is considered a config file directive. Each directive can tailor the behavior of harden_linux.pl in some way. There can be one or more directives in the config file.</p>

<p>The are several types of directives - the first type can enable or disable any of the configuration options. Thus, there corresponds a directive for each of these options. However, if an option is enabled in the config file, the action associated with an option is only performed by <code>&quot;harden_linux.pl&quot;</code> if it is <i>also</i> specified on the command line. And on the contrary, an option that is disabled in the config file, then the action associated with that option is NOT performed even if it is specified on the command line. Thus, for the revertable and non-revertable configuration options, the config file is best used as a way to keep some options from being performed. This is quite useful when running on a host that is known to be incompatible with one of more of the configuration options.</p>

<p>The second type of directive is the &quot;append&quot; directive which provides a method of adding content to a generated config file. Currently, the two config files supported are <code>&quot;/etc/hosts.allow&quot;</code> and <code>&quot;/etc/sudoers&quot;</code>.</p>

<p>An as example of the first type of directive, the <code>&quot;harden_linux.pl&quot;</code> config file can contain lines like:</p>

<pre><code> iptables=yes
 sudo=no
 ids=no</code></pre>

<p>and so on, one for each of the configuration options. The value of the directive is the word to the right of the EQUAL SIGN; for the configuration options, the word may either be &quot;yes&quot; or &quot;no&quot;, &quot;true&quot; or &quot;false&quot;, &quot;1&quot; or &quot;0&quot;. The default value of a configuration option directive is considered to be &quot;true&quot;.</p>

<p>As an example, the &quot;iptables&quot; directive can be used to prevent configuration of the iptables facility. If the config file contains the line:</p>

<pre><code> iptables=no</code></pre>

<p>then when the <code>&quot;harden_linux.pl&quot;</code> script runs, the iptables facility will not be configured. The config file overrides any command line options. This can be useful for sites that are known to have networks that are not supported by the <code>&quot;harden_linux.pl --iptables&quot;</code> command.</p>

<p>The second directive type provides a method for specifying the text that will be appended to the contents of a generated config file. This may be used to specify site dependent contents to be added to the contents generated by <code>&quot;harden_linux.pl&quot;</code>. The syntax of this &quot;append&quot; command is very similar to the BASH Shell &quot;here&quot; document.</p>

<p>The following command;</p>

<pre><code> harden_linux.pl --hostsallow</code></pre>

<p>generates a new <code>/etc/hosts.allow</code> config file with standard contents. The append directive may be used as a way to add additional, site dependent contents to <code>/etc/hosts.allow</code>.</p>

<p>For example, if the <code>harden_linux.pl</code> config file contains:</p>

<pre><code> append /etc/hosts.allow &lt;&lt; EOF
 #Fred
 sshd:   10.10.6.0 except 10.10.6.1
 #Barney
 sshd:   10.10.7.0 except 10.10.7.1
 #Wilma
 sshd:   10.10.8.0 except 10.10.8.1
 EOF</code></pre>

<p>then the lines between the &quot;append&quot; line and the &quot;marker&quot; line, ie the line containing only &quot;EOF&quot;, will be appended to <code>/etc/hosts.allow</code> whenever a new instance of <code>/etc/hosts.allow</code> is generated.</p>

<p>Another form of the &quot;append&quot; command allows the specification of the path to a file whose contents will be appended to the <code>/etc/sudoers</code> config file.</p>

<p>For example, if the <code>harden_linux.pl</code> config file contains:</p>

<pre><code> append /etc/sudoers == /etc/sudoers.local</code></pre>

<p>then the contents of <code>/etc/sudoers.local</code> will be appended to the <code>/etc/sudoers</code> file generated by <code>harden_linux.pl</code>.</p>

<p>Yet another method to append site specific content to <code>/etc/sudoers</code> file is to specify the path to a directory in the &quot;append&quot; directive. Then, the conents of any files in the directory that have a file extension of <code>.conf</code> will all be appended to the generated <code>sudoers</code> file.</p>

<p>For example, if the <code>harden_linux.pl</code> config file contains:</p>

<pre><code> append /etc/sudoers == /d/ostools/config/sudoers.d</code></pre>

<p>and <code>/d/ostools/config/sudoers.d</code> is a directory, and the directory contains the files <code>tfspec.conf</code>, <code>tfdefault.conf</code>, and <code>tfdefault.conf.old</code>, then the contents of the files <code>tfspec.conf</code> and <code>tfdefault.conf</code> will be concatenated and appended to the <code>/etc/sudoers</code> file.</p>

<p>If mutltiple types of &quot;append&quot; directives appear in the <code>harden_linux.pl</code> config file, then the last &quot;append&quot; directive in the conf file will be the one that actually takes effect.</p>

<p>A third directive available is the <code>iptables-port=n</code> directive. This directive allows the specification of additional inbound ports to open in the iptables &quot;INPUT&quot; chain of the &quot;filter&quot; table. One or more of these directives are allowed. For each directive, only 1 port number is allowed. The allowed value of &quot;n&quot; is 0 to 65535.</p>

<h2 id="COMMAND-LINE-OPTIONS">COMMAND LINE OPTIONS</h2>

<p>The <code>--install</code> command line option performs all the steps necessary to install the <code>harden_linux.pl</code> script onto the system. First, a new default config file is installed - please see the description for the <code>--install-configfile</code> option for the details. Then, the version of the currently installed <code>harden_linux.pl</code> script is compared with the new version to be installed. If the old version was 1.12.x and the new version is 1.13.x, then the custom rules from <code>/etc/hosts.allow</code> are migrated to the <code>harden_linux.conf</code> file. For some situations where the automatic detection of an upgrade may not be possible, ie when a whole new OSTools package is being stalled, the upgrade step may be forced by specifying the <code>--upgrade-12-13</code> command line option. Thus, when <code>harden_linux.pl --all</code> or <code>harden_linux.pl --hostsallow</code> is run and a new <code>/etc/hosts.allow</code> config file is generated, these rules will be in place in the config file and thus be included in the new instance of the <code>/etc/hosts.allow</code> config file.</p>

<p>The <code>--all</code> command line option is a convenience alias; this option is the same as specifying --iptables, --ipv6, --hostsallow, --pam, --sudo, --services, --bastille, --logging, --ssh, --time, and --ids.</p>

<p>The <code>--install-configfile</code> command line option specifies that the default config file is to be installed. If a config file already exists, then the existing config will be left, and the new version will be written with the suffix &quot;.new&quot;.</p>

<p>The <code>--configfile=path</code> command line option is a way to specify an alternate location for the config file. The default location is in the OSTools directory in a directory named &quot;config&quot;. For example, on a Daisy system, the default location of the config file is &quot;/d/ostools/config/harden_linux.config&quot;. If the &quot;--install-configfile&quot; and &quot;--configfile=path&quot; are both specified on the same command line, the default config file will be installed at the alternate location.</p>

<p>The <code>--revert-delay=n</code> command line option provides a way to revert a change made to the iptables config file or to the &quot;sudo&quot; config file. Changes to either of these config files could seriously subvert the security of the system, deny required services to the system, or prevent privledged access to the system. Thus, changes to them should not be taken lightly.</p>

<p>If a change is made via <code>--iptables</code> or <code>--sudo</code>, and if the <code>--revert-delay</code> option is also specified on the command line, then after the change to the system is made, an &quot;at job&quot; is submitted which will revert the system back to the way it was before the change. If the change made to the system was determined to be appropriate and working as desired, the &quot;at job&quot; can be cancelled (via &quot;sudo at -d &lt;job_nr&gt;&quot;) and the change will stand. If the change did not work as desired, it would be reverted automatically.</p>

<p>As an example, assume that the <b>harden_linux.pl</b> config file has a directive like:</p>

<pre><code> append /etc/sudoers == /d/ostools/config/sudoers.local</code></pre>

<p>which causes the contents of &quot;/d/ostools/config/sudoers.local&quot; to be appended to &quot;/etc/sudoers&quot; after it&#39;s generated by &quot;harden_linux.pl&quot;. If the command</p>

<pre><code> harden_linux.pl --sudo --revert-delay=5</code></pre>

<p>is run, a new instance of the &quot;/etc/sudoers&quot; file is generated and an &quot;at job&quot; is submitted that will revert the change after 5 mintues. If that change happens to lock out privledged access to the system for the &quot;tfsupport&quot; account, after the time specified with the <code>--revert-delay</code> option has elapsed, the system will revert the change and privledged access will be returned.</p>

<p>The <code>--revert-iptables</code> command line option will revert to the last change made to the iptables config file.</p>

<p>The <code>--revert-sudo</code> command line option will revert to the last change made to sudo config file, ie &quot;/etc/sudoers&quot;.</p>

<p>The <code>--iptables-port=string</code> command line option allows the user to specify a comma separated list of ports to open in the &quot;INPUT&quot; chain of the &quot;filter&quot; table of the iptables firewall.</p>

<p>The <code>--iptables</code> command line option generates a new set of iptables firewall rules. Currently, only hosts on the 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/24 networks are supported. For systems on networks other than these networks, do not run the &quot;harden_linux.pl&quot; script with &quot;--iptables&quot; option. In fact, it is suggested that the line &quot;iptables=no&quot; be put in the <code>harden_linux.pl</code> config file so that even if &quot;--iptables&quot; is specified on the command line, it will not be done.</p>

<p>The <code>--ipv6</code> command line option disables support for the IPv6 network protocol.</p>

<p>The <code>--hostsallow</code> command line option generates a new &quot;/etc/hosts.allow&quot; file. The contents generated for the file &quot;/etc/hosts.allow&quot; will depend on the network configuration and any site dependent configuration specified in the harden_linux.pl conf file. Currently, for generation of the rule for &quot;sshd&quot; access to the server from hosts on the local network, only hosts on the 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/24 networks are supported. For systems on networks other than these networks, add a site specific rule to the &quot;harden_linux.pl&quot; conf file. For example, if your server IP address is 193.193.1.21 and your gateway is at ip address 193.193.1.254, add a rule like the following to the &quot;harden_linux.pl&quot; conf file - this rule will be appended to the contents of the &quot;/etc/hosts.allow&quot; file after the contents generated by &quot;harden_linux.pl&quot;:</p>

<pre><code> append /etc/hosts.allow &lt;&lt; EOF
 sshd: 193.193. except 193.193.1.254
 EOF</code></pre>

<p>The <code>--pam</code> command line option configures login parameters via PAM. Examples are minimum length of account passwords, number of incorrect login attempts allowed before 30 minute timeout applied, etc.</p>

<p>For RHEL5 and RHEL6 systems, a new PAM conf file named <code>/etc/pamd.d/system-auth-teleflora</code> is generated and a symlink named <code>/etc/pam.d/system-auth</code> is made to point at it. For RHEL6 systems, a symlink named <code>/etc/pam.d/passwd-auth</code> is also made to point at it. The first symlink takes care of enforcing login rules for non-SSH logins, while the second symlink takes care of SSH logins.</p>

<p>It modifies the <code>/etc/securetty</code> file so that root logins are allowed on <code>tty12</code>; it modifies <code>/etc/security/limits.conf</code> so that only 1 simultaneous Daisy admin account login is allowed, 10 simultaneous &quot;root&quot; logins are allowed, and 10 simultaneous &quot;tfsupport&quot; logins are allowed; modifies <code>/etc/pam.d/su</code> so that an &quot;su -&quot; will only work if entered on one of the white listed tty lines or virtual consoles. Basically, this disallows remote access to the &quot;root&quot; account.</p>

<p>The <code>--sudo</code> command line option generates a new <code>/etc/sudoers</code> file. One of the directives within the new <code>/etc/sudoers</code> file establishes a log file named <code>/var/log/sudo.log</code> which records all commands executed with <code>sudo</code>. Since this log file is subject to the PA-DSS rules for rotating and retaining log files, a &quot;logrotate&quot; config file named <code>/etc/logrotate.d/sudo</code> is generated to manage that requirment.</p>

<p>There is one issue with this strategy: one some systems, the <code>syslog</code> log rotate config file may contain a reference to <code>sudo</code>. If so, that reference must be removed since the <code>logrotate</code> code can not tolerate a reference to <code>sudo</code> in the <code>syslog</code> log rotate config file and in a separate log rotate config file.</p>

<p>The <code>--services</code> command line option disables all systerm services that are not on a list of allowed system services, ie a &quot;whitelist&quot; of system services.</p>

<p>The list of allowed system services for RHEL5 and RHEL6 is:</p>

<ul>

<pre><code>    acpid
    apcupsd
    anacron
    atd
    auditd
    blm
    bbj
    cpuspeed
    crond
    cups
    cups-config-daemon
    daisy
    dgap
    dgrp_daemon
    dgrp_ditty
    dsm_sa_ipmi
    firstboot
    httpd
    instsvcdrv
    ipmi
    iptables
    irqbalance
    kagent-TLFRLC38702197701560
    kagent-TLFRLC81288907470344
    lm_sensors
    lpd
    lvm2-monitor
    mdmonitor
    mdmpd
    messagebus
    microcode_ctl
    multipathd
    network, ntpd
    readahead_early
    readahead_later
    restorecond
    rhnsd
    rsyslog
    rti
    sendmail
    smartd
    smb
    sshd
    syslog, 
    sysstat
    tfremote
    yum
    yum-updatesd
    zeedaisy
    PBEAgent</code></pre>

</ul>

<p>The list of allowed system services for RHEL7 is as follows:</p>

<ul>

<pre><code>    abrt-ccpp.service
    abrt-oops.service
    abrt-vmcore.service,
    abrt-xorg.service
    abrtd.service
    apcupsd.service
    atd.service
    auditd.service,
    crond.service
    cups.service,
    dbus-org.freedesktop.network1.service
    dbus-org.freedesktop.NetworkManager.service,
    dbus-org.freedesktop.nm-dispatcher.service,
    dmraid-activation.service,
    getty@.service,
    getty@tty1.service, getty@tty2.service, getty@tty3.service
    getty@tty4.service, getty@tty5.service, getty@tty6.service
    getty@tty7.service, getty@tty8.service, getty@tty9.service,
    getty@tty11.service
    httpd.service,
    iptables.service,
    irqbalance.service,
    kdump.service,
    libstoragemgmt.service,
    lvm2-monitor.service,
    mdmonitor.service,
    microcode.service,
    ntpd.service,
    rhsmcertd.service,
    rngd.service,
    rsyslog.service,
    sendmail.service
    sm-client.service
    smartd.service
    smb.service       
    sshd.service
    sysstat.service
    systemd-readahead-collect.service
    systemd-readahead-drop.service
    systemd-readahead-replay.service 
    tfremote.service
    tuned.service</code></pre>

</ul>

<p>The <code>--whitelist-enforce</code> command line option can be used to modify the behavior of the <code>--services</code> option for RHEL7 systems. Currently, on RHEL7 systems, the default behavour is to not enforce the system services &quot;whitelist&quot; since the final list of allowed system services has not yet been decided. By specifying <code>--whitelist-enforce</code>, the system services &quot;whitelist&quot; will be enforced as is done on RHEL5 and RHEL6. Note, enabling enforcement of the system services &quot;whitelist&quot; is also available as a config file statement. To enable enforcement, add the following line to the config file:</p>

<ul>

<p>whitelist-enforce=1</p>

</ul>

<p>The <code>--bastille</code> command line option no longer performas any changes, it is just present for backward compatability.</p>

<p>The <code>--logging|--logrotate</code> command line option modifies the log file rotation schedule so that log files are rotated on a monthly basis and only deleted after one year.</p>

<p>The log rotate conf files that are modified:</p>

<dl>

<dt id="etc-logrotate.conf"><code>/etc/logrotate.conf</code></dt>
<dd>

</dd>
<dt id="etc-logrotate.d-syslog"><code>/etc/logrotate.d/syslog</code></dt>
<dd>

</dd>
<dt id="etc-logrotate.d-httpd"><code>/etc/logrotate.d/httpd</code></dt>
<dd>

</dd>
<dt id="etc-logrotate.d-samba"><code>/etc/logrotate.d/samba</code></dt>
<dd>

</dd>
</dl>

<p>The <code>--ssh</code> command line option modifies the existing &quot;sshd&quot; config file by making the following changes: the &quot;ListenAddress&quot; is set to &quot;0.0.0.0&quot;, logins with the root account are disallowed over ssh, TCP forwarding is enabled, X11 forwarding is disabled, and password authentication is enabled.</p>

<p>The <code>--time</code> command line option adds &quot;clock.redhat.com&quot; and &quot;time.nist.gov&quot; to the &quot;/etc/ntp/step-tickers&quot; NTP config file and on RHEL5 and RHEL6, restarts the &quot;ntpd&quot; system service.</p>

<p>The <code>--ids</code> command line option no longer performas any changes, it is just present for backward compatability.</p>

<h1 id="FILES3">FILES</h1>

<dl>

<dt id="usr2-ostools-config-harden_linux.conf"><b>/usr2/ostools/config/harden_linux.conf</b></dt>
<dd>

</dd>
<dt id="d-ostools-config-harden_linux.conf"><b>/d/ostools/config/harden_linux.conf</b></dt>
<dd>

</dd>
<dt id="etc-sysconfig-iptables"><b>/etc/sysconfig/iptables</b></dt>
<dd>

</dd>
<dt id="etc-sysconfig-network"><b>/etc/sysconfig/network</b></dt>
<dd>

</dd>
<dt id="etc-modprobe.d-tf-disable-ipv6.conf"><b>/etc/modprobe.d/tf-disable-ipv6.conf</b></dt>
<dd>

</dd>
<dt id="etc-hosts.deny"><b>/etc/hosts.deny</b></dt>
<dd>

</dd>
<dt id="etc-hosts.allow"><b>/etc/hosts.allow</b></dt>
<dd>

</dd>
<dt id="etc-securetty"><b>/etc/securetty</b></dt>
<dd>

</dd>
<dt id="etc-security-limits.conf"><b>/etc/security/limits.conf</b></dt>
<dd>

</dd>
<dt id="etc-pamd.d-system-auth-teleflora"><b>/etc/pamd.d/system-auth-teleflora</b></dt>
<dd>

</dd>
<dt id="etc-pam.d-su"><b>/etc/pam.d/su</b></dt>
<dd>

</dd>
<dt id="etc-sudoers"><b>/etc/sudoers</b></dt>
<dd>

</dd>
<dt id="etc-logrotate.d-sudo"><b>/etc/logrotate.d/sudo</b></dt>
<dd>

</dd>
<dt id="etc-logrotate.d-syslog1"><b>/etc/logrotate.d/syslog</b></dt>
<dd>

</dd>
<dt id="etc-ssh-sshd_config"><b>/etc/ssh/sshd_config</b></dt>
<dd>

</dd>
<dt id="etc-ntp-step-tickers"><b>/etc/ntp/step-tickers</b></dt>
<dd>

</dd>
</dl>

<h1 id="DIAGNOSTICS2">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status:-0">Exit status: 0</dt>
<dd>

<p>Successful completion or when the &quot;--version&quot; and &quot;--help&quot; command line options are specified. Internal symbol: $EXIT_OK.</p>

</dd>
<dt id="Exit-status:-1">Exit status: 1</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line. Internal symbol: $EXIT_COMMAND_LINE.</p>

</dd>
<dt id="Exit-status:-2">Exit status: 2</dt>
<dd>

<p>For all command line options other than &quot;--version&quot; and &quot;--help&quot;, the user must be root or running under &quot;sudo&quot;. Internal symbol: $EXIT_MUST_BE_ROOT.</p>

</dd>
<dt id="Exit-status:-9">Exit status: 9</dt>
<dd>

<p>An error occurred converting the <code>sudoers</code> append directives in the config file from &quot;here documents&quot; and single files to a directory of <code>sudoers</code> config files. Internal symbol: $EXIT_CONVERT_CONFIG.</p>

</dd>
<dt id="Exit-status:-11">Exit status: 11</dt>
<dd>

<p>An error occurred reverting to the previous iptables config. Internal symbol: $EXIT_REVERT_IPTABLES.</p>

</dd>
<dt id="Exit-status:-12">Exit status: 12</dt>
<dd>

<p>An error occurred reverting to the previous sudo config. Internal symbol: $EXIT_REVERT_SUDO.</p>

</dd>
<dt id="Exit-status:-15">Exit status: 15</dt>
<dd>

<p>The script could not get the version number of the installed OSTools. Internal symbol: $EXIT_OSTOOLS_VERSION.</p>

</dd>
<dt id="Exit-status:-20">Exit status: 20</dt>
<dd>

<p>An error occurred configuring iptables. Internal symbol: $EXIT_IPTABLES.</p>

</dd>
<dt id="Exit-status:-21">Exit status: 21</dt>
<dd>

<p>An error occurred disabling IPv6. Internal symbol: $EXIT_IPV6.</p>

</dd>
<dt id="Exit-status:-22">Exit status: 22</dt>
<dd>

<p>An error occurred generating a new /etc/hosts.allow file. Internal symbol: $EXIT_HOSTS_ALLOW.</p>

</dd>
<dt id="Exit-status:-23">Exit status: 23</dt>
<dd>

<p>An error occurred configuring PAM rules. Internal symbol: $EXIT_PAM.</p>

</dd>
<dt id="Exit-status:-24">Exit status: 24</dt>
<dd>

<p>An error occurred generating a new /etc/sudoers file. Internal symbol: $EXIT_SUDO.</p>

</dd>
<dt id="Exit-status:-25">Exit status: 25</dt>
<dd>

<p>An error occurred configuring allowed system services. Internal symbol: $EXIT_SERVICES.</p>

</dd>
<dt id="Exit-status:-26">Exit status: 26</dt>
<dd>

<p>An error occurred removing the SETUID bit from certain programs or removing the &quot;rsh&quot; programs. Internal symbol: $EXIT_BASTILLE.</p>

</dd>
<dt id="Exit-status:-27">Exit status: 27</dt>
<dd>

<p>An error occurred configuring the log file rotation schedule. Internal symbol: $EXIT_LOGGING.</p>

</dd>
<dt id="Exit-status:-28">Exit status: 28</dt>
<dd>

<p>An error occurred modifying the sshd config file. Internal symbol: $EXIT_SSH.</p>

</dd>
<dt id="Exit-status:-29">Exit status: 29</dt>
<dd>

<p>An error occurred generating the NTP server config file. Internal symbol: $EXIT_TIME.</p>

</dd>
<dt id="Exit-status:-30">Exit status: 30</dt>
<dd>

<p>An error occurred updating the Aide intrusion detection system database. Internal symbol: $EXIT_IDS.</p>

</dd>
</dl>

<h1 id="BUGS">BUGS</h1>

<p>The iptables configuration currently only supports the 192.168.0.0/24, 10.0.0.0/8, and 172.16.0.0/12 networks.</p>

<h1 id="SEE-ALSO3">SEE ALSO</h1>

<p>/var/log/messages, /var/log/secure</p>

<h1 id="NAME4">NAME</h1>

<p><b>install-ostools.pl</b> - OSTools Package Installer</p>

<h1 id="VERSION4">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.64 $</p>

<h1 id="USAGE3">USAGE</h1>

<p><b>install-ostools.pl</b> <b>--version</b></p>

<p><b>install-ostools.pl</b> <b>--help</b></p>

<p><b>install-ostools.pl</b> (<b>--rti-patches</b> | <b>--daisy-patches</b>)</p>

<p><b>install-ostools.pl</b> [<b>--[no]harden-linux</b>] <b>--update</b> [(<i>URL</i> | <i>path</i>)]</p>

<p><b>install-ostools.pl</b> <b>--update</b> [(<i>URL</i> | <i>path</i>)]</p>

<h1 id="OPTIONS4">OPTIONS</h1>

<dl>

<dt id="version4"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help4"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="rti-patches"><b>--rti-patches</b></dt>
<dd>

<p>Install any RTI patches.</p>

</dd>
<dt id="daisy-patches"><b>--daisy-patches</b></dt>
<dd>

<p>Install any Daisy patches.</p>

</dd>
<dt id="update"><b>--update</b></dt>
<dd>

<p>Install the the OSTools package.</p>

</dd>
<dt id="no-harden-linux"><b>--[no]harden-linux</b></dt>
<dd>

<p>Run the <b>harden-linux.pl</b> script after installation.</p>

</dd>
</dl>

<h1 id="DESCRIPTION4">DESCRIPTION</h1>

<p>The <b>install-ostools.pl</b> script installs the OSTools package on a Red Hat Enterprise Linux server.</p>

<p>The major parts of the installed package consist of:</p>

<dl>

<dt id="README-file">README file</dt>
<dd>

</dd>
<dt id="Scripts">Scripts</dt>
<dd>

</dd>
<dt id="Config-files">Config files</dt>
<dd>

</dd>
<dt id="Modules">Modules</dt>
<dd>

</dd>
</dl>

<p>The package is installed with a top level folder named <code>ostools</code> which is located in the directory <code>/usr2</code> on RTI systems and in <code>/d</code> on Daisy systems. The scripts are located in <code>ostools/bin</code>, the config files in <code>ostools/config</code>, and the modules are in <code>ostools/modules</code>.</p>

<p>The latest release of this package can always be downloaded to the system via the following commands:</p>

<pre><code> $ cd /tmp
 $ package_name=ostools-latest.tar.gz
 $ url=http://rtihardware.homelinux.com/ostools
 $ curl -o $package_name $url/$package_name</code></pre>

<p>Then, to install the package, run the following commands:</p>

<pre><code> $ tar xf $package_name
 $ sudo perl bin/install-ostools.pl --update $package_name</code></pre>

<p>Installation will have the side effect of the <b>harden_linux.pl</b> script running and thus possibly changing the system configuration. If installation of the OSTools package without running <b>harden_linux.pl</b> is desired, specify the <b>--noharden-linux</b> option:</p>

<pre><code> $ sudo perl bin/install-ostools.pl --noharden-linux --update $package_name</code></pre>

<p>After the scripts are installed, if there is a POS installed, then the appropriate &quot;perms&quot; script is run, <b>rtiperms.pl</b> on a RTI system, and <b>dsyperms.pl</b> on a Daisy system.</p>

<h2 id="COMMAND-LINE-OPTIONS1">COMMAND LINE OPTIONS</h2>

<p>Specify the <b>--rti-patches</b> command line option to install any RTI patches.</p>

<p>Specify the <b>--daisy-patches</b> command line option to install any Daisy patches.</p>

<p>Specify the <b>--update</b> command line option to install the OSTools package.</p>

<p>Specify the <b>--[no]harden-linux</b> command line option to run the <b>harden_linux.pl</b> script after installation of the OSTools package. Since the default behavior is to run the <b>harden_linux.pl</b> script, this option is actually provided as a way to prevent running the <b>harden_linux.pl</b> script.</p>

<h1 id="FILES4">FILES</h1>

<dl>

<dt id="http:-rtihardware.homelinux.com-ostools-ostools-1.14-latest.tar.gz"><code>http://rtihardware.homelinux.com/ostools/ostools-1.14-latest.tar.gz</code></dt>
<dd>

<p>This URL will always point at the latest release of the OSTools 1.14 package.</p>

</dd>
<dt id="usr2-bbx"><code>/usr2/bbx</code></dt>
<dd>

<p>If this directory exists, then it is assumed that the system has the RTI POS installed.</p>

</dd>
<dt id="d-daisy2"><code>/d/daisy</code></dt>
<dd>

<p>If this directory exists, then it is assumed that the system has the Daisy POS installed.</p>

</dd>
<dt id="usr2-ostools-bin"><code>/usr2/ostools/bin</code></dt>
<dd>

<p>On RTI systems, the OSTools scripts will be installed in this directory.</p>

</dd>
<dt id="usr2-ostools-config"><code>/usr2/ostools/config</code></dt>
<dd>

<p>On RTI systems, the OSTools config files are located in this directory.</p>

</dd>
<dt id="usr2-ostools-modules"><code>/usr2/ostools/modules</code></dt>
<dd>

<p>The OSTools modules directory for RTI systems.</p>

</dd>
<dt id="d-ostools-bin2"><code>/d/ostools/bin</code></dt>
<dd>

<p>On Daisy systems, the OSTools scripts will be installed in this directory.</p>

</dd>
<dt id="d-ostools-config1"><code>/d/ostools/config</code></dt>
<dd>

<p>On Daisy systems, the OSTools config files are located in this directory.</p>

</dd>
<dt id="d-ostools-modules"><code>/d/ostools/modules</code></dt>
<dd>

<p>The OSTools modules directory for Daisy systems.</p>

</dd>
<dt id="etc-redhat-release1"><code>/etc/redhat-release</code></dt>
<dd>

<p>The contents of this file are used to determine the version of Linux.</p>

</dd>
<dt id="var-log-messages1"><code>/var/log/messages</code></dt>
<dd>

<p>Log messages are written to this log file via the <b>logger(1)</b> command.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS3">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-0-EXIT_OK1">Exit status 0 ($EXIT_OK)</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1-EXIT_COMMAND_LINE1">Exit status 1 ($EXIT_COMMAND_LINE)</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
<dt id="Exit-status-2-EXIT_MUST_BE_ROOT1">Exit status 2 ($EXIT_MUST_BE_ROOT)</dt>
<dd>

<p>For all command line options other than <b>--version</b> and <b>--help</b>, the user must be root or running under <b>sudo</b>.</p>

</dd>
<dt id="Exit-status-3-EXIT_OSTOOLS_BIN_DIR">Exit status 3 ($EXIT_OSTOOLS_BIN_DIR)</dt>
<dd>

<p>The directory that the OSTools scripts are to be installed into does not exist.</p>

</dd>
<dt id="Exit-status-4-EXIT_RTI_PATCHES">Exit status 4 ($EXIT_RTI_PATCHES)</dt>
<dd>

<p>In error occurred installing RTI patches.</p>

</dd>
<dt id="Exit-status-5-EXIT_DAISY_PATCHES">Exit status 5 ($EXIT_DAISY_PATCHES)</dt>
<dd>

<p>In error occurred installing DAISY patches.</p>

</dd>
<dt id="Exit-status-6-EXIT_DOWNLOAD">Exit status 6 ($EXIT_DOWNLOAD)</dt>
<dd>

<p>An error occurred downloading the OSTools package.</p>

</dd>
<dt id="Exit-status-7-EXIT_UNTAR">Exit status 7 ($EXIT_UNTAR)</dt>
<dd>

<p>An error occurred untarring the OSTools package file.</p>

</dd>
</dl>

<h1 id="SEE-ALSO4">SEE ALSO</h1>

<p><b>logger(1)</b>, <b>rtiperms.pl</b>, <b>dsyperms.pl</b></p>

<h1 id="NAME5">NAME</h1>

<p>rtibackup.pl - OSTools backup script for RTI and Daisy</p>

<h1 id="VERSION5">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.367 $</p>

<h1 id="OPTIONS5">OPTIONS</h1>

<dl>

<dt id="version5"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help5"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="install2"><b>--install</b></dt>
<dd>

<p>Install the script.</p>

</dd>
<dt id="backup-s"><b>--backup=s</b></dt>
<dd>

<p>Perform a backup.</p>

<p>Modifiers: <b>--device=s</b>, <b>--usb-device</b>, <b>--compress</b>, <b>--nocc</b>, <b>--cryptkey=s</b>, <b>--rti</b>, and <b>--daisy</b>.</p>

</dd>
<dt id="restore-s"><b>--restore=s</b></dt>
<dd>

<p>Restore files from a backup.</p>

<p>Modifiers: <b>--device</b>, <b>--usb-device</b>, <b>--restore-exclude=s</b>, <b>--decompress</b>, <b>--cryptkey=s</b>, <b>--force</b>, <b>--rootdir=s</b>, <b>--[no]harden-linux</b>, <b>--dry-run</b> and <b>--upgrade</b>.</p>

</dd>
<dt id="list-s"><b>--list=s</b></dt>
<dd>

<p>List the files in a backup.</p>

<p>Modifiers: <b>--device</b>, <b>--usb-device</b>, <b>--rti</b> and <b>--daisy</b>.</p>

</dd>
<dt id="verify"><b>--verify</b></dt>
<dd>

<p>Verify a backup.</p>

<p>Modifiers: <b>--console</b>, <b>--[no]autocheckmedia</b>, <b>--verbose</b>, <b>--rti</b>, and <b>--daisy</b>.</p>

</dd>
<dt id="checkmedia"><b>--checkmedia</b></dt>
<dd>

<p>Check the media of a backup device. May be used with <b>--backup=s</b>.</p>

<p>Modifiers: <b>--checkmedia</b>, <b>--email=s</b>, and <b>--printer=s</b>.</p>

</dd>
<dt id="format"><b>--format</b></dt>
<dd>

<p>Format the backup device. May be used with <b>--backup=s</b>.</p>

<p>Modifiers: <b>--force</b>, and <b>--verbose</b>.</p>

</dd>
<dt id="eject"><b>--eject</b></dt>
<dd>

<p>Eject the media from a backup device.</p>

</dd>
<dt id="finddev"><b>--finddev</b></dt>
<dd>

<p>Find a backup device and report it&#39;s device special file.</p>

</dd>
<dt id="getinfo"><b>--getinfo</b></dt>
<dd>

<p>Get and report info about the backups on a backup device.</p>

</dd>
<dt id="showkey"><b>--showkey</b></dt>
<dd>

<p>Output the encryption key.</p>

<p>Modifers: <b>--cryptkey=s</b>.</p>

</dd>
<dt id="validate-cryptkey"><b>--validate-cryptkey</b></dt>
<dd>

<p>Verify that the encryption key will actually decrypt the backup files.</p>

<p>Modifers: <b>--cryptkey=s</b>.</p>

</dd>
<dt id="mount"><b>--mount</b></dt>
<dd>

<p>Mount a backup device.</p>

</dd>
<dt id="unmount---umount"><b>--unmount|--umount</b></dt>
<dd>

<p>Unmount a backup device.</p>

<p>Modifers: <b>--verbose</b>.</p>

</dd>
<dt id="report-configfile"><b>--report-configfile</b></dt>
<dd>

<p>Parse the config file, and report it&#39;s contents.</p>

</dd>
<dt id="report-is-backup-enabled"><b>--report-is-backup-enabled</b></dt>
<dd>

<p>Report whether the backup script is installed and enabled.</p>

</dd>
<dt id="checkfile-args-args"><b>--checkfile args [args ...]</b></dt>
<dd>

<p>Verify the files listed as command arguments.</p>

</dd>
<dt id="rti"><b>--rti</b></dt>
<dd>

<p>Modifier: specify that the system is a RTI system.</p>

</dd>
<dt id="daisy1"><b>--daisy</b></dt>
<dd>

<p>Modifier: specify that the system is a Daisy system.</p>

</dd>
<dt id="email-s"><b>--email=s</b></dt>
<dd>

<p>Modifier: specifies a list of email addresses.</p>

</dd>
<dt id="printer-s"><b>--printer=s</b></dt>
<dd>

<p>Modifier: specifies a list of printer names.</p>

</dd>
<dt id="rootdir-s"><b>--rootdir=s</b></dt>
<dd>

<p>Modifier: specifies the destination directory for restore; used as the <b>-C=dir</b> option for the tar(1) command.</p>

</dd>
<dt id="configfile-s"><b>--configfile=s</b></dt>
<dd>

<p>Modifier: specifies the path to the config file.</p>

</dd>
<dt id="logfile-s"><b>--logfile=s</b></dt>
<dd>

<p>Modifier: specifies the path to the logfile.</p>

</dd>
<dt id="restore-exclude-s"><b>--restore-exclude=s</b></dt>
<dd>

<p>Modifier: specifiesy a list of files to exclude from a restore.</p>

</dd>
<dt id="device-s"><b>--device=s</b></dt>
<dd>

<p>Modifier: specifies the path to the device special file for the backup device.</p>

</dd>
<dt id="device-vendor-s"><b>--device-vendor=s</b></dt>
<dd>

<p>Modifier: specifies the vendor name of the backup device.</p>

</dd>
<dt id="device-model-s"><b>--device-model=s</b></dt>
<dd>

<p>Modifier: specifies the model name of the backup device.</p>

</dd>
<dt id="usb-device"><b>--usb-device</b></dt>
<dd>

<p>Modifier: use a disk plugged into the USB bus which has been formatted with <b>--format</b> as the backup device.</p>

</dd>
<dt id="compress"><b>--compress</b></dt>
<dd>

<p>Modifier: compress the files when writing to the backup device.</p>

</dd>
<dt id="decompress"><b>--decompress</b></dt>
<dd>

<p>Modifier: decompress the files when reading from the backup device.</p>

</dd>
<dt id="keep-old-files"><b>--keep-old-files</b></dt>
<dd>

<p>Modifer: don&#39;t overwrite files when doing a restore.</p>

</dd>
<dt id="upgrade"><b>--upgrade</b></dt>
<dd>

<p>Modifier: perform extra operations when doing a restore.</p>

</dd>
<dt id="dry-run1"><b>--dry-run</b></dt>
<dd>

<p>Modifer: report what an operation would do but don&#39;t actually do it.</p>

</dd>
<dt id="verbose1"><b>--verbose</b></dt>
<dd>

<p>Modifier: report extra information.</p>

</dd>
<dt id="no-autocheckmedia"><b>--[no]autocheckmedia</b></dt>
<dd>

<p>Modifier: don&#39;t check media on errors during a backup.</p>

</dd>
<dt id="no-harden-linux1"><b>--[no]harden-linux</b></dt>
<dd>

<p>Modifier: don&#39;t run the harden_linux.pl script.</p>

</dd>
</dl>

<h1 id="DESCRIPTION5">DESCRIPTION</h1>

<p>This <i>rtibackup.pl</i> script is used to backup and restore data for a Teleflora RTI or Daisy Point of Sale system. It is essentially an elaborate front end to the tar(1) command which does the real work of reading and writing the data files. Due to the complexity of the requirements, there are many options and many ways that the script can be used.</p>

<h2 id="Command-Line-Options">Command Line Options</h2>

<p>The <b>--install</b> command line option performs all the steps necessary to install the &quot;rtibackup.pl&quot; script onto the system. First, the script is copied to the OSTools bin directory, and it&#39;s file owner, group, and perms are set. Then, a symlink is made from the POS bin directory pointing to the script in the OSTools bin directory. Next, the cron job file is installed. If any old style cron job files exist, they are removed. The new cron job file named &quot;nightly-backup&quot; is generated and copied into directory &quot;/etc/cron.d&quot;. However, if there is an existing cron job file in &quot;/etc/cron.d&quot;, then the cron job file is copied to the OSTools config directory instead.</p>

<p>The <b>--restore=s</b> command line option restores file from a backup. The options <b>--restore-exclude=s</b>, <b>--cryptkey=s</b>, <b>--force</b>, and <b>--rootdir=s</b> may be used with <b>--restore</b>.</p>

<p>The <b>--harden-linux|--noharden-linux</b> command line option provides a way to specify whether or not the &quot;harden_linux.pl&quot; script should be run by the &quot;rtibackup.pl&quot; script. The default behavior for &quot;rtibackup.pl&quot; is to run &quot;harden_linux.pl&quot; after performing any of the following restore types: &quot;all&quot;, &quot;rticonfigs&quot;, &quot;daisy&quot;, &quot;daisyconfigs&quot;, &quot;osconfigs&quot; and &quot;netconfigs&quot;. The &quot;harden&quot; script will only be run once after all restores are finished. To prevent harden_linux.pl from running, specify the following option: &quot;--noharden-linux&quot;.</p>

<h2 id="Definition-of-Installed-and-Enabled">Definition of Installed and Enabled</h2>

<p>The <b>--report-is-backup-enabled</b> runs through an algorithm to determine if the backup script is installed and enabled. The definition of &quot;installed and enabled&quot; is:</p>

<ol>

<li><p>the <code>rtibackup.pl</code> script exists in OSTools bin directory.</p>

</li>
<li><p>a symlink for the <code>rtibackup.pl</code> script exists in the RTI or Daisy bin directory which points to the actual script in the OSTools bin directory.</p>

</li>
<li><p>the mount point exists.</p>

</li>
<li><p>the cron job file exists and the line which executes <code>rtibackup.pl</code> is not commented out.</p>

</li>
</ol>

<h2 id="Daisy-Logevents">Daisy Logevents</h2>

<p>When run on a Daisy system and the <b>--backup</b> command line option is specified, the <code>rtibackup.pl</code> script is coded to send a Daisy &quot;logevent&quot; indicating either success or failure of the backup. If the backup was successful, only a Daisy &quot;logevent&quot; is sent to the Daisy system, with a message stating that the backup succeeded and includes the Linux device name. If the backup failed, a Daisy &quot;action&quot; is sent to the Daisy system, with a message stating that the backup failed, includes the Linux device name, and provides advice on how to address the issue. Also, a Daisy &quot;logevent&quot; is sent to the Daisy system, with a message stating that the backup failed and includes the Linux device name.</p>

<h2 id="Sending-Email">Sending Email</h2>

<p>The <code>rtibackup.pl</code> script can be configured to send email depending on one of several conditions. First, described below is when an email message is sent, and second, how an email message is sent.</p>

<dl>

<dt id="Backup-device-not-found">Backup device not found</dt>
<dd>

<p>If there are email recipients specified on the command line or in the config file, and a backup device is not found, an error message will be sent to each of the recipients.</p>

</dd>
<dt id="Verify-Status">Verify Status</dt>
<dd>

<p>If there are email recipients specified on the command line or in the config file, and the <code>--verify</code> command line option is specified along with the <code>--backup</code> command line option, then a status message will be sent to each of the recipients. Note that the default cron job installed by the script specifies both <code>--backup</code> and <code>--verify</code> on the command line invoking <code>rtibackup.pl</code> so the default case is that an email message will be sent after the backups are completed each night.</p>

</dd>
<dt id="Checkmedia-Results">Checkmedia Results</dt>
<dd>

<p>If there are email recipients specified on the command line or in the config file, and the <code>--checkmedia</code> command line option is specified and the <code>--backup</code> command line option is NOT specified, then a message containing the results of the checkmedia will be sent to each of the recipients.</p>

</dd>
</dl>

<p>Given that one or more email recipients are specified, and one of the conditions upon which the script will attempt to send an email message occurs, then the message can be sent one of the following 3 methods.</p>

<dl>

<dt id="Sendmail">Sendmail</dt>
<dd>

<p>If the <code>email_server</code> config file statement is specified with a value of <code>sendmail</code>, then any email messages sent by the script will directly invoke the <code>/usr/lib/sendmail -oi -t</code> program with a from address of <code>rtibackup.pl@HOSTNAME.teleflora.com</code> where HOSTNAME will be substituted with the hostname of the system.</p>

</dd>
<dt id="SMTP-Server">SMTP Server</dt>
<dd>

<p>If the <code>email_server</code> config file statement is specified with a value of the FQDN of an SMTP server, and the <code>email_user</code> and <code>email_password</code> config file statements have valid credentials for the specified SMTP server, then any email messages sent by the script will use the Perl module <code>Net::SMTP</code> with a from address of <code>backups@HOSTNAME</code> where HOSTNAME will be substituted with the hostname of the system.</p>

</dd>
<dt id="MUTT">MUTT</dt>
<dd>

<p>If the <code>email_server</code> config file statement is NOT specified in the config file, the message will be sent via the <code>mutt</code> command with a from address of <code>tfsupport@HOSTNAME</code> where, HOSTNAME will be substituted with the hostname of the system.</p>

</dd>
</dl>

<h1 id="EXAMPLES1">EXAMPLES</h1>

<p>During a backup of types &quot;all&quot; or &quot;osconfigs&quot;, a backup of the complete <i>/etc</i> sub-tree is written to the backup device. It is sometimes useful to reference or restore one file from this copy of <i>/etc</i>. When retrieving a file from the backup of <i>/etc</i>, it&#39;s generally a good idea a temporary directory to hold the extracted files. Thus, the <i>rtibackup.pl</i> script is directed to write the file to the temporary directory via the use of the <i>--rootdir</i> command line option. The command line to restore a single file from the backup of <i>/etc</i>, for example <i>/etc/sysconfig/tfremote</i>, enter the following command:</p>

<pre><code> sudo rtibackup.pl --rootdir=/tmp --restore /etc/sysconfig/tfremote </code></pre>

<p>There are several issues to take note of: first, if the <i>rtibackup.pl</i> script is not in your <code>$PATH</code>, then you will have to specify the whole path to the script; second, it takes longer to restore from <i>/etc</i> than other restore types since the script looks in every backup set on the backup device and does not stop when the file is found - even after finding the file, it continues on through all the remaining backup types. The restored file will be found in <i>/tmp/etc/sysconfig/tfremote</i>. The file can be referenced at that path and copied into it&#39;s actual spot in the <i>/etc</i> sub-tree as desired.</p>

<h1 id="FILES5">FILES</h1>

<dl>

<dt id="usr2-bbx-bin-and-d-daisy-bin"><b>/usr2/bbx/bin</b> and <b>/d/daisy/bin</b></dt>
<dd>

<p>The path to the bin directory for RTI and Daisy systems respectively.</p>

</dd>
<dt id="usr2-ostools-bin-and-d-ostools-bin"><b>/usr2/ostools/bin</b> and <b>/d/ostools/bin</b></dt>
<dd>

<p>The path to the OSTools bin directory for RTI and Daisy systems respectively.</p>

</dd>
<dt id="usr2-ostools-config-and-d-ostools-config"><b>/usr2/ostools/config</b> and <b>/d/ostools/config</b></dt>
<dd>

<p>The path to the OSTools config directory for RTI and Daisy system respectively.</p>

</dd>
<dt id="etc-cron.d-nightly-backup"><b>/etc/cron.d/nightly-backup</b></dt>
<dd>

<p>The path to the cron job file.</p>

</dd>
<dt id="mnt-backups"><b>/mnt/backups</b></dt>
<dd>

<p>Mount point for backup device.</p>

</dd>
<dt id="etc-redhat-release2"><b>/etc/redhat-release</b></dt>
<dd>

<p>Contents determines OS type, and is used for validating crypt key.</p>

</dd>
<dt id="sys-block-sda-sdb-sdc-sde-sdd-device-vendor"><b>/sys/block/{sda,sdb,sdc,sde,sdd}/device/vendor</b></dt>
<dd>

<p>This file contains the vendor string for the block device, ie disk, that has special device file &quot;/dev/sda&quot;, or &quot;/dev/sdb&quot;, etc.</p>

</dd>
<dt id="sys-block-sda-sdb-sdc-sde-sdd-device-model"><b>/sys/block/{sda,sdb,sdc,sde,sdd}/device/model</b></dt>
<dd>

<p>This file contains the model string for the block device, ie disk, that has special device file &quot;/dev/sda&quot;, or &quot;/dev/sdb&quot;, etc.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS4">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-0-EXIT_OK2">Exit status 0 ($EXIT_OK)</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1-EXIT_COMMAND_LINE2">Exit status 1 ($EXIT_COMMAND_LINE)</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
<dt id="Exit-status-2-EXIT_PLATFORM">Exit status 2 ($EXIT_PLATFORM)</dt>
<dd>

<p>Unknown operating system.</p>

</dd>
<dt id="Exit-status-3-EXIT_ROOTDIR">Exit status 3 ($EXIT_ROOTDIR)</dt>
<dd>

<p>The directory specified for <b>--rootdir</b> does not exist.</p>

</dd>
<dt id="Exit-status-4-EXIT_TOOLSDIR">Exit status 4 ($EXIT_TOOLSDIR)</dt>
<dd>

<p>The OSTools directory does not exist.</p>

</dd>
<dt id="Exit-status-5-EXIT_BACKUP_DEVICE_NOT_FOUND">Exit status 5 ($EXIT_BACKUP_DEVICE_NOT_FOUND)</dt>
<dd>

<p>A backup device of any kind was not found.</p>

</dd>
<dt id="Exit-status-6-EXIT_USB_DEVICE_NOT_FOUND">Exit status 6 ($EXIT_USB_DEVICE_NOT_FOUND)</dt>
<dd>

<p>The <b>--usb-device</b> option was specified but a USB backup device was not found.</p>

</dd>
<dt id="Exit-status-7-EXIT_BACKUP_TYPE">Exit status 7 ($EXIT_BACKUP_TYPE)</dt>
<dd>

<p>The backup type specified with <b>--backup</b> is not supported.</p>

</dd>
<dt id="Exit-status-10-EXIT_LIST">Exit status 10 ($EXIT_LIST)</dt>
<dd>

<p>The backup type specified with <b>--list</b> was not recognized.</p>

</dd>
<dt id="Exit-status-11-EXIT_DEVICE_VERIFY">Exit status 11 ($EXIT_DEVICE_VERIFY)</dt>
<dd>

<p>The specified backup device is either not a block device or is not an image file of minimum size.</p>

</dd>
<dt id="Exit-status-12-EXIT_USB_DEVICE_UNSUPPORTED">Exit status 12 ($EXIT_USB_DEVICE_UNSUPPORTED)</dt>
<dd>

<p>USB devices other than WD Passports are not supported on RHEL4.</p>

</dd>
<dt id="Exit-status-13-EXIT_MOUNT_POINT">Exit status 13 ($EXIT_MOUNT_POINT)</dt>
<dd>

<p>The default mount point for the backup device did not exist and one could not be made.</p>

</dd>
<dt id="Exit-status-14-EXIT_IS_BACKUP_ENABLED">Exit status 14 ($EXIT_IS_BACKUP_ENABLED)</dt>
<dd>

<p>It could not be determined if the <code>rtibackup.pl</code> script was enabled or not.</p>

</dd>
<dt id="Exit-status-23-EXIT_SAMBA_CONF">Exit status 23 ($EXIT_SAMBA_CONF)</dt>
<dd>

<p>An error occurred while modifying one of the Samba conf files.</p>

</dd>
</dl>

<h1 id="SEE-ALSO5">SEE ALSO</h1>

<p>tar(1), openssl(1)</p>

<h1 id="NAME6">NAME</h1>

<p>rtiuser.pl - Manage RTI User Accounts</p>

<h1 id="VERSION6">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.13 $</p>

<h1 id="USAGE4">USAGE</h1>

<p>rtiuser.pl</p>

<p>rtiuser.pl <b>--version</b></p>

<p>rtiuser.pl <b>--help</b></p>

<p>rtiuser.pl <b>--list</b></p>

<p>rtiuser.pl <b>--info username</b></p>

<p>rtiuser.pl <b>--add username</b></p>

<p>rtiuser.pl <b>--remove username</b></p>

<p>rtiuser.pl <b>--update username</b></p>

<p>rtiuser.pl <b>--lock username</b></p>

<p>rtiuser.pl <b>--unlock username</b></p>

<p>rtiuser.pl <b>--resetpw username [password]</b></p>

<p>rtiuser.pl <b>--enable-admin username [password]</b></p>

<p>rtiuser.pl <b>--disable-admin username</b></p>

<h1 id="OPTIONS6">OPTIONS</h1>

<dl>

<dt id="version6"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help6"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="list"><b>--list</b></dt>
<dd>

<p>List the current RTI users and admins.</p>

</dd>
<dt id="info-username"><b>--info username</b></dt>
<dd>

<p>Get information about the specified user.</p>

</dd>
<dt id="add-username"><b>--add username</b></dt>
<dd>

<p>Add the specified user to the system as an RTI user.</p>

</dd>
<dt id="remove-username"><b>--remove username</b></dt>
<dd>

<p>Remove the specified user from the system.</p>

</dd>
<dt id="update-username"><b>--update username</b></dt>
<dd>

<p>Update the settings for the specified user.</p>

</dd>
<dt id="lock-username"><b>--lock username</b></dt>
<dd>

<p>Disable, but do not remove, the account of the specified user.</p>

</dd>
<dt id="unlock-username"><b>--unlock username</b></dt>
<dd>

<p>Enable the account of the specified user but do not modify the password.</p>

</dd>
<dt id="resetpw-username-password"><b>--resetpw username [password]</b></dt>
<dd>

<p>Reset the password for the specified user, either interactively or optionally from the command line.</p>

</dd>
<dt id="enable-admin-username-password"><b>--enable-admin username [password]</b></dt>
<dd>

<p>Grant the specified RTI user &#39;admin&#39; privileges.</p>

</dd>
<dt id="disable-admin-username"><b>--disable-admin username</b></dt>
<dd>

<p>Remove &#39;admin&#39; privileges from the specified RTI user.</p>

</dd>
</dl>

<h1 id="DESCRIPTION6">DESCRIPTION</h1>

<p>This <code>rtiuser.pl</code> script manages many aspects of RTI user accounts on the system including adding and removing users, setting their passwords, enabling/disabling accounts, and enabling/disabling &#39;admin&#39; privs.</p>

<p>When adding a new <code>rti</code> user via <code>--add username</code> option, the new account will also be added to the following system groups:</p>

<dl>

<dt id="rti1"><code>rti</code></dt>
<dd>

</dd>
<dt id="floppy1"><code>floppy</code></dt>
<dd>

</dd>
<dt id="lp1"><code>lp</code></dt>
<dd>

</dd>
<dt id="lock1"><code>lock</code></dt>
<dd>

</dd>
</dl>

<p>On <code>RHEL5</code> and <code>RHEL6</code>, it will also be added to the <code>uucp</code> group.</p>

<p>On <code>RHEL6</code> and <code>RHEL7</code>, it will also be added to the <code>dialout</code> group.</p>

<p>When granting &#39;admin&#39; privs with the <code>--enable-admin username</code> option, the user <code>rti</code> may not be specified as the username.</p>

<h1 id="FILES6">FILES</h1>

<dl>

<dt id="var-log-faillog"><code>/var/log/faillog</code></dt>
<dd>

<p>The log file for recording login failures on platforms that do not not the <code>/sbin/pam_tally2</code> command.</p>

</dd>
<dt id="var-log-tallylog"><code>/var/log/tallylog</code></dt>
<dd>

<p>The log file for recording login failures on platforms that do have the <code>/sbin/pam_tally2</code> command.</p>

</dd>
<dt id="var-log-messages2"><code>/var/log/messages</code></dt>
<dd>

<p>The default log file. Log file messages are written via the <code>logger</code> command.</p>

</dd>
<dt id="bash_profile1"><code>~/.bash_profile</code></dt>
<dd>

<p>This <code>bash</code> startup script is modified by the <code>--add</code>, <code>--update</code>, <code>--enable-admin</code>, and <code>--disable-admin</code> options.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS5">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-02">Exit status 0</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-11">Exit status 1</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line. Specifically, if the username <code>rti</code> was specified with the <code>--enable-admin</code> option.</p>

</dd>
<dt id="Exit-status-21">Exit status 2</dt>
<dd>

<p>For all command line options other than <code>--version</code> and <code>--help</code>, the user must be root or running under <code>sudo</code>.</p>

</dd>
<dt id="Exit-status-3">Exit status 3</dt>
<dd>

<p>The specified username did not pass validation, eg it may have had characters that are considered a security issue.</p>

</dd>
<dt id="Exit-status-4">Exit status 4</dt>
<dd>

<p>The specified password did not pass validation, eg it may have had characters that are considered a security issue.</p>

</dd>
</dl>

<h1 id="SEE-ALSO6">SEE ALSO</h1>

<p><code>chage(1)</code>, <code>faillog(1)</code>, <code>pam_tally2(1)</code>, <code>useradd(1)</code>, <code>usermod(1)</code></p>

<h1 id="NAME7">NAME</h1>

<p>tfinfo.pl - report information about the Teleflora Daisy POS</p>

<h1 id="VERSION7">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.9 $</p>

<h1 id="USAGE5">USAGE</h1>

<p>tfinfo.pl [<b>--rti</b>] [<b>--daisy</b>]</p>

<p>tfinfo.pl <b>--version</b></p>

<p>tfinfo.pl <b>--help</b></p>

<h1 id="OPTIONS7">OPTIONS</h1>

<dl>

<dt id="version7"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help7"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="rti2"><b>--rti</b></dt>
<dd>

<p>Report info on a RTI POS</p>

</dd>
<dt id="daisy2"><b>--daisy</b></dt>
<dd>

<p>Report info on a Daisy POS</p>

</dd>
</dl>

<h1 id="DESCRIPTION7">DESCRIPTION</h1>

<p>The <i>tfinfo.pl</i> script gathers information about a RTI or Daisy system, such as Dove activity, the florist directory release date, the TCC version number, and POS application version number, and writes a short summary to stdout.</p>

<p>The script <code>identify_daisy_distro.pl</code> is used to get the Daisy version number.</p>

<p>On RTI systems, the file <code>/usr2/bbx/tcc_tws</code> is used to get the version of TCC.</p>

<p>On Daisy systems, the fine <code>/d/daisy/tcc/tcc</code> is used to get the version of TCC.</p>

<h1 id="EXAMPLE">EXAMPLE</h1>

<p>The output looks like this:</p>

<pre><code>    $ perl tfinfo.pl
    Teleflora Dove ID: 01234500
    Teleflora florist directory release: Sep 2015
    TCC version: 1.8.3
    Daisy version: 9.3.15</code></pre>

<h1 id="FILES7">FILES</h1>

<dl>

<dt id="usr2-bbx-bbxd-RTI.ini"><b>/usr2/bbx/bbxd/RTI.ini</b></dt>
<dd>

<p>The RTI application &quot;ini&quot; file - contains the RTI version number.</p>

</dd>
<dt id="usr2-bbx-bbxd-ONRO01"><b>/usr2/bbx/bbxd/ONRO01</b></dt>
<dd>

<p>The RTI file which contains the RTI florist directory release date.</p>

</dd>
<dt id="usr2-bbx-config-dove.ini"><b>/usr2/bbx/config/dove.ini</b></dt>
<dd>

<p>The RTI file which contains the Teleflora shop id.</p>

</dd>
<dt id="d-daisy-control.dsy1"><b>/d/daisy/control.dsy</b></dt>
<dd>

<p>The Daisy control file.</p>

</dd>
<dt id="d-daisy-control.tel"><b>/d/daisy/control.tel</b></dt>
<dd>

<p>The Daisy edir control file.</p>

</dd>
<dt id="d-daisy-dovectrl.pos"><b>/d/daisy/dovectrl.pos</b></dt>
<dd>

<p>The Daisy Dove control file.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS6">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-0-EXIT_OK3">Exit status 0 ($EXIT_OK)</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1-EXIT_COMMAND_LINE3">Exit status 1 ($EXIT_COMMAND_LINE)</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
</dl>

<h1 id="SEE-ALSO7">SEE ALSO</h1>

<p>identify_daisy_distro.pl</p>

<h1 id="NAME8">NAME</h1>

<p><i>tfmkpserver.pl</i> - Script to make a backup server into a production server.</p>

<h1 id="VERSION8">VERSION</h1>

<p>This documentation refers to version: $Revision: 1.32 $</p>

<h1 id="SYNOPSIS1">SYNOPSIS</h1>

<p>tfmkpserver.pl <b>--help</b></p>

<p>tkmkpserver.pl <b>--version</b></p>

<p>tkmkpserver.pl [<b>--verbose</b>] [<b>--dry-run</b>] [<b>--logfile=path</b>] [<b>--keep-ip-addr</b>] --convert</p>

<p>tkmkpserver.pl [<b>--verbose</b>] [<b>--dry-run</b>] [<b>--logfile=path</b>] --revert</p>

<p>tkmkpserver.pl [<b>--verbose</b>] [<b>--dry-run</b>] [<b>--logfile=path</b>] --report-files</p>

<h1 id="DESCRIPTION8">DESCRIPTION</h1>

<h2 id="Overview">Overview</h2>

<p>The <i>tkmkpserver.pl</i> script is used to convert a backup server into a production server.</p>

<h2 id="Details">Details</h2>

<p>Here is a detailed outline of how <i>tfmkpserver.pl</i> converts the backup server to a production serverby performing</p>

<ol>

<li><p>The script verifies the following list of pre-requesites are fulfilled:</p>

<dl>

<dt id="a">a.</dt>
<dd>

<p>verify the platform is &quot;RHEL5&quot; or &quot;RHEL6&quot; or &quot;RHEL7&quot;.</p>

</dd>
<dt id="b">b.</dt>
<dd>

<p>verify that the &quot;production server info file&quot; is present and contains values for each of the possible fields allowed.</p>

</dd>
<dt id="c">c.</dt>
<dd>

<p>verify that the <b>OSTools</b> package is installed.</p>

</dd>
<dt id="d1">d.</dt>
<dd>

<p>if RTI, verify that <i>/usr2</i> exists and is a directory.</p>

</dd>
<dt id="e">e.</dt>
<dd>

<p>if RTI, verify that the RTI <i>/etc/init.d</i> scripts exist.</p>

</dd>
<dt id="f">f.</dt>
<dd>

<p>if RTI, verify that the TCC package is installed.</p>

</dd>
<dt id="g">g.</dt>
<dd>

<p>if Daisy, verify that <i>/d</i> exists and is a directory.</p>

</dd>
</dl>

</li>
<li><p>restore special files like <i>/usr2/bbx/bin/doveserver.pl</i>. The restoration involves renaming the file to it&#39;s actual name, and setting the perms, owner, and group to there proper values.</p>

</li>
<li><p>restore a select set of system files from the production server, for example, <i>/etc/samba/smb.conf</i>.</p>

</li>
<li><p>configure the TCC package as appropriate for the platform.</p>

</li>
<li><p>configure the network by setting the hostname, the ip addr, the netmask, and the gateway ipaddr of the backup server to that of the production server.</p>

</li>
<li><p>add any POS users from the production server to the backup server.</p>

</li>
<li><p>reconcile the UIDs in the Samba password file from the production server with those in the password file of the backup server.</p>

</li>
<li><p>Configure and start the RTI system services: http, bbj, blm, and rti.</p>

<p>The script exits with the exit status returned by <i>tf_make_pserver()</i>. See section on &quot;EXIT STATUS&quot; below for actual exit status values and the the reason why each status would be reported.</p>

</li>
</ol>

<h2 id="Command-Line-Options1">Command Line Options</h2>

<dl>

<dt id="version8"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help8"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="verbose2"><b>--verbose</b></dt>
<dd>

<p>Modifier: report extra information.</p>

</dd>
<dt id="report-files"><b>--report-files</b></dt>
<dd>

<p>List paths to important files and directories.</p>

</dd>
<dt id="convert"><b>--convert</b></dt>
<dd>

<p>Convert a backup server to a production server.</p>

</dd>
<dt id="revert"><b>--revert</b></dt>
<dd>

<p>Revert a production server that had once been a backup server back to being a backup server.</p>

</dd>
<dt id="logfile-path"><b>--logfile=path</b></dt>
<dd>

<p>Specify path to log file.</p>

</dd>
<dt id="keep-ip-addr"><b>--keep-ip-addr</b></dt>
<dd>

<p>When converting from a backup server to a production server, keep the current ip address of the backup server.</p>

</dd>
<dt id="dry-run2"><b>--dry-run</b></dt>
<dd>

<p>Report what an operation would do but don&#39;t actually do it.</p>

</dd>
<dt id="debugmode"><b>--debugmode</b></dt>
<dd>

<p>If specified, run in debug mode.</p>

</dd>
</dl>

<h1 id="EXAMPLES2">EXAMPLES</h1>

<p>To list the locations of important files and directories, enter the following:</p>

<pre><code> sudo tfmkpserver.pl --report-files</code></pre>

<h1 id="FILES8">FILES</h1>

<dl>

<dt id="usr2"><i>/usr2</i></dt>
<dd>

<p>The top of the RTI filesystem.</p>

</dd>
<dt id="usr2-tfrsync"><i>/usr2/tfrsync</i></dt>
<dd>

<p>This directory contains files from the production system.</p>

</dd>
<dt id="usr2-bbx1"><i>/usr2/bbx</i></dt>
<dd>

<p>The default RTI directory - this directory must exist and contain a standard RTI POS installation.</p>

</dd>
<dt id="usr2-bbx-log-tfmkpserver.log"><i>/usr2/bbx/log/tfmkpserver.log</i></dt>
<dd>

<p>The log file produced by this script.</p>

</dd>
</dl>

<h1 id="EXIT-STATUS1">EXIT STATUS</h1>

<dl>

<dt id="Exit-status-0-EXIT_OK4">Exit status 0 ($EXIT_OK)</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1-EXIT_COMMAND_LINE4">Exit status 1 ($EXIT_COMMAND_LINE)</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
<dt id="Exit-status-2-EXIT_MUST_BE_ROOT2">Exit status 2 ($EXIT_MUST_BE_ROOT)</dt>
<dd>

<p>The script must run as root or with sudo(1).</p>

</dd>
<dt id="Exit-status-10-EXIT_PREREQS">Exit status 10 ($EXIT_PREREQS)</dt>
<dd>

<p>One or more of the prerequisites could not be verified. These &quot;prereqs&quot; include conditions like the platform the script is running on, the installation of the OSTools package, the existence of specific files, directories, and scripts, and the existence of an installed POS, either RTI or Daisy.</p>

</dd>
<dt id="Exit-status-12-EXIT_START_RTI">Exit status 12 ($EXIT_START_RTI)</dt>
<dd>

<p>The RTI point of sales application could not be started.</p>

</dd>
<dt id="Exit-status-13-EXIT_TCC_CONFIG">Exit status 13 ($EXIT_TCC_CONFIG)</dt>
<dd>

<p>The TCC symlinks for RTI could not be configured.</p>

</dd>
<dt id="Exit-status-14-EXIT_NETWORK_CONFIG">Exit status 14 ($EXIT_NETWORK_CONFIG)</dt>
<dd>

<p>The network configuration of the backup server could not be changed to that of the production server.</p>

</dd>
<dt id="Exit-status-15-EXIT_RESTORING_SPECIAL_FILES">Exit status 15 ($EXIT_RESTORING_SPECIAL_FILES)</dt>
<dd>

<p>The set of files requiring special handling could not be restored. Examples include <i>doveserver.pl</i>.</p>

</dd>
<dt id="Exit-status-16-EXIT_RESTORING_USERS">Exit status 16 ($EXIT_RESTORING_USERS)</dt>
<dd>

<p>The set of POS users from the production server and their info such as passwords, could not be restored on the backup server.</p>

</dd>
<dt id="Exit-status-17-EXIT_SAMBA_PW_BACKEND">Exit status 17 ($EXIT_SAMBA_PW_BACKEND)</dt>
<dd>

<p>The Samba password backend configuration could not be updated on a RHEL6 or RHEL7 system.</p>

</dd>
<dt id="Exit-status-18-EXIT_SAMBA_USERS">Exit status 18 ($EXIT_SAMBA_USERS)</dt>
<dd>

<p>The Samba <b>uid</b> values in the Samba password file could not be updated.</p>

</dd>
<dt id="Exit-status-19-EXIT_RESTORING_SYSTEM_FILES">Exit status 19 ($EXIT_RESTORING_SYSTEM_FILES)</dt>
<dd>

<p>The backup sets that could not be stored &quot;in place&quot; could not be copied into place.</p>

</dd>
<dt id="Exit-status-20-EXIT_MKDIR_SERVER_INFO_DIR">Exit status 20 ($EXIT_MKDIR_SERVER_INFO_DIR)</dt>
<dd>

<p>Could not mkdir the server info directory.</p>

</dd>
<dt id="Exit-status-21-EXIT_GEN_BSERVER_INFO_FILE">Exit status 21 ($EXIT_GEN_BSERVER_INFO_FILE)</dt>
<dd>

<p>Could not generate a new backup server info file.</p>

</dd>
</dl>

<h2 id="SEE-ALSO8">SEE ALSO</h2>

<p><i>tfrsync.pl</i></p>

<h1 id="NAME9">NAME</h1>

<p>tfprinter.pl - Teleflora Printer Maintenance</p>

<h1 id="VERSION9">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.32 $</p>

<h1 id="USAGE6">USAGE</h1>

<p>./tfprinter.pl --help</p>

<p>./tfprinter.pl --version</p>

<p>./tfprinter.pl --list</p>

<p>sudo ./tfprinter.pl --add spoolname:/dev/lp0</p>

<p>sudo ./tfprinter.pl --add spoolname:/dev/ttyS0</p>

<p>sudo ./tfprinter.pl --add spoolname:/dev/usb/lp0</p>

<p>sudo ./tfprinter.pl [--dryrun] --add spoolname:printer.ip.address</p>

<p>sudo ./tfprinter.pl (--jetdirect | --ipp | --samba | --lpd) --ppd=ppd_file --add spoolname:printer.ip.address</p>

<p>sudo ./tfprinter.pl --user=username --password=pw --share=sharename --workgroup=smbwkgrp --add spoolname:printer.ip.address</p>

<p>sudo ./tfprinter.pl --delete spoolname</p>

<p>sudo ./tfprinter.pl --clear spoolname</p>

<p>echo &quot;Stuff to print&quot; | ./tfprinter.pl --print null</p>

<p>echo &quot;Stuff to print&quot; | ./tfprinter.pl --print screen</p>

<p>echo &quot;Stuff to print&quot; | ./tfprinter.pl --print spoolname</p>

<p>echo &quot;Stuff to print&quot; | ./tfprinter.pl --print spoolname,spool2name,spool3name,...</p>

<p>echo &quot;Stuff to print&quot; | ./tfprinter.pl --print pdf &gt; /path/to/somefile.pdf</p>

<h1 id="OPTIONS8">OPTIONS</h1>

<dl>

<dt id="version9"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help9"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="dryrun"><b>--dryrun</b></dt>
<dd>

<p>Output what the command will do without actually making the changes.</p>

</dd>
</dl>

<h1 id="DESCRIPTION9">DESCRIPTION</h1>

<p>This script</p>

<h1 id="FILES9">FILES</h1>

<dl>

<dt id="var-log-messages3"><b>/var/log/messages</b></dt>
<dd>

<p>The default log file.</p>

</dd>
<dt id="etc-redhat-release3"><b>/etc/redhat-release</b></dt>
<dd>

<p>The file that contains the platform release version information.</p>

</dd>
<dt id="var-log-cups"><b>/var/log/cups</b></dt>
<dd>

<p>Location of printing log files.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS7">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-03">Exit status 0</dt>
<dd>

<p>Successful completion.</p>

</dd>
</dl>

<h1 id="SEE-ALSO9">SEE ALSO</h1>

<p><code>/etc/cups/cupsd.conf</code>, <code>cupsenable(1)</code>, <code>cupsdisable(1)</code>, <code>lpadmin(1)</code>, <code>lpstat(1)</code>, <code>/etc/init.d/cups</code>, <code>/var/log/cups</code>,</p>

<h1 id="NAME10">NAME</h1>

<p>tfremote.pl - script for remote access to a Teleflora POS</p>

<h1 id="VERSION10">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.56 $</p>

<h1 id="USAGE7">USAGE</h1>

<p>tfremote.pl</p>

<p>tfremote.pl <b>--version</b></p>

<p>tfremote.pl <b>--help</b></p>

<p>tfremote.pl <b>--install</b></p>

<p>tfremote.pl <b>--start</b></p>

<p>tfremote.pl <b>--stop</b></p>

<p>tfremote.pl <b>--status</b></p>

<p>tfremote.pl <b>--connect=s</b></p>

<h1 id="OPTIONS9">OPTIONS</h1>

<dl>

<dt id="version10"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help10"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="install3"><b>--install</b></dt>
<dd>

<p>Run only once, installs the <i>tfremote.pl</i> script, the <i>tfremote</i> system service, and the config file. Must be root to run this option.</p>

</dd>
<dt id="connect-s"><b>--connect=s</b></dt>
<dd>

<p>This option is used mainly on the Teleflora customer service servers to connect to customer machines, setting up appropriate security parameters, as well as port forwarding rules.</p>

</dd>
<dt id="start"><b>--start</b></dt>
<dd>

<p>Starts the <i>tfremote</i> system service. Must be root to run this option.</p>

</dd>
<dt id="stop"><b>--stop</b></dt>
<dd>

<p>Stops the <i>tfremote</i> system service. Must be root to run this option.</p>

</dd>
<dt id="status"><b>--status</b></dt>
<dd>

<p>Reports the status of the <i>tfremote</i> system service.</p>

</dd>
</dl>

<h1 id="DESCRIPTION10">DESCRIPTION</h1>

<p>The <i>tfremote.pl</i> script sets up a &quot;parallel&quot; SSHd service called &quot;tfremote&quot;. The only authentication method allowed is &quot;SSH public key&quot;.</p>

<h1 id="FILES10">FILES</h1>

<dl>

<dt id="etc-init.d-tfremote"><b>/etc/init.d/tfremote</b></dt>
<dd>

<p>Only used on RHEL5 and RHEL6, an edited copy of <b>/etc/init.d/sshd</b>.</p>

</dd>
<dt id="etc-ssh-tfremote_config"><b>/etc/ssh/tfremote_config</b></dt>
<dd>

<p>An edited copy of <b>/etc/ssh/sshd_config</b>.</p>

</dd>
<dt id="etc-sysconfig-tfremote"><b>/etc/sysconfig/tfremote</b></dt>
<dd>

<p>Only used on RHEL5 and RHEL6, an edited copy of <b>/etc/sysonfig/sshd</b>.</p>

</dd>
<dt id="usr-sbin-tfremote"><b>/usr/sbin/tfremote</b></dt>
<dd>

<p>Only used on RHEL5 and RHEL6, a copy of <b>/usr/sbin/sshd</b>.</p>

</dd>
<dt id="etc-systemd-system-tfremote.service"><b>/etc/systemd/system/tfremote.service</b></dt>
<dd>

<p>Only used on RHEL7, the unit service file for the <b>tfremote</b> system service.</p>

</dd>
<dt id="usr-lib-systemd-system-sshd.service"><b>/usr/lib/systemd/system/sshd.service</b></dt>
<dd>

<p>Only used on RHEL7, the unit service file for the <b>sshd</b> system service.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS8">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-0-EXIT_OK5">Exit status 0 ($EXIT_OK)</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1-EXIT_MUST_BE_ROOT">Exit status 1 ($EXIT_MUST_BE_ROOT)</dt>
<dd>

<p>For the &quot;--start&quot;, &quot;--stop&quot;, and &quot;--install&quot; command line options, the user must be root or running under &quot;sudo&quot;.</p>

</dd>
<dt id="Exit-status-2-EXIT_COMMAND_LINE">Exit status 2 ($EXIT_COMMAND_LINE)</dt>
<dd>

<p>The command line entered was not recognized.</p>

</dd>
<dt id="Exit-status-3-EXIT_PLATFORM">Exit status 3 ($EXIT_PLATFORM)</dt>
<dd>

<p>The operating system was not recognized.</p>

</dd>
</dl>

<h1 id="SEE-ALSO10">SEE ALSO</h1>

<p>sshd(8), sshd_config(5)</p>

<h1 id="NAME11">NAME</h1>

<p>tfrsync.pl - synchronize production server files to a backup destination.</p>

<h1 id="VERSION11">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.227 $</p>

<h1 id="SYNOPSIS2">SYNOPSIS</h1>

<p>tfrsync.pl --help</p>

<p>tfrsync.pl --version</p>

<p>tfrsync.pl --install-primary (--server | --cloud) [--rsync-account=name] [--network-device=s]</p>

<p>tfrsync.pl --uninstall-primary [--rsync-account=name]</p>

<p>tfrsync.pl --info-primary [--rsync-account=name]</p>

<p>tfrsync.pl --install-secondary [--primary-server=addr] [--rsync-account=name]</p>

<p>tfrsync.pl --uninstall-secondary [--rsync-account=name]</p>

<p>tfrsync.pl --info-secondary [--rsync-account=name]</p>

<p>tfrsync.pl --install-cloud [--cloud-server=addr] [---rsync-account=name]</p>

<p>tfrsync.pl --uninstall-cloud [--cloud-server=addr] [---rsync-account=name]</p>

<p>tfrsync.pl --generate-permfiles</p>

<p>tfrsync.pl --upload-permfiles [--cloud-server=addr] [--rsync-account=name]</p>

<p>tfrsync.pl --download-permfiles [--cloud-server=addr] [--rsync-account=name]</p>

<p>tfrsync.pl --restore-from-permfiles [--cloud-server=addr] [--rsync-account=name]</p>

<p>tfrsync.pl --backup=type [--luks] [--luks-key=s]</p>

<p>tfrsync.pl --backup=type --cloud [--cloud-server=addr] [--rsync-account=name]</p>

<p>tfrsync.pl --backup=type --server [--rsync-server=addr] [--rsync-account=name]</p>

<p>tfrsync.pl --restore=type --cloud [--cloud-server=addr] [--rsync-account=name]</p>

<p>tfrsync.pl --restore=type --server [--rsync-server=addr] [--rsync-account=name]</p>

<p>tfrsync.pl --list=type</p>

<p>tfrsync.pl --mount [--device=s]</p>

<p>tfrsync.pl --unmount [--device=s]</p>

<p>tfrsync.pl --luks-install [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-init [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-is-luks [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-verify [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-mount [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-umount [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-uuid [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-label [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-status [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-getinfo [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-showkey [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-validate-key [--luks-key=s] [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-backup-date [--luks] [--device=s]</p>

<p>tfrsync.pl --luks-file-verify=s [--luks] [--luks-dir=s] [--device=s]</p>

<p>tfrsync.pl --luks-file-restore=s [--luks] [--luks-dir=s] [--rootdir=s] [--device=s]</p>

<p>tfrsync.pl --report-configfile</p>

<p>tfrsync.pl --report-logfile</p>

<p>tfrsync.pl --report-device</p>

<p>tfrsync.pl --report-backup-method</p>

<p>tfrsync.pl --gen-default-configfile</p>

<p>tfrsync.pl --finddev</p>

<p>tfrsync.pl --showkey</p>

<p>tfrsync.pl --validate-cryptkey</p>

<p>tfrsync.pl --format [--force-format]</p>

<p>tfrsync.pl --runtime-cleanup ( --cloud | --server )</p>

<p>tfrsync.pl --send-test-email</p>

<h1 id="OPTIONS10">OPTIONS</h1>

<p>There are two types of options. The first is essentially a command since without this type of option, the script will do nothing. The second type is a modifier to a command option; it tailors the behavior of the command.</p>

<h2 id="Commands">Commands</h2>

<dl>

<dt id="version11"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help11"><b>--help</b></dt>
<dd>

<p>Output a usage help message and exit.</p>

</dd>
<dt id="install-install-primary"><b>--install|install-primary</b></dt>
<dd>

<p>Install the <i>tfrsync.pl</i> script on the production server and perform other steps to prep the production server.</p>

</dd>
<dt id="uninstall-primary"><b>--uninstall-primary</b></dt>
<dd>

<p>Undo what was done to install <i>tfrsync.pl</i> on the production server.</p>

</dd>
<dt id="info-primary"><b>--info-primary</b></dt>
<dd>

<p>Report configuration of production server.</p>

</dd>
<dt id="install-secondary"><b>--install-secondary</b></dt>
<dd>

<p>Prepare the secondary server.</p>

</dd>
<dt id="uninstall-secondary"><b>--uninstall-secondary</b></dt>
<dd>

<p>Undo what was done to install <i>tfrsync.pl</i> on the secondary server.</p>

</dd>
<dt id="info-secondary"><b>--info-secondary</b></dt>
<dd>

<p>Report configuration of backup server.</p>

</dd>
<dt id="generate-permfiles"><b>--generate-permfiles</b></dt>
<dd>

<p>Generate perm files for all backup types. For all the files that make up a backup type, the <i>getfacl(1)</i> command is used to capture the file perms of the files that make up the backup type. It writes the captured info into a perm file corresponding to the backup type. If an error occurs while iterating through the list of files for any backup type, the error is logged but the generation will continue. Thus, if there are any errors reported, the contents of the perm file may not be complete. An example of an error that may occur is one caused when there are stale symlinks in the set of files of a backup type.</p>

</dd>
<dt id="backup-type"><b>--backup=type</b></dt>
<dd>

<p>Perform a backup of the specified <i>type</i>. The <i>type</i> may be one or more of the following:</p>

<pre><code>        all
        usr2
        daisy
        printconfigs
        rticonfigs
        daisyconfigs
        osconfigs
        netconfigs
        userconfigs
        userfiles
        logfiles
        posusersinfo
        pserverinfo
        pservercloister
        bbxd
        bbxps
        singlefile</code></pre>

<p>Modifiers: <b>--device=s</b>, <b>--usb-device</b>, <b>--backup-exclude=list</b>, <b>--rsync-server=addr</b>, <b>--rsync-dir=path</b>, <b>--retry-backup</b>, <b>--retry-reps=number</b>, <b>--retry-wait=seconds</b>, <b>--singlefile=path</b>, and <b>--send-summary</b></p>

</dd>
<dt id="restore-type"><b>--restore=type</b></dt>
<dd>

<p>Restore files of specified <code>type</code> from a backup. The <i>type</i> may be one or more of the following:</p>

<pre><code>        all
        usr2
        daisy
        printconfigs
        rticonfigs
        daisyconfigs
        osconfigs
        netconfigs
        userconfigs
        userfiles
        logfiles
        bbxd
        bbxps
        singlefile</code></pre>

<p>Modifiers: <b>--device=s</b>, <b>--usb-device</b>, <b>--restore-exclude=list</b>, <b>--rootdir=s</b>, <b>--[no]harden-linux</b>, <b>--singlefile=path</b> and <b>--dry-run</b></p>

</dd>
<dt id="list-type"><b>--list=type</b></dt>
<dd>

<p>List the files on a backup server or device for the specified backup type (see <b>--backup=type</b> option. If no backup type is specfied, the default is <i>all</i>. This option may not be used with the <b>--cloud</b> option.</p>

<p>Modifiers: <b>--device=s</b>, <b>--usb-device</b>, <b>--rsync-server=addr</b>, <b>--rsync-dir=path</b></p>

</dd>
<dt id="finddev---report-device"><b>--finddev | --report-device</b></dt>
<dd>

<p>Search for a USB or Passport backup disk device.</p>

</dd>
<dt id="report-backup-method"><b>--report-backup-method</b></dt>
<dd>

<p>Report what type of backup is installed, ie, &quot;cloud&quot;, &quot;server&quot;, or &quot;LUKS&quot;.</p>

</dd>
<dt id="showkey1"><b>--showkey</b></dt>
<dd>

<p>Output the string being used as the LUKS key.</p>

</dd>
<dt id="format1"><b>--format</b></dt>
<dd>

<p>Format a backup device.</p>

</dd>
<dt id="getinfo1"><b>--getinfo</b></dt>
<dd>

<p>Get and report info about the backups on a backup device.</p>

</dd>
<dt id="mount1"><b>--mount</b></dt>
<dd>

<p>Mount a backup device.</p>

</dd>
<dt id="unmount---umount1"><b>--unmount|--umount</b></dt>
<dd>

<p>Unmount a backup device.</p>

</dd>
<dt id="runtime-cleanup"><b>--runtime-cleanup</b></dt>
<dd>

<p>If the script crashed rather than ending with a clean exit, there possibly will be a process lock file and/or a SSH tunnel socket left behind. This command can be used to cleanup those dangling files. For cloud, server, or device backup operations, the process lock file will be removed. For server or cloud, the SSH tunnel socket will be removed.</p>

</dd>
<dt id="send-test-email"><b>--send-test-email</b></dt>
<dd>

<p>Send an email message via the email configuration to test whether an email message would make it through to any configured recepients.</p>

</dd>
<dt id="report-configfile1"><b>--report-configfile</b></dt>
<dd>

<p>Parse the config file, and report it&#39;s contents.</p>

</dd>
<dt id="report-backup-method1"><b>--report-backup-method</b></dt>
<dd>

<p>Information about how the decision of what backup method was installed will be in the device log file.</p>

</dd>
<dt id="gen-default-configfile"><b>--gen-default-configfile</b></dt>
<dd>

<p>Generate a new default config file and put it into the OSTools config directory. If there is already an existing config file, do not overwrite the old config file - rather, add the extension <i>.new</i> before installation.</p>

</dd>
<dt id="luks-install"><b>--luks-install</b></dt>
<dd>

<p>Like <b>--production-install</b>, sets up a production server to be ready to perform backups to a LUKS device. Modifiers allowed: <b>[--luks]</b>, <b>[--device=s]</b>.</p>

</dd>
<dt id="luks-init"><b>--luks-init</b></dt>
<dd>

<p>Writes the LUKS header to the backup disk and puts an ext2 file system on the LUKS device.</p>

</dd>
<dt id="luks-is-luks"><b>--luks-is-luks</b></dt>
<dd>

<p>Verify the current backup disk is a LUKS device. This command uses the <code>cryptsetup isLuks</code> command.</p>

</dd>
<dt id="luks-verify"><b>--luks-verify</b></dt>
<dd>

<p>Verify the current backup disk is a LUKS device. This command uses the <code>cryptsetup luksDump</code> command.</p>

</dd>
<dt id="luks-mount"><b>--luks-mount</b></dt>
<dd>

<p>Mount a LUKS disk device.</p>

</dd>
<dt id="luks-umount"><b>--luks-umount</b></dt>
<dd>

<p>Unmount (aka eject) a LUKS device.</p>

</dd>
<dt id="luks-uuid"><b>--luks-uuid</b></dt>
<dd>

<p>Output the UUID of the LUKS device.</p>

</dd>
<dt id="luks-label"><b>--luks-label</b></dt>
<dd>

<p>Output the disk label of a LUKS device.</p>

</dd>
<dt id="luks-status"><b>--luks-status</b></dt>
<dd>

<p>Output low level system inforation about the LUKS device.</p>

</dd>
<dt id="luks-getinfo"><b>--luks-getinfo</b></dt>
<dd>

<p>For the currently selected backup disk, output the backup type, the block device name of the LUKS device, the LUKS device name, the mount point for file system on the LUKS device, and the free space on the LUKS device.</p>

</dd>
<dt id="luks-showkey"><b>--luks-showkey</b></dt>
<dd>

<p>Output the encryption key for the LUKS disk device.</p>

</dd>
<dt id="luks-validate-key"><b>--luks-validate-key</b></dt>
<dd>

<p>Validate the default or specified LUKS disk device encryption key by trying to mount the LUKS disk device.</p>

</dd>
</dl>

<h2 id="Command-Modifiers">Command Modifiers</h2>

<dl>

<dt id="luks"><b>--luks</b></dt>
<dd>

<p>This option specifies a backup type of &quot;LUKS disk device&quot;. While it may be ommitted since the script can deduce what should be done from other options, specifying this option makes explicit what is desired and makes communication clearer.</p>

</dd>
<dt id="luks-key-s"><b>--luks-key=s</b></dt>
<dd>

<p>Specify the LUKS key. If this option is not specified the hardware serial number is used. Note, if the LUKS device is moved to another system, the LUKS key must be noted and used in order to access the files on the LUKS device.</p>

</dd>
<dt id="luks-dir-s"><b>--luks-dir=s</b></dt>
<dd>

<p>This command line option allows the user to specify which &quot;bucket&quot; on the LUKS disk device is to be used for listing, searching, and restoring.</p>

</dd>
<dt id="server"><b>--server</b></dt>
<dd>

<p>Specify this option when performing a backup from a production server to a backup server. Sets the default values of <b>--rsync-server=s</b> and <b>--rsync-account=s</b> if not set.</p>

</dd>
<dt id="cloud"><b>--cloud</b></dt>
<dd>

<p>Specify this option when performing a backup from a production server to a cloud server. Sets the default values of <b>--cloud-server=s</b> and <b>--rsync-account=s</b>.</p>

</dd>
<dt id="cloud-server-addr"><b>--cloud-server=addr</b></dt>
<dd>

<p>Specify the FQDN or IP address of the cloud server.</p>

</dd>
<dt id="primary-server-addr"><b>--primary-server=addr</b></dt>
<dd>

<p>Sets the hostname or IP address of the production server. May only be used with <b>--install-secondary</b>.</p>

</dd>
<dt id="rsync-server-addr"><b>--rsync-server=addr</b></dt>
<dd>

<p>Specify the hostname or IP address of the rsync backup server.</p>

</dd>
<dt id="rsync-dir-path"><b>--rsync-dir=path</b></dt>
<dd>

<p>Specify the directory to write files to on the rsync server if <b>--rsync-server</b> is specified or to a local file system if <b>--rsync-server</b> is not specified.</p>

</dd>
<dt id="rsync-account-s"><b>--rsync-account=s</b></dt>
<dd>

<p>Sets the name of the account on the rsync server. May be used with <b>--install-primary</b>, <b>--uninstall-primary</b>, <b>--info-primary</b>, <b>--install-secondary</b>, <b>--uninstall-secondary</b>, <b>--info-secondary</b>, <b>--install-cloud</b>, <b>--uninstall-cloud</b>, <b>--upload-permfiles</b>, <b>--download-permfiles</b>, <b>--restore-from-permfiles</b>, <b>--backup=type</b>, and <b>--restore=type</b>.</p>

</dd>
<dt id="force-rsync-account-name"><b>--force-rsync-account-name</b></dt>
<dd>

<p>If the <b>--cloud</b> option is specified, the default account name used is of the form &quot;name-nnnnnnnn&quot; where &quot;name&quot; is &quot;tfrsync&quot; and &quot;nnnnnnnn&quot; is the shopcode of the system. If a cloud account name is specified on the command line that does not contain the shopcode matching the system, then the account name is not allowed unless <b>--force-rsync-account-name</b> is also specified on the command line.</p>

</dd>
<dt id="rsync-trial"><b>--rsync-trial</b></dt>
<dd>

<p>Run the <i>rsync</i> command in trial mode (accomplished by adding the <b>-n</b> option to the <i>rsync</i> command that gets generated). This provides a method to determine what files will be synchronized without actually synchronizing them.</p>

</dd>
<dt id="rsync-options-s"><b>--rsync-options=s</b></dt>
<dd>

<p>Specify a list of one or more comma separated <i>rsync</i> options to be added to the <i>rsync</i> command line.</p>

</dd>
<dt id="rsync-timeout-s"><b>--rsync-timeout=s</b></dt>
<dd>

<p>All <i>rsync</i> commands generated have the <b>--timeout=s</b> option with a default value of 600 seconds. Specify this option to change that value. A value of zero means no timeout.</p>

</dd>
<dt id="no-rsync-nice"><b>--[no]rsync-nice</b></dt>
<dd>

<p>Run the <code>rsync</code> command with <code>nice</code>; this is the default behavior. Specify <i>--norsync-nice</i> on the command line to run the <code>rsync</code> command without <code>nice</code>.</p>

</dd>
<dt id="no-rsync-metadata"><b>--[no]rsync-metadata</b></dt>
<dd>

<p>The default behavior when doing a backup to the &quot;cloud&quot; is to generated metadata files for each of the backup types. To keep from generating metadata files, specify the &quot;--norsync-metatdata&quot; option on the command line.</p>

</dd>
<dt id="rsync-compression"><b>--rsync-compression</b></dt>
<dd>

<p>By default, there is no compression of files during the transfer by rsync, ie the <b>-z</b> option is not present on the <i>rsync</i> command. If the <b>--rsync-compression</b> option is specified with the <b>--backup=type</b> option, then the <b>-z</b> option will be added to the <i>rsync</i> command issued. Note that adding this option can increase the time required to perform a backup when backing up very large files.</p>

</dd>
<dt id="retry-backup"><b>--retry-backup</b></dt>
<dd>

<p>If present, enables the backup retry policy. Note that retries are only applicable for instances when <i>rsync(1)</i> returns a value of 12 (rsync protocol), 30 (I/O error) or 255 (SSH connection error).</p>

</dd>
<dt id="retry-reps-number"><b>--retry-reps=number</b></dt>
<dd>

<p>If present, sets the number of retries to &quot;number&quot;. This option is ignored unless <b>--retry-backup</b> is also specified. The value specified must be &gt;= 0 and &lt;= 10. If <b>--retry-backup</b> is specified and <b>--retry-reps=number</b> is not specified or if <b>--retry-reps=0</b> is specified, then the default value of 3 retries is used.</p>

</dd>
<dt id="retry-wait-number"><b>--retry-wait=number</b></dt>
<dd>

<p>If present, sets the retry wait time to &quot;number&quot; seconds. This option is ignored unless <b>--retry-backup</b> is also specified. The value specified must be &gt;= 0 and &lt;= 3600. If <b>--retry-backup</b> is specified and <b>--retry-wait=number</b> is not specified or if <b>--retry-wait=0</b> is specified, then the default value of 120 seconds is used.</p>

</dd>
<dt id="force-format"><b>--force-format</b></dt>
<dd>

<p>Unless specified with the <b>--format</b> option, the user is asked a &quot;yes/no&quot; question on STDIN to verify that a format of the file system is really desired. If &lt;--force-format&gt; is specified, it&#39;s equivalent to &quot;yes&quot; being answered.</p>

</dd>
<dt id="singlefile-path"><b>--singlefile=path</b></dt>
<dd>

<p>Provides the method to specify one or more files to backup or restore. The files are specified by a list of one or more comma separated paths. This option may only be used in conjunction with the <b>--backup=type</b> or <b>--restore=type</b> commands.</p>

</dd>
<dt id="restore-upgrade"><b>--restore-upgrade</b></dt>
<dd>

<p>An option that may only be used when both <b>--cloud</b> and <b>--restore=type</b> are specified, ie that a restore is being done from a cloud server to a staged production server. The set of backup files being restored may or may not be from the same platform as the staged server, ie the backup files may be from a RHEL5 system and the staged server may be a RHEL6 system.</p>

</dd>
<dt id="network-device-s"><b>--network-device=s</b></dt>
<dd>

<p>This option allows the specification of a network interface device name, eg &quot;eth0&quot; or &quot;eth1&quot;, and is only used to produce the contents of the production server info file when performing a backup. The default value is &quot;eth0&quot; so if you are using that interface for your network tap, there is no need to specify this option.</p>

</dd>
<dt id="send-summary"><b>--send-summary</b></dt>
<dd>

<p>A summary report is sent to a list of one or more email addresses if email is configured.</p>

</dd>
<dt id="rti3"><b>--rti</b></dt>
<dd>

<p>Specify that the system is a RTI system.</p>

</dd>
<dt id="daisy3"><b>--daisy</b></dt>
<dd>

<p>Specify that the system is a Daisy system.</p>

</dd>
<dt id="email-recipients"><b>--email=recipients</b></dt>
<dd>

<p>Specifies a list of email addresses.</p>

</dd>
<dt id="printer-names"><b>--printer=names</b></dt>
<dd>

<p>Specifies a comma separated list of printer names. If printers are configured, the backup summary report will be output to all named printers. Also, if the backup class is &quot;device&quot; and there is no backup device discovered, and printers are configured, an error message will be output to all named printers.</p>

</dd>
<dt id="rootdir-path"><b>--rootdir=path</b></dt>
<dd>

<p>Specifies the destination directory for restore.</p>

</dd>
<dt id="configfile-path1"><b>--configfile=path</b></dt>
<dd>

<p>Specifies the path to the config file.</p>

</dd>
<dt id="logfile-path1"><b>--logfile=path</b></dt>
<dd>

<p>Specifies the path to the logfile.</p>

</dd>
<dt id="summary-log-max-save-n"><b>--summary-log-max-save=n</b></dt>
<dd>

<p>Specifies the maximum number of saved summary log files.</p>

</dd>
<dt id="summary-log-min-save-n"><b>--summary-log-min-save=n</b></dt>
<dd>

<p>Specifies the minimum number of saved summary log files.</p>

</dd>
<dt id="summary-log-rotate"><b>--summary-log-rotate</b></dt>
<dd>

<p>Enable summary log file rotation (by default, disabled).</p>

</dd>
<dt id="backup-exclude-list"><b>--backup-exclude=list</b></dt>
<dd>

<p>Specifies a list of one or more comma separated files and/or directories to exclude from a backup.</p>

</dd>
<dt id="restore-exclude-list"><b>--restore-exclude=list</b></dt>
<dd>

<p>Specifies a list of one ore more comma separated files and/or directories to exclude from a restore.</p>

</dd>
<dt id="device-path"><b>--device=path</b></dt>
<dd>

<p>Specifies the path to the device special file for the backup device. It can also have the special value of <i>show-only</i> whose meaning is described under the <b>--show-only</b> option description.</p>

<p>Each backup device is classified as to type. There are several different device types supported:</p>

<pre><code> 1. &quot;passport&quot;    - a Western Digital Passport USB disk
 2. &quot;rev&quot;         - an IOmega Rev drive
 3. &quot;usb&quot;         - a USB disk with Teleflora label
 4. &quot;image&quot;       - an image file
 5. &quot;server&quot;      - ip address of backup server
 6. &quot;file system&quot; - locally mounted file system
 7. &quot;block&quot;       - either &quot;passport&quot;, &quot;rev&quot;, or &quot;usb&quot;
 8. &quot;show-only&quot;   - special device, same thing as &quot;--show-only&quot;</code></pre>

</dd>
<dt id="usb-device1"><b>--usb-device</b></dt>
<dd>

<p>Use a disk plugged into the USB bus which has been formatted with <b>--format</b> as the backup device.</p>

</dd>
<dt id="dry-run3"><b>--dry-run</b></dt>
<dd>

<p>Report what an operation would do but don&#39;t actually do it.</p>

</dd>
<dt id="show-only"><b>--show-only</b></dt>
<dd>

<p>Change the behavior of <b>--backup</b> to only show the filenames of the backup type not actually back up any files. Another way to think about this option is that it is an alias for <b>--device=show-only</b>, ie you are specifying a special device named <i>show-only</i> which does not backup any data but rather reports the filenames to be backed up.</p>

</dd>
<dt id="verbose3"><b>--verbose</b></dt>
<dd>

<p>Report extra information.</p>

</dd>
<dt id="no-harden-linux2"><b>--[no]harden-linux</b></dt>
<dd>

<p>Run (or don&#39;t run) the <i>harden_linux.pl</i> script. The <b>--harden-linux|--noharden-linux</b> command line option provides a way to specify whether or not the <i>harden_linux.pl</i> script should be run by the <i>tfrsync.pl</i> script. The default behavior for <i>tfrsync.pl</i> is to run <i>harden_linux.pl</i> after performing any of the following restore types: &quot;all&quot;, &quot;rticonfigs&quot;, &quot;daisy&quot;, &quot;daisyconfigs&quot;, &quot;osconfigs&quot; and &quot;netconfigs&quot;. The <i>harden_linux.pl</i> script will only be run once after all restores are finished. To prevent <i>harden_linux.pl</i> from running, specify the following option: <b>--noharden-linux</b>.</p>

</dd>
</dl>

<h1 id="DESCRIPTION11">DESCRIPTION</h1>

<p>The <i>tfrsync.pl</i> script may be used to synchronize data from a Teleflora RTI or Daisy Point of Sale server, referred to below as the &quot;production server&quot;, to a cloud server, a backup server, a backup device, or a local file system. It is essentially a front end to the <i>rsync(1)</i> command which does the real work of reading and writing the data. For maximum versatility, there are many options and many ways that the script can be used.</p>

<p>Since the backup strategy is one based on <i>rsync(1)</i>, implied is that the first backup performed copies all files of interest from the production server to the backup destination and could take a significant amount of time depending on the characteristics of the destination. For example, if there is a 25 GB of data to backup, if the distination is a cloud server, and if the upload bandwidth to the cloud server is typical, it should take 10 hours or less. Subsequent backups are incremental and only the files that have changed are copied to the backup destination. This results in a significant savings in time, with a typical installation taking 30 minutes and usually less.</p>

<h2 id="Installation">Installation</h2>

<p>Before <i>tfrsync.pl</i> can be used on either the production server or the backup server, it must be installed. The <i>tfrsync.pl</i> script itself will have been installed when the OSTools package was installed. However, the <i>tfrsync.pl</i> must install a framework of directories and files in order to accomplish it&#39;s job. This installation must be performed on both the production server and the backup server separately. The sections which follow outline what is done during production and backup server installations.</p>

<h2 id="Installation-on-the-Production-Server">Installation on the Production Server</h2>

<p>The <b>--install-primary</b> command line option performs all the steps necessary to install the <i>tfrsync.pl</i> script onto a RTI production server, aka a production server.</p>

<p>The OSTools installation process will already have copied the <i>tfrsync.pl</i> script to the OSTools <i>bin</i> directory and made a symlink from the RTI <i>bin</i> directory to it which makes it available from the command line for the <i>tfsupport</i> account.</p>

<p>The steps performed during the installation of the production server are outlined below:</p>

<ol>

<li><p>make the <i>tfrsync.pl</i> backup directory if it does not exist. For a RTI system, this is <i>/usr2/tfrsync</i>, and for a Daisy system, this is <i>/d/tfrsync</i>.</p>

</li>
<li><p>make the production server transfer directory if it does not exist. This directory is located in the home directory of the <i>tfsupport</i> account and is named <i>pserver_xfer.d</i>. The transfer directory is used to hold files that are to be copied from the production server to the backup server.</p>

</li>
<li><p>make the production server info directory if it does not exist. This directory is located in the <i>tfrsync.pl</i> backup directory and is named <i>pserver_info.d</i>. The production server info directory is the location of the production server info file which is named <i>pserver_info.txt</i>. The production server info file is generated each time a backup transaction occurs.</p>

</li>
<li><p>make the production server cloister directory if it does not exist. This directory is located in the <i>tfrsync.pl</i> backup directory and is named <i>pserver_cloister.d</i>. The cloister directory is used to hold backup copies of certain files that need to be backed up but need to be segregated into a special location rather than be copied &quot;in place&quot; like the bulk of the files to be backed up. Examples of such files are <i>/var/spool/cron</i> and <i>/etc/cron.d</i>. These files need segregation because if they are copied &quot;in place&quot; to the backup server, they would cause behavior on the backup server that would not be wanted, ie they would cause cron jobs to run.</p>

</li>
<li><p>make the users info directory if it does not exist. This directory is located in the <i>tfrsync.pl</i> backup directory and is named <i>users_info.d</i>. The users info directory is used to hold files containing info about the POS users on the production server. These files are copied to the backup server and are required for transforming a backup server into a production server.</p>

</li>
<li><p>if the <i>tfrsync.pl</i> account does not exist, add the <i>tfrsync.pl</i> account.</p>

</li>
<li><p>generate a password-less SSH key-pair for the <i>tfrsyc</i> account and copy the public SSH key file that was just generated to the production server transfer directory. The name of the public key file is <i>id_rsa.pub</i>.</p>

</li>
<li><p>add a new cron job file named <i>tfrsync</i> to the directory <i>/etc/cron.d</i>. If there is an existing cron job file there, then the cron job file is placed in the OSTools config directory instead.</p>

</li>
<li><p>generate a new config file and put it into the OSTools config directory. If there is already an existing config file for <i>tfrsync.pl</i>, then do not overwrite the old config file - rather, put the new config file into the OSTools config dir with the extension <i>.new</i>.</p>

</li>
</ol>

<h2 id="Installation-on-the-Backup-Server">Installation on the Backup Server</h2>

<p>In addition to installation of <i>tfrsync.pl</i> on the RTI production server, there are several installation steps that must also be performed on the backup server, aka secondary server. To install <i>tfrsync.pl</i> on the backup server, first install the OSTools package on the secondary server. Then, run the <i>tfrsync.pl</i> script on the backup server specifying the <b>--install-secondary</b> command line option. The <b>--primary-server=s</b> may also be specified with the <b>--install-secondary</b> option; it is used to specify the hostname or IP address of the production server. If the <b>--primary-server=s</b> option is not specifed, then the default value for the IP address of the production server is used. The default value is 192.168.1.21. The following steps are performed:</p>

<ol>

<li><p>an account named <i>tfrsync</i> is added if it does not exist</p>

</li>
<li><p>the account name <i>tfrsync</i> is added to the <i>/etc/sudoers</i> file to allow the <i>tfrsync</i> account to run the <code>rsync</code> command as root without being prompted for a password. This is accomplished by adding the account name <i>tfrsync</i> to the OSTools <i>harden_linux.pl</i> config file and then running the <code>harden_linux.pl --sudo</code> command.</p>

</li>
<li><p>the public key of the <i>tfrsync</i> account on the production server is added to the <i>.ssh/authorized_keys</i> file of the <i>tfrsync</i> account on the backup server</p>

</li>
<li><p>service httpd stop and chkconfig httpd off</p>

</li>
<li><p>service rti stop and chkconfig rti off</p>

</li>
<li><p>move /usr2/bbx/bin/doveserver.pl to /usr2/bbx/bin/doveserver.pl.save</p>

</li>
<li><p>service blm stop and chkconfig blm off</p>

</li>
<li><p>service bbj stop and chkconfig bbj off</p>

</li>
</ol>

<h2 id="Uninstall-on-the-Backup-Server">Uninstall on the Backup Server</h2>

<p>The <b>--uninstall-secondary</b> command line option undoes what was done to install the <i>tfrsync.pl</i> script on the secondary server.</p>

<ol>

<li><p>the account named <i>tfrsync</i> is removed from the <code>/etc/sudoers</code> file by removing the <code>harden_linux.pl</code> sudoers content file from the <code>harden_linux.pl</code> sudoers config directory, <code>/d/ostools/config/sudoers.d</code> on Daisy systems and <code>/usr2/ostools/config/suders.d</code> on RTI systems, and then running the <code>harden_linux.pl --sudo</code> command.</p>

</li>
<li><p>the public key of the <i>tfrsync</i> account on the production server is removed from the <code>~tfrsync/.ssh/authorized_keys</code> file on the backup server.</p>

</li>
<li><p>the account named <i>tfrsync</i> is removed from the backup server.</p>

</li>
</ol>

<h2 id="Backup-Retries">Backup Retries</h2>

<p>When doing a backup to a cloud server, if the Internet connection is inconsistent and unreliable, the rsync command can fail with a protocol error, or an i/o error, or an ssh connection error. For systems experiencing these conditions, the command line options <b>--retry-backup</b>, <b>--retry-reps=n</b> and <b>--retry-wait=secs</b> can be very useful. When <b>--retry-backup</b> is specified, if there is an rsync error as described above, the entire backup operation is retried one or more times with a wait between each retry. The default number of times to retry is 3. The default time to wait between retries is 2 minutes (120 seconds). The <b>--retry-reps=n</b> and <b>--retry-wait=secs</b> allows you to tune the retry and wait values to best suite your situation. These options are also supported in the config file so they can be specified on the command line as well as the config file.</p>

<h2 id="Sending-Email1">Sending Email</h2>

<p>The <i>tfrsync.pl</i> script can be configured to send email depending on one of several conditions. First, described below is when an email message is sent, and second, how an email message is sent.</p>

<dl>

<dt id="Could-not-start-new-instance">Could not start new instance</dt>
<dd>

<p>If there are email recipients specified on the command line or in the config file, and the <i>tfrsync.pl</i> script can not execute because an instance of the <i>tfrsync.pl</i> script is aleady running as indicated by not being able to obtain the process lock, an error message will be sent to each of the recipients.</p>

</dd>
<dt id="Backup-device-not-found1">Backup device not found</dt>
<dd>

<p>If there are email recipients specified on the command line or in the config file, and a backup device is not found, an error message will be sent to each of the recipients.</p>

</dd>
<dt id="Backup-error">Backup error</dt>
<dd>

<p>If there are email recipients specified on the command line or in the config file, and an error occurred during a backup operation, then a status message will be sent to each of the recipients.</p>

</dd>
<dt id="Backup-summary-report">Backup summary report</dt>
<dd>

<p>If there are email recipients specified on the command line or in the config file, and the <code>--send-summary</code> command line option is specified or the <code>send-summary</code> statement is set to true in the config file, then a summary report will be sent to each of the recipients.</p>

</dd>
</dl>

<p>Given that one or more email recipients are specified, and one of the conditions upon which the script will attempt to send an email message occurs, then the message can be sent one of the following methods. Note, if there is no email server configured in the config file, then no mail message will be sent even if there are recipients specified.</p>

<dl>

<dt id="Sendmail1">Sendmail</dt>
<dd>

<p>If the <code>email_server</code> config file statement is specified with a value of <code>sendmail</code>, then any email messages sent by the script will directly invoke the <code>/usr/lib/sendmail -oi -t</code> program with a from address of <code>tfrsync.pl@HOSTNAME.teleflora.com</code> where HOSTNAME will be substituted with the hostname of the system.</p>

</dd>
<dt id="SMTP-Server1">SMTP Server</dt>
<dd>

<p>If the <code>email_server</code> config file statement is specified with a value of the FQDN of an SMTP server, and the <code>email_user</code> and <code>email_password</code> config file statements have valid credentials for the specified SMTP server, then any email messages sent by the script will use the Perl module <code>Net::SMTP</code> with a from address of <code>backups@HOSTNAME</code> where HOSTNAME will be substituted with the hostname of the system.</p>

</dd>
</dl>

<h2 id="Rsync-of-Summary-Log-File">Rsync of Summary Log File</h2>

<p>After a backup operation is complete, ie after all changed files have been written to the backup device or to the backup server or to the cloud server, a summary log file is written locally to the POS log directory. Thus, this summary log file will not be transferred to the backup device until the next time a backup operation is performed. In order to backup the summary log file and to have convenient access to this file for monitoring and reporting, a resync of the summary log file is performed after the backup operation is complete and the summary log file has been written.</p>

<h2 id="Config-File">Config File</h2>

<p>The <i>tfrsync.pl</i> script supports one or more config files. The default config file name and location is specified in the FILES section below. There are many configuration attributes that can be set in the config file. Refer to the comments in the generated default config file for a list of attributes, their meaning, and their values.</p>

<h2 id="Backup-to-a-LUKS-Device">Backup to a LUKS Device</h2>

<p>In addition to &quot;cloud&quot; and &quot;server&quot; backup, the <i>tfrsync.pl</i> script supports backing up files to a LUKS device, ie a locally connected disk drive that has been specially initialized according to the LUKS specification. A LUKS device is one that complies with the &quot;Linux Unified Key Setup&quot; disk encryption specification. For more info, see the Wikipedia entry: <a href="https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup">https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup</a> Essentially, the backups are written to an encrypted file system which resides on a locally connected block device that has been configured to be a LUKS device. Files written to or read from the LUKS device are encrypted or decrypted by the Linux kernel automatically.</p>

<p>To configure a local disk drive as a LUKS device, two steps are required. First, install the <i>tfrsync.pl</i> script using the <b>--luks-install</b> command line option, and then initialize the backup disk as a LUKS device with the <b>--luks-init</b> command line option. Then the backup disk is ready to be used as a LUKS device. After script installation and backup disk initialization, the LUKS device can be used as a backup disk, using the <b>--backup=</b> command line option to specify the set of files to write to the disk. See the EXAMPLES section below for specific command lines.</p>

<p>By default, the backup disk is expected to be a Western Digital Passport. When the script starts, it will automatically look for a Passport as the backup disk. Upon finding a Passport, it will determine it&#39;s block device name but a specific block device name can be specified via the <b>--device=</b> option. In order to automatically find the Passport, it must be connected to the system and the block device name for it must be one of <code>/dev/sda</code> through <code>/dev/sdg</code>.</p>

<p>The <i>tfrsync.pl</i> script maintains 4 separate trees of files on the LUKS device being used as the backup disk. The head of each tree is a directory at the top of the file system on the LUKS device. These directories are named &quot;today, &quot;yesterday&quot;, &quot;weekly&quot; and &quot;monthly&quot;. When the script runs, if the current day of the month matches the day of the month of the <code>mtime</code> field of the &quot;today&quot; directory, then the backup operation is performed against that tree. If the current day of the month does not match, then the &quot;yesterday&quot; tree is renamed to &quot;today&quot;, and the &quot;today&quot; tree is renamed to &quot;yesterday&quot;, and then the backup operation is performed against the new &quot;today&quot; tree. After the backup operation is complete, if the current day of the week is Sunday, then the &quot;weekly&quot; tree is updated. Similarly, if the current day of the month is the first day of the month, then the &quot;monthly&quot; tree is updated.</p>

<p>Thus, with this strategy, the 4 trees on the LUKS device will have a backup that is the current backup less than one day old, a backup that is 1 day old, a backup this is 1 week old, and finally a backup that is 1 month old.</p>

<p>The LUKS device encrption scheme uses the AES block cypher, with a 256-bit key, and if you don&#39;t specify a LUKS key when initializing the LUKS device, the DELL service tag will be used. The LUKS initialization step writes the LUKS header on the disk; the header is where the key is stored. The LUKS &quot;key&quot; is really a passphrase used for encrypting a master key which is automatically generated by the system. Thus, the LUKS key is not the key used to encrypt the data but merely allows access to the use of the master key.</p>

<h2 id="Production-Server-Info-File">Production Server Info File</h2>

<p>The production server info file, aka pserver info file, contains key information about the production server. It is generated each time a backup is performed and is copied to the backup server, or cloud server, or device each time there is a backup.</p>

<p>The name of the pserver info file is <i>pserver_info.txt</i> and is located in the <i>/usr2/tfrsync/pserver_info.d</i> directory on an RTI system and in the <i>/d/tfrsync/pserver_info.d</i> directory on a Daisy system. The file is a simple ASCII text file, with each line consisting of an attribute/value pair, separated by an EQUALS SIGN.</p>

<p>The pserver info file contains the following attributes;</p>

<dl>

<dt id="platform">platform</dt>
<dd>

<p>The value is the name of the platform, either &quot;RHEL5&quot;, or &quot;RHEL6&quot;, or &quot;RHEL7&quot;.</p>

</dd>
<dt id="hostname">hostname</dt>
<dd>

<p>The value is the hostname of the production server.</p>

</dd>
<dt id="ipaddr">ipaddr</dt>
<dd>

<p>The IP address of the production server</p>

</dd>
<dt id="netmask">netmask</dt>
<dd>

<p>The netmask of the production server</p>

</dd>
<dt id="gateway">gateway</dt>
<dd>

<p>The IP address of the &quot;gateway&quot;, ie the router.</p>

</dd>
</dl>

<p>As a concrete example, if the production server was a Daisy &quot;RHEL5&quot; system, the pserver info file would look similar to the following, with values adjusted as appropriate:</p>

<pre><code> platform=RHEL5
 hostname=77777700-tsrvr
 ipaddr=192.168.1.21
 netmask=255.255.255.0
 gateway=192.168.1.1</code></pre>

<h2 id="Backup-Summary-Log-File">Backup Summary Log File</h2>

<p>The backup summary log file contains an entry for each execution of the <i>tfrsync.pl</i> script. Each entry is about 750 bytes long and is a short summary of the backup result. This file grows without bound, but due to the relatively small entry size and frequency of execution, it should not be a factor in disk space usage. The backup summary log file can be rotated each year if desired. This rotation is disabled by default, but can be enabled via the <code>--summary-log-rotate</code> command line option or the <code>summary-log-rotate=true</code> statement in the config file. If summary log file rotation is enabled, then upon each execution of <i>tfrsync.pl</i>, the script determines the date of the earliest entry in the summary log file - if the date is more than 1 year earlier than the current date, then the current file is renamed with a name that includes the date of the earliest entry. Then a new summary log file will be established and used for another year. By default, a minimum of 3 copies of the summary log file is kept, and a maximum of 10; these values are configurable on the command line or through the config file.</p>

<p>Each entry in the summary log file consists of a record of 17 lines, one line per field, in the format oulined below. If the value of an entry is not applicable to the type of backup being performed, the value of the field will be the string &quot;NA&quot;.</p>

<dl>

<dt id="separator-line">separator line</dt>
<dd>

<p>A line of 80 &quot;=&quot; chars.</p>

</dd>
<dt id="script-name">script name</dt>
<dd>

<p>The file name of the script, <i>tfrsync.pl</i>.</p>

</dd>
<dt id="script-version">script version</dt>
<dd>

<p>The CVS revision number of the script.</p>

</dd>
<dt id="command-line">command line</dt>
<dd>

<p>The command line used to invoke the script.</p>

</dd>
<dt id="execution-start-time">execution start time</dt>
<dd>

<p>The execution start time in the format of &quot;YMD-HMS&quot;, which for example, Jan 27, 2014 at 10:40 and 24 seconds would be &quot;20150127-104024&quot;.</p>

</dd>
<dt id="execution-stop-time">execution stop time</dt>
<dd>

<p>The execution stop time in the format of &quot;YMD-HMS&quot;, which for example, Jan 27, 2014 at 10:40 and 24 seconds would be &quot;20150127-104024&quot;.</p>

</dd>
<dt id="execution-duration">execution duration</dt>
<dd>

<p>The length of time for the execution in the format of &quot;H:M:S&quot;, which for example, a duration of 0 hours, 10 minutes, and 27 seconds would be &quot;00:10:27&quot;.</p>

</dd>
<dt id="device-type">device type</dt>
<dd>

<p>The backup device type, would will usually be &quot;cloud&quot;, &quot;server&quot;, &quot;passport&quot;, or &quot;usb&quot;.</p>

</dd>
<dt id="result-description">result description</dt>
<dd>

<p>The english equivaliant of the exit status.</p>

</dd>
<dt id="rsync-exit-status">rsync exit status</dt>
<dd>

<p>The exit status reported by the <i>rsync</i> command used to perform the backup.</p>

</dd>
<dt id="rsync-backup-retries">rsync backup retries</dt>
<dd>

<p>The number of times that the <i>rsync</i> command was retried.</p>

</dd>
<dt id="rsync-warnings">rsync warnings</dt>
<dd>

<p>A list of one or more rsync exit status values that are considered to be just warnings. If there are no warnings, then the value is just &quot;0&quot;.</p>

</dd>
<dt id="bytes-written">bytes written</dt>
<dd>

<p>The total number of bytes written by rsync.</p>

</dd>
<dt id="server-IP-addr">server IP addr</dt>
<dd>

<p>The hostname or IP address of the cloud server or the backup server.</p>

</dd>
<dt id="path-on-server">path on server</dt>
<dd>

<p>The value of the <b>--rsync-dir</b> option if it was specified. Not applicable for &quot;cloud&quot; backup.</p>

</dd>
<dt id="device-file-path">device file path</dt>
<dd>

<p>The path of the device file for the backup device, which, for example, might be <i>/dev/sdb1</i> for a Passport device. Not applicable for &quot;cloud&quot; backup.</p>

</dd>
<dt id="backup-device-capacity">backup device capacity</dt>
<dd>

<p>The total capacity of the backup device. Not applicable for &quot;cloud&quot; backup.</p>

</dd>
<dt id="backup-device-available-space">backup device available space</dt>
<dd>

<p>The available space left on the backup device. Not applicable for &quot;cloud&quot; backup.</p>

</dd>
<dt id="separator-line1">separator line</dt>
<dd>

<p>A line of 80 &quot;=&quot; chars.</p>

</dd>
</dl>

<p>Here is an example of the contents of a summary log file:</p>

<pre><code> ================================================================================
     PROGRAM: tfrsync.pl
     VERSION: $Revision: 1.227 $
     COMMAND: /home/tfsupport/tfrsync.pl --server --backup=osconfigs
       BEGIN: 20150210-133052
         END: 20150210-133103
    DURATION: 00:00:11
      DEVICE: server
      RESULT: Exit OK
       RSYNC: 0
     RETRIES: 0
    WARNINGS: 0
  BYTES SENT: 374.17KB
      SERVER: 192.168.2.31
        PATH: /tmp
 DEVICE FILE: NA
    CAPACITY: NA
   AVAILABLE: NA
 ================================================================================</code></pre>

<h1 id="EXAMPLES3">EXAMPLES</h1>

<p>To install the <i>tfrsync.pl</i> script on a Teleflora POS system and configure it as the production server, enter the following:</p>

<pre><code> sudo tfrsync.pl --server --install-production-server</code></pre>

<p>To get info about the installation on the primary server, you can enter the following:</p>

<pre><code> sudo tfrsync.pl --info-production-server</code></pre>

<p>To install the <i>tfrsync.pl</i> script on a Teleflora POS system and configure it as the backup server, enter the following:</p>

<pre><code> sudo tfrsync.pl --install-secondary --production-server=192.168.1.21</code></pre>

<p>On an RTI system, to backup all files in all backup types to the backup server at IP addr 192.168.1.22, in the directory <i>/usr2/tfrsync</i>, enter the following:</p>

<pre><code> sudo tfrsync.pl --server --backup=all --rsync-server=192.168.1.22</code></pre>

<p>To display the filenames contained in the backup type <code>netconfigs</code>, enter the following:</p>

<pre><code> sudo tfrsync.pl --server --backup=netconfigs --show-only</code></pre>

<p>To perform a backup operation to a cloud server with retries, with the number of retries 5 and the time of 3 minutes to wait between each retry, enter the following:</p>

<pre><code> sudo tfrsync.pl --cloud --backup=all --retry-backup --retry-reps=5 --retry-wait=180</code></pre>

<p>To backup a single file, say <i>/etc/motd</i>, from the production server to the backup server and put it in <i>/tmp</i> on the backup server, enter the following:</p>

<pre><code> sudo tfrsync.pl --server --singlefile=/etc/motd --backup=singlefile --rsync-dir=/tmp</code></pre>

<p>To restore the single file <i>/tmp/etc/printcap</i> from the backup server and put it in the <i>/tmp</i> directory on the production server, enter the following:</p>

<pre><code> sudo tfrsync.pl --server --singlefile=/etc/printcap --restore=singlefile \
    --rsync-dir=/tmp --rootdir=/tmp</code></pre>

<p>To use an external USB Western Digital Passport as a LUKS backup device, first install the <i>tfrsync.pl</i> script for use with a LUKS device, then initialize the Passport as a LUKS device, and then you can use it as a backup device. To install the <i>tfrsync.pl</i> script for use with a LUKS device, enter:</p>

<pre><code> sudo tfrsync.pl --luks-install</code></pre>

<p>To initialize the LUKS device, enter the following command - note, by not specifying the <b>--device=s</b> option, the script will look for a Western Digitial Passport connected to the system as block device <code>/dev/sda</code> through <code>/dev/sdg</code>. Also not that if you don&#39;t specify the LUKS key, the DELL service tag will be used.</p>

<pre><code> sudo tfrsync.pl --luks --luks-key=fred --luks-init</code></pre>

<p>To use the Western Digital Passport as the LUKS backup device, enter the command:</p>

<pre><code> sudo tfrsync.pl --backup=all</code></pre>

<p>To get the date of the last backup to the LUKS device, enter the command:</p>

<pre><code> sudo tfrsync.pl --luks --luks-backup-date</code></pre>

<p>To get more information about the LUKS device, enter:</p>

<pre><code> sudo tfrsync.pl --luks --luks-getinfo</code></pre>

<p>To get low level system information about the LUKS device, enter:</p>

<pre><code> sudo tfrsync.pl --luks --luks-status</code></pre>

<p>To view files on the LUKS device, first mount the LUKS device, use ordinary shell commands to view or manipulate files on the LUKS device, and then make sure to umount the LUKS device:</p>

<pre><code> sudo tfrsync.pl --luks --luks-key=fred --luks-mount
 ls -l /mnt/backups
 cp -pr /mnt/backups/yesterday/etc /tmp
 sudo tfrsync.pl --luks --luks-key=fred --luks-umount</code></pre>

<h1 id="FILES11">FILES</h1>

<dl>

<dt id="usr2-tfrsync1"><i>/usr2/tfrsync</i></dt>
<dd>

<p>The <i>tfrsync.pl</i> backup directory for a RTI system.</p>

</dd>
<dt id="d-tfrsync1"><i>/d/tfrsync</i></dt>
<dd>

<p>The <i>tfrsync.pl</i> backup directory for a Daisy system.</p>

</dd>
<dt id="home-tfrsync"><i>/home/tfrsync</i></dt>
<dd>

<p>The home directory of the <i>tfrsync</i> account.</p>

</dd>
<dt id="home-tfsupport1"><i>/home/tfsupport</i></dt>
<dd>

<p>The home directory of the Teleflora support account</p>

</dd>
<dt id="home-tfsupport-pserver_xfer.d"><i>/home/tfsupport/pserver_xfer.d</i></dt>
<dd>

<p>The production server transfer directory.</p>

</dd>
<dt id="pserver_cloister.d"><i>pserver_cloister.d</i></dt>
<dd>

<p>The production server cloister directory is located in the <i>tfrsync.pl</i> backup directory.</p>

</dd>
<dt id="pserver_info.d"><i>pserver_info.d</i></dt>
<dd>

<p>the production server info directory and is located in the <i>tfrsync.pl</i> backup directory.</p>

</dd>
<dt id="pserver_info.txt"><i>pserver_info.txt</i></dt>
<dd>

<p>The production server info file - it contains information about the production server and is located in the production server info directory. The production server info file is generated each time a backup transaction occurs. Contents include the production server platform string (either &quot;RHEL5&quot;, or &quot;RHEL6&quot;, or &quot;RHEL7&quot;), the production server&#39;s hostname, IP address, and netmask, and the gateway IP address.</p>

</dd>
<dt id="users_info.d"><i>users_info.d</i></dt>
<dd>

<p>The users info directory is located in the <i>tfrsync.pl</i> backup directory.</p>

</dd>
<dt id="usr2-tfrsync-users_info.d-rti_users_listing.txt"><i>/usr2/tfrsync/users_info.d/rti_users_listing.txt</i></dt>
<dd>

<p>The RTI users listing file.</p>

</dd>
<dt id="usr2-tfrsync-users_info.d-rti_users_shadow.txt"><i>/usr2/tfrsync/users_info.d/rti_users_shadow.txt</i></dt>
<dd>

<p>The shadow file entries for the users in the RTI users listing file.</p>

</dd>
<dt id="d-tfrsync-users_info.d-daisy_users_listing.txt"><i>/d/tfrsync/users_info.d/daisy_users_listing.txt</i></dt>
<dd>

<p>The Daisy users listing file.</p>

</dd>
<dt id="d-tfrsync-users_info.d-daisy_users_shadow.txt"><i>/d/tfrsync/users_info.d/daisy_users_shadow.txt</i></dt>
<dd>

<p>The shadow file entries for the users in the Daisy users listing file.</p>

</dd>
<dt id="id_rsa.pub"><i>id_rsa.pub</i></dt>
<dd>

<p>The name of the public SSH key file.</p>

</dd>
<dt id="etc-cron.d-tfrsync"><i>/etc/cron.d/tfrsync</i></dt>
<dd>

<p>the <i>tfrsync.pl</i> cron job file.</p>

</dd>
<dt id="tfrsync-server-Day_nn.log"><i>tfrsync-server-Day_nn.log</i></dt>
<dd>

<p>The name of the log file for destination class &quot;server&quot;. The string <i>nn</i> is replaced by the zero filled, two digit day of the month.</p>

</dd>
<dt id="tfrsync-cloud-Day_nn.log"><i>tfrsync-cloud-Day_nn.log</i></dt>
<dd>

<p>The name of the log file for destination class &quot;cloud&quot;. The string <i>nn</i> is replaced by the zero filled, two digit day of the month.</p>

</dd>
<dt id="tfrsync-device-Day_nn.log"><i>tfrsync-device-Day_nn.log</i></dt>
<dd>

<p>The name of the log file for destination class &quot;device&quot;. The string <i>nn</i> is replaced by the zero filled, two digit day of the month.</p>

</dd>
<dt id="tfrsync-summary.log"><i>tfrsync-summary.log</i></dt>
<dd>

<p>The summary log file contains an entry for each execution of the <i>tfrsync.pl</i> script with a short summary of the result.</p>

</dd>
<dt id="usr2-bbx-log"><i>/usr2/bbx/log</i></dt>
<dd>

<p>On an RTI system, the location of the log files. If this directory does not exist, the log files will be put in <i>/tmp</i>.</p>

</dd>
<dt id="d-daisy-log1"><i>/d/daisy/log</i></dt>
<dd>

<p>On a Daisy system, the location of the log files. If this directory does not exist, the log files will be put in <i>/tmp</i>.</p>

</dd>
<dt id="usr2-ostools-config1"><i>/usr2/ostools/config</i></dt>
<dd>

<p>The location of the default <i>tfrsync.pl</i> config file for an RTI system.</p>

</dd>
<dt id="d-ostools-config2"><i>/d/ostools/config</i></dt>
<dd>

<p>The location of the default <i>tfrsync.pl</i> config file for a Daisy system.</p>

</dd>
<dt id="tfrsync.conf"><i>tfrsync.conf</i></dt>
<dd>

<p>The name of the default <i>tfrsync.pl</i> config file.</p>

</dd>
<dt id="usr2-ostools-config-tfrsync.d"><i>/usr2/ostools/config/tfrsync.d</i></dt>
<dd>

<p>The location of optional custom config files for an RTI system.</p>

</dd>
<dt id="d-ostools-config-tfrsync.d"><i>/d/ostools/config/tfrsync.d</i></dt>
<dd>

<p>The location of optional custom config files for a Daisy system.</p>

</dd>
<dt id="mnt-backups1"><i>/mnt/backups</i></dt>
<dd>

<p>Mount point for backup devices.</p>

</dd>
<dt id="etc-redhat-release4"><i>/etc/redhat-release</i></dt>
<dd>

<p>Contents determines OS type.</p>

</dd>
<dt id="sys-block-sda-sdb-sdc-sde-sdd-device-vendor1"><i>/sys/block/{sda,sdb,sdc,sde,sdd}/device/vendor</i></dt>
<dd>

<p>This file contains the vendor string for the block device, ie disk, that has special device file &quot;/dev/sda&quot;, or &quot;/dev/sdb&quot;, etc.</p>

</dd>
<dt id="sys-block-sda-sdb-sdc-sde-sdd-device-model1"><i>/sys/block/{sda,sdb,sdc,sde,sdd}/device/model</i></dt>
<dd>

<p>This file contains the model string for the block device, ie disk, that has special device file &quot;/dev/sda&quot;, or &quot;/dev/sdb&quot;, etc.</p>

</dd>
<dt id="usr2-tfrsync-backuptype-perms.txt"><i>/usr2/tfrsync/$backuptype-perms.txt</i></dt>
<dd>

<p>The metadata files generated on a RTI system when doing a backup to the cloud. See the output of <i>tfrsync.pl --help</i> for a list of backup type values that &quot;$backuptype&quot; may take.</p>

</dd>
<dt id="d-tfrsync-backuptype-perms.txt"><i>/d/tfrsync/$backuptype-perms.txt</i></dt>
<dd>

<p>The metadata files generated on a Daisy sysstem when doing a backup to the cloud. See the output of <i>tfrsync.pl --help</i> for a list of backup type values that &quot;$backuptype&quot; may take.</p>

</dd>
<dt id="var-lock-tfrsync-server.lock"><i>/var/lock/tfrsync-server.lock</i></dt>
<dd>

</dd>
<dt id="var-lock-tfrsync-cloud.lock"><i>/var/lock/tfrsync-cloud.lock</i></dt>
<dd>

</dd>
<dt id="var-lock-tfrsync-device.lock"><i>/var/lock/tfrsync-device.lock</i></dt>
<dd>

<p>The process lock file. There is a separate process lock file for each of the device types. The process lock file path will be one of the paths above, for either the &quot;server&quot;, &quot;cloud&quot;, or &quot;device&quot;, which corresponds to each of the device types. When the script starts, an attempt is made to acquire the lock file corresponding to the device type; if the lock file already exists when this check is made, then it indicates that an existing process has the lock for that device type and thus, a new process is not allowed to proceed.</p>

</dd>
<dt id="var-run-tfrsync-server.socket"><i>/var/run/tfrsync-server.socket</i></dt>
<dd>

</dd>
<dt id="var-run-tfrsync-cloud.socket"><i>/var/run/tfrsync-cloud.socket</i></dt>
<dd>

<p>The SSH tunnel socket. There is a separate SSH tunnel socket for each of the destination classes. For the backup destination class &quot;server&quot;, the name of the socket is <i>tfrsync-server.socket</i>. For the &quot;cloud&quot; destination class, the name is <i>tfrsync-cloud.socket</i>. When a backup or restore operation is performed, an attempt is made to establish an SSH tunnel on a socket at the appropriate path. If the socket already exists, it indicates that a previous process used the socket for a connection to the remote device and crashed without cleaning up the socket; the <b>--runtime-cleanup</b> command can be used to cleanup stale sockets. If the SSH command returns an exit status of 255, the script makes 3 attempts to open the socket before returning an error.</p>

</dd>
<dt id="tmp-tfrsync-rsyncstats-XXXXXXX"><i>/tmp/tfrsync-rsyncstats-XXXXXXX</i></dt>
<dd>

<p>A temp file to hold the stats generated during a successful rsync command. The stats are compiled immedately after a rsync command completes and then the temp file is deleted.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS9">DIAGNOSTICS</h1>

<dl>

<dt id="Error:-invalid-command-line-option-exiting">&quot;Error: invalid command line option, exiting...&quot;</dt>
<dd>

<p>This message is output if an invalid command line option was entered.</p>

</dd>
<dt id="cloud-and---server-are-mutually-exclusive">&quot;--cloud and --server are mutually exclusive&quot;</dt>
<dd>

<p>Only one of the &quot;--cloud&quot; and &quot;--server&quot; command line options may appear on the command line at an execution of the script - either you are doing a &quot;cloud&quot; backup or a &quot;server&quot; backup. If your production server is configured to be backed up to both, then you must run &quot;tfrsync.pl&quot; twice, once for &quot;cloud&quot;, and once for &quot;server&quot;.</p>

</dd>
<dt id="tfrsync.pl-must-be-run-as-root-or-with-sudo">&quot;tfrsync.pl must be run as root or with sudo&quot;</dt>
<dd>

<p>You can run the &quot;tfrsync.pl&quot; script with the &quot;--help&quot; or &quot;--version&quot; command line options as a non-root user, but any other usage must be run as root.</p>

</dd>
<dt id="tfr_finddev-backup-device-not-found">&quot;[tfr_finddev] backup device not found&quot;</dt>
<dd>

<p>Error message if the <b>--finddev</b> or <b>--report-device</b> command line option is specified and a USB or Passport backup device is not found.</p>

</dd>
</dl>

<h1 id="EXIT-STATUS2">EXIT STATUS</h1>

<dl>

<dt id="Exit-status-0-EXIT_OK6">Exit status 0 ($EXIT_OK)</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1-EXIT_COMMAND_LINE5">Exit status 1 ($EXIT_COMMAND_LINE)</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
<dt id="Exit-status-2-EXIT_MUST_BE_ROOT3">Exit status 2 ($EXIT_MUST_BE_ROOT)</dt>
<dd>

<p>The script must run as root or with sudo(1).</p>

</dd>
<dt id="Exit-status-3-EXIT_ROOTDIR1">Exit status 3 ($EXIT_ROOTDIR)</dt>
<dd>

<p>The directory specified for <b>--rootdir</b> does not exist.</p>

</dd>
<dt id="Exit-status-4-EXIT_TOOLSDIR1">Exit status 4 ($EXIT_TOOLSDIR)</dt>
<dd>

<p>The OSTools directory does not exist.</p>

</dd>
<dt id="Exit-status-5-EXIT_BACKUP_DEVICE_NOT_FOUND1">Exit status 5 ($EXIT_BACKUP_DEVICE_NOT_FOUND)</dt>
<dd>

<p>A backup device of any kind was not found.</p>

</dd>
<dt id="Exit-status-6-EXIT_USB_DEVICE_NOT_FOUND1">Exit status 6 ($EXIT_USB_DEVICE_NOT_FOUND)</dt>
<dd>

<p>The <b>--usb-device</b> option was specified but a USB backup device was not found.</p>

</dd>
<dt id="Exit-status-7-EXIT_BACKUP_TYPE1">Exit status 7 ($EXIT_BACKUP_TYPE)</dt>
<dd>

<p>The backup type specified with <b>--backup</b> is not supported.</p>

</dd>
<dt id="Exit-status-8-EXIT_MOUNT_ERROR">Exit status 8 ($EXIT_MOUNT_ERROR)</dt>
<dd>

<p>An error occurred when trying to mount a backup device that was of type block device or image file.</p>

</dd>
<dt id="Exit-status-9-EXIT_RESTORE">Exit status 9 ($EXIT_RESTORE)</dt>
<dd>

<p>An unsupported restore type was specified on the command line.</p>

</dd>
<dt id="Exit-status-10-EXIT_DEVICE_NOT_SPECIFIED">Exit status 10 ($EXIT_DEVICE_NOT_SPECIFIED)</dt>
<dd>

<p>A backup device was not specified nor could be found</p>

</dd>
<dt id="Exit-status-11-EXIT_DEVICE_VERIFY1">Exit status 11 ($EXIT_DEVICE_VERIFY)</dt>
<dd>

<p>The specified backup device is either not a block device or is not an image file of minimum size.</p>

</dd>
<dt id="Exit-status-12-EXIT_USB_DEVICE_UNSUPPORTED1">Exit status 12 ($EXIT_USB_DEVICE_UNSUPPORTED)</dt>
<dd>

<p>USB devices other than WD Passports are not supported on RHEL4.</p>

</dd>
<dt id="Exit-status-13-EXIT_CRON_JOB_FILE">Exit status 13 ($EXIT_CRON_JOB_FILE)</dt>
<dd>

<p>An error occurred when installing the cron job file.</p>

</dd>
<dt id="Exit-status-14-EXIT_DEF_CONFIG_FILE">Exit status 14 ($EXIT_DEF_CONFIG_FILE)</dt>
<dd>

<p>An error occurred when installing the default config file.</p>

</dd>
<dt id="Exit-status-15-EXIT_FORMAT">Exit status 15 ($EXIT_FORMAT)</dt>
<dd>

<p>An error occurred when formatting the backup device.</p>

</dd>
<dt id="Exit-status-16-EXIT_LIST_UNSUP">Exit status 16 ($EXIT_LIST_UNSUP)</dt>
<dd>

<p>An unsupported list type was specified on the command line.</p>

</dd>
<dt id="Exit-status-17-EXIT_LIST">Exit status 17 ($EXIT_LIST)</dt>
<dd>

<p>The files of the specified backup type could not be listed.</p>

</dd>
<dt id="Exit-status-18-EXIT_SIGINT">Exit status 18 ($EXIT_SIGINT)</dt>
<dd>

<p>Script received interrupt signal during a rsync transaction.</p>

</dd>
<dt id="Exit-status-19-EXIT_RSYNC_ACCOUNT">Exit status 19 ($EXIT_RSYNC_ACCOUNT)</dt>
<dd>

<p>An error occurred either when making the <i>tfrsync</i> account while installing or when removing the <i>tfrsync</i> account while uninstalling.</p>

</dd>
<dt id="Exit-status-20-EXIT_SSH_GENERATE_KEYS">Exit status 20 ($EXIT_SSH_GENERATE_KEYS)</dt>
<dd>

<p>An error occurred when generating the RSA keypair for the account used to run the rsync command.</p>

</dd>
<dt id="Exit-status-21-EXIT_SSH_GET_PUBLIC_KEY">Exit status 21 ($EXIT_SSH_GET_PUBLIC_KEY)</dt>
<dd>

<p>An error occurred when getting the public key for an <code>rsync</code> account on the production server.</p>

</dd>
<dt id="Exit-status-22-EXIT_SSH_GET_PRIVATE_KEY">Exit status 22 ($EXIT_SSH_GET_PRIVATE_KEY)</dt>
<dd>

<p>An error occurred when getting the private key for an <code>rsync</code> account on the production server.</p>

</dd>
<dt id="Exit-status-23-EXIT_SSH_SUDO_CONF">Exit status 23 ($EXIT_SSH_SUDO_CONF)</dt>
<dd>

<p>An error occurred configuring the <i>/etc/sudoers</i> file to allow an <code>rsync</code> account to run <i>rsync</i> command via <i>sudo</i>; this is accomplished not by directly editing <i>/etc/sudoers</i>, but rather by using the mechanism for doing this provided in the <i>harden_linux.pl</i> config file.</p>

</dd>
<dt id="Exit-status-24-EXIT_SSH_TUNNEL_OPEN">Exit status 24 ($EXIT_SSH_TUNNEL_OPEN)</dt>
<dd>

<p>An error occurred opening SSH tunnel.</p>

</dd>
<dt id="Exit-status-25-EXIT_SSH_TUNNEL_CLOSE">Exit status 25 ($EXIT_SSH_TUNNEL_CLOSE)</dt>
<dd>

<p>An error occurred closing SSH tunnel.</p>

</dd>
<dt id="Exit-status-26-EXIT_SSH_COPY_PUBLIC_KEY">Exit status 26 ($EXIT_SSH_COPY_PUBLIC_KEY)</dt>
<dd>

<p>An error occurred when trying to copy the newly generated public key of the <code>rsync</code> account to the default SSH dir of the <i>tfsupport</i> account.</p>

</dd>
<dt id="Exit-status-27-EXIT_SSH_ID_FILE">Exit status 27 ($EXIT_SSH_ID_FILE)</dt>
<dd>

<p>The path to the SSH identity file for a specified account could not be found.</p>

</dd>
<dt id="Exit-status-29-EXIT_CLOUD_ACCOUNT_NAME">Exit status 29 ($EXIT_CLOUD_ACCOUNT_NAME)</dt>
<dd>

<p>An error occurred forming the name of the cloud account.</p>

</dd>
<dt id="Exit-status-30-EXIT_GENERATE_PERMS">Exit status 30 ($EXIT_GENERATE_PERMS)</dt>
<dd>

<p>An error occurred generating the perm file for a backup type.</p>

</dd>
<dt id="Exit-status-31-EXIT_UPLOAD_PERMS">Exit status 31 ($EXIT_UPLOAD_PERMS)</dt>
<dd>

<p>An error occurred uploading a perm file to the cloud server.</p>

</dd>
<dt id="Exit-status-32-EXIT_RESTORE_PERMS">Exit status 32 ($EXIT_RESTORE_PERMS)</dt>
<dd>

<p>When restoring perms from a perm file via the <b>--restore-from-permfiles</b> command line option, there was an error restoring the perms on the files corresponding to the specified backup type.</p>

</dd>
<dt id="Exit-status-33-EXIT_DOWNLOAD_PERMS">Exit status 33 ($EXIT_DOWNLOAD_PERMS)</dt>
<dd>

<p>When downloading a perm file via the <b>--download-permfiles</b> command line option, the perm file corresponding to the specified backup type can not be downloaded from the cloud server.</p>

</dd>
<dt id="Exit-status-34-EXIT_PERM_FILE_MISSING">Exit status 34 ($EXIT_PERM_FILE_MISSING)</dt>
<dd>

<p>When restoring permissions from a perm file via the <b>--restore-from-permfiles</b> command line option, the perm file corresponding to the specified backup type can not be found.</p>

</dd>
<dt id="Exit-status-40-EXIT_LOCK_ACQUISITION">Exit status 40 ($EXIT_LOCK_ACQUISITION)</dt>
<dd>

<p>Could not acquire the appropriate lockfile which means some previous instance of the script is still running.</p>

</dd>
<dt id="Exit-status-41-EXIT_BACKUP_DEVICE_CONFLICT">Exit status 41 ($EXIT_BACKUP_DEVICE_CONFLICT)</dt>
<dd>

<p>If a backup device is specified with <b>--device</b> or a usb device is specified with <b>--usb-device</b> and <b>--rsync-server</b> is specified, this error results. You may not back up to both a device and an rsync server at the same time.</p>

<p>Likewise, if a backup device is specified with <b>--device</b> or a usb device is specified with <b>--usb-device</b> and <b>--rsync-dir</b> is specified and not <b>--rsync-server</b>, this error results. You may not back up to both a device and a file system at the same time.</p>

</dd>
<dt id="Exit-status-42-EXIT_PLATFORM">Exit status 42 ($EXIT_PLATFORM)</dt>
<dd>

<p>Unknown operating system.</p>

</dd>
<dt id="Exit-status-43-EXIT_RSYNC_ERROR">Exit status 43 ($EXIT_RSYNC_ERROR)</dt>
<dd>

<p>The <i>rsync</i> command returned an error. This script response is to stop backup transactions and exit.</p>

</dd>
<dt id="Exit-status-44-EXIT_USERS_INFO_SAVE">Exit status 44 ($EXIT_USERS_INFO_SAVE)</dt>
<dd>

<p>The users info files could not be generated and saved when attempting a backup.</p>

</dd>
<dt id="Exit-status-45-EXIT_PSERVER_INFO_SAVE">Exit status 45 ($EXIT_PSERVER_INFO_SAVE)</dt>
<dd>

<p>The pserver info file could not be saved when attempting a backup.</p>

</dd>
<dt id="Exit-status-46-EXIT_PSERVER_CLOISTER_FILES_SAVE">Exit status 46 ($EXIT_PSERVER_CLOISTER_FILES_SAVE)</dt>
<dd>

<p>The pserver cloister files cound not saved when attempting a backup.</p>

</dd>
<dt id="Exit-status-50-EXIT_XFERDIR_WRITE_ERROR">Exit status 50 ($EXIT_XFERDIR_WRITE_ERROR)</dt>
<dd>

<p>An error occurred when attempting to write a file in the xfer dir.</p>

</dd>
<dt id="Exit-status-51-EXIT_XFERDIR_MKDIR">Exit status 51 ($EXIT_XFERDIR_MKDIR)</dt>
<dd>

<p>An error occurred when attempting to make the transfer directory. This could happen during installation on the production or the backup server.</p>

</dd>
<dt id="Exit-status-52-EXIT_XFERDIR_RMDIR">Exit status 52 ($EXIT_XFERDIR_RMDIR)</dt>
<dd>

<p>An error occurred when attempting to remove the transfer directory.</p>

</dd>
<dt id="Exit-status-53-EXIT_INFODIR_MKDIR">Exit status 53 ($EXIT_INFODIR_MKDIR)</dt>
<dd>

<p>An error occurred when attempting to make the production server info directory.</p>

</dd>
<dt id="Exit-status-54-EXIT_INFODIR_RMDIR">Exit status 54 ($EXIT_INFODIR_RMDIR)</dt>
<dd>

<p>An error occurred when attempting to remove the production server info directory.</p>

</dd>
<dt id="Exit-status-55-EXIT_USERSDIR_MKDIR">Exit status 55 ($EXIT_USERSDIR_MKDIR)</dt>
<dd>

<p>An error occurred when attempting to make the users info directory.</p>

</dd>
<dt id="Exit-status-56-EXIT_USERSDIR_RMDIR">Exit status 56 ($EXIT_USERSDIR_RMDIR)</dt>
<dd>

<p>An error occurred when attempting to remove the users info directory.</p>

</dd>
<dt id="Exit-status-57-EXIT_TOP_LEVEL_MKDIR">Exit status 57 ($EXIT_TOP_LEVEL_MKDIR)</dt>
<dd>

<p>Could not make the top level backup dir, ie <i>/usr2/tfrsync</i> on RTI, or <i>/d/tfrsync</i> on Daisy.</p>

</dd>
<dt id="Exit-status-58-EXIT_INSTALL_PSERVER_INFO_FILE">Exit status 58 ($EXIT_INSTALL_PSERVER_INFO_FILE)</dt>
<dd>

<p>An error occurred when attempting to copy the info file from the production server to the backup server.</p>

</dd>
<dt id="Exit-status-59-EXIT_DOVE_SERVER_MISSING">Exit status 59 ($EXIT_DOVE_SERVER_MISSING)</dt>
<dd>

<p>During installation on the backup server, the script verifies that the Dove server script exists and if it does not, the script exits with this exit status.</p>

</dd>
<dt id="Exit-status-60-EXIT_DOVE_SERVER_SAVE_EXISTS">Exit status 60 ($EXIT_DOVE_SERVER_SAVE_EXISTS)</dt>
<dd>

<p>During installation on the backup server, the script verifies that the saved Dover server script does NOT exist, and if it does, the script exits with this exit status.</p>

</dd>
<dt id="Exit-status-62-EXIT_CLOISTERDIR_MKDIR">Exit status 62 ($EXIT_CLOISTERDIR_MKDIR)</dt>
<dd>

<p>An error occurred when attempting to make the directory for the production server cloistered files.</p>

</dd>
<dt id="Exit-status-63-EXIT_CLOISTERDIR_RMDIR">Exit status 63 ($EXIT_CLOISTERDIR_RMDIR)</dt>
<dd>

<p>An error occurred when attempting to remove the directory for the production server cloistered files.</p>

</dd>
<dt id="Exit-status-64-EXIT_RUNTIME_CLEANUP">Exit status 64 ($EXIT_RUNTIME_CLEANUP)</dt>
<dd>

<p>Could not cleanup the process lock or the SSH tunnel socket.</p>

</dd>
<dt id="Exit-status-70-EXIT_COULD_NOT_EXECUTE">Exit status 70 ($EXIT_COULD_NOT_EXECUTE)</dt>
<dd>

<p>The script was attempting to exec a program, typically via the builtin fuction <code>system</code>, and the exec of the program failed.</p>

</dd>
<dt id="Exit-status-71-EXIT_FROM_SIGNAL">Exit status 71 ($EXIT_FROM_SIGNAL)</dt>
<dd>

<p>The script execed a program and the program exited because it caught a signal.</p>

</dd>
<dt id="Exit-status-72-EXIT_LOGFILE_SETUP">Exit status 72 ($EXIT_LOGFILE_SETUP)</dt>
<dd>

<p>An error occurred while attempting to establish the location for the log files.</p>

</dd>
<dt id="Exit-status-73-EXIT_NET_IPADDR">Exit status 73 ($EXIT_NET_IPADDR)</dt>
<dd>

<p>Could not get the ip address of the network device.</p>

</dd>
<dt id="Exit-status-74-EXIT_NET_NETMASK">Exit status 74 ($EXIT_NET_NETMASK)</dt>
<dd>

<p>Could not get the netmask of the network device.</p>

</dd>
<dt id="Exit-status-75-EXIT_NET_GATEWAY">Exit status 75 ($EXIT_NET_GATEWAY)</dt>
<dd>

<p>Could not get the ip address of the gateway (router).</p>

</dd>
<dt id="Exit-status-92-EXIT_SEND_TEST_EMAIL">Exit status 92 ($EXIT_SEND_TEST_EMAIL)</dt>
<dd>

<p>Could not send a test email message.</p>

</dd>
<dt id="Exit-status-93-EXIT_LUKS_UUID">Exit status 93 ($EXIT_LUKS_UUID)</dt>
<dd>

<p>Could not get UUID for LUKS device.</p>

</dd>
<dt id="Exit-status-94-EXIT_LUKS_STATUS">Exit status 94 ($EXIT_LUKS_STATUS)</dt>
<dd>

<p>Could not get status for LUKS device.</p>

</dd>
<dt id="Exit-status-95-EXIT_LUKS_GETINFO">Exit status 95 ($EXIT_LUKS_GETINFO)</dt>
<dd>

<p>Could not get info about LUKS device.</p>

</dd>
</dl>

<h1 id="SEE-ALSO11">SEE ALSO</h1>

<p><i>rsync(1)</i>, <i>rtibackup.pl</i>, <i>harden_linux.pl</i></p>

<h1 id="NAME12">NAME</h1>

<p>tfsupport.pl - Teleflora Support Menus</p>

<h1 id="VERSION12">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.205 $</p>

<h1 id="USAGE8">USAGE</h1>

<p>tfsupport.pl</p>

<p>tfsupport.pl <b>--version</b></p>

<p>tfsupport.pl <b>--help</b></p>

<h1 id="OPTIONS11">OPTIONS</h1>

<dl>

<dt id="version12"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help12"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
</dl>

<h1 id="DESCRIPTION12">DESCRIPTION</h1>

<p>The <code>tfsupport.pl</code> script offers a system of menus for Teleflora customer service staff which provides a convenient, reliable, efficient, platform indepenent method for performing many tasks commonly required on a RTI/Daisy server. Since this script occasionally runs commands via <code>sudo(1)</code>, a member of the &quot;rtiadmins&quot; or &quot;dsyadmins&quot; group should run the script.</p>

<p>Since the menus are implemented with the <code>dialog</code> command, the &quot;TERM&quot; environment variable must be defined before execution of the script. If not defined, the script will exit by execing a BASH shell with output asking the user to fix the situation. If the platform is not &quot;RHEL6&quot;, and the value of &quot;TERM&quot; is &quot;ansi&quot;, then the value of &quot;TERM&quot; is set to &quot;scoansi-old&quot;. If the platform is &quot;RHEL6&quot;, and the value of &quot;TERM&quot; is &quot;ansi&quot;, then the value of &quot;TERM&quot; is set to &quot;linux&quot;. Testing with a Putty connection from a PC to an RTI server has shown these values to be the best for working with RTI and <code>dialog(1)</code> command.</p>

<p>There is an inactivity limit of 15 minutes. Thus, if the script is displaying the starting support menu for more than 15 minutes, the script exits.</p>

<p>Log messages are logged via the <code>logger(1)</code> command and thus by default go to <code>/var/log/messages</code>.</p>

<p>The menu item &quot;Backup -&gt; Advanced -&gt; Logs&quot; displays a picklist of log files to view. For each log file, the verification status is displayed to the right of the file name. If there was a verification failure anywhere in the log file, then the string &quot;FAILED&quot; is displayed. If there are no verification errors and there is at least one verification success, then the string &quot;SUCCESS&quot; is displayed. If there is no verification status in the log file, then the string &quot;Please view log for status&quot; is displayed.</p>

<p>The menu item &quot;Backups -&gt; Backup History&quot; uses the script <code>checkbackup.pl</code> to get a summary of recent backup results for RTI systems.</p>

<h1 id="FILES12">FILES</h1>

<dl>

<dt id="var-log-messages4"><b>/var/log/messages</b></dt>
<dd>

<p>The default log file.</p>

</dd>
<dt id="etc-redhat-release5"><b>/etc/redhat-release</b></dt>
<dd>

<p>The file that contains the platform release version information.</p>

</dd>
<dt id="rtibackup-Day_01.log-..-rtibackup-Day_31.log"><b>rtibackup-Day_01.log .. rtibackup-Day_31.log</b></dt>
<dd>

<p>A set of daily <code>rtibackup.pl</code> log files. For Daisy systems, they are located in <code>/d/daisy/log</code>. For RTI systems, they are located in <code>/usr2/bbx/log</code>.</p>

</dd>
<dt id="var-lock-rtisendfax.lock"><b>/var/lock/rtisendfax.lock</b></dt>
<dd>

<p>The lock file used by <code>rti_sendfax.pl</code>.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS10">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-04">Exit status 0</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-12">Exit status 1</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
<dt id="Exit-status-22">Exit status 2</dt>
<dd>

<p>An unexpected error was reported by the <i>dialog</i> command.</p>

</dd>
<dt id="Exit-status-31">Exit status 3</dt>
<dd>

<p>The script was run with an effective UID of 0 which is not allowed.</p>

</dd>
</dl>

<h1 id="SEE-ALSO12">SEE ALSO</h1>

<p><code>rtibackup.pl</code>, <code>updateos.pl</code>, <code>harden_linux.pl</code>, <code>install-ostools.pl</code>, <code>bbjservice.pl</code>, <code>checkbackup.pl</code>, <code>doveserver.pl</code>, <code>rti_sendfax.pl</code>, <code>lsusb(8)</code> <code>lpstat(1)</code></p>

<h1 id="NAME13">NAME</h1>

<p>updateos.pl - Teleflora Operating System Updater</p>

<h1 id="VERSION13">VERSION</h1>

<p>This documenation refers to version: $Revision: 1.347 $</p>

<h1 id="USAGE9">USAGE</h1>

<p>updateos.pl</p>

<p>updateos.pl <b>--version</b></p>

<p>updateos.pl <b>--help</b></p>

<p>updateos.pl <b>--verbose</b></p>

<p>updateos.pl <b>--baremetal</b></p>

<p>updateos.pl <b>--rti14</b></p>

<p>updateos.pl <b>--[no]rti14-truncated</b></p>

<p>updateos.pl <b>--daisy</b></p>

<p>updateos.pl <b>--daisy-start</b></p>

<p>updateos.pl <b>--daisy-stop</b></p>

<p>updateos.pl <b>--daisy-shopcode</b></p>

<p>updateos.pl <b>--daisy-shopname</b></p>

<p>updateos.pl <b>--rti-shopcode</b></p>

<p>updateos.pl <b>--rti-shopname</b></p>

<p>updateos.pl <b>--ospatches</b></p>

<p>updateos.pl <b>--ostools</b></p>

<p>updateos.pl <b>--java</b></p>

<p>updateos.pl <b>--java-version=s</b></p>

<p>updateos.pl <b>--ipaddr=s [--ifname=s] [--netmask=s --gateway=s]</b></p>

<p>updateos.pl <b>--namserver=s</b></p>

<p>updateos.pl <b>--(i18n|gen-i18n-conf)</b></p>

<p>updateos.pl <b>--locale</b></p>

<p>updateos.pl <b>--yum</b></p>

<p>updateos.pl <b>--ups [--(ups-serial|ups-usb)]</b></p>

<p>updateos.pl <b>--cupsconf</b></p>

<p>updateos.pl <b>--cupstmp</b></p>

<p>updateos.pl <b>--purgeprint</b></p>

<p>updateos.pl <b>--purgerpms</b></p>

<p>updateos.pl <b>--keepkernels=n</b></p>

<p>updateos.pl <b>--(inittab|default-runlevel)</b></p>

<p>updateos.pl <b>--default-target</b></p>

<p>updateos.pl <b>--default-password-hash</b></p>

<p>updateos.pl <b>--syslog-mark=n</b></p>

<p>updateos.pl <b>--kernel-msg-console=n</b></p>

<p>updateos.pl <b>--samba-gen-conf</b></p>

<p>updateos.pl <b>--samba-set-passdb</b></p>

<p>updateos.pl <b>--samba-rebuild-passdb</b></p>

<p>updateos.pl <b>--bbj-gen-settings-file</b></p>

<p>updateos.pl <b>--bbj-gen-properties-file</b></p>

<p>updateos.pl <b>--configure-grub2</b></p>

<p>updateos.pl <b>--init-console-res</b></p>

<p>updateos.pl <b>--enable-boot-msgs</b></p>

<p>updateos.pl <b>--disable-kms</b></p>

<p>updateos.pl <b>--uninstall-readahead</b></p>

<p>updateos.pl <b>--sub-mgr-identity</b></p>

<p>updateos.pl <b>--sub-mgr-register</b></p>

<p>updateos.pl <b>--sub-mgr-unregister</b></p>

<p>updateos.pl <b>--sub-mgr-status</b></p>

<p>updateos.pl <b>--audit-system-configure</b></p>

<p>updateos.pl <b>--audit-system-rules-file=s</b></p>

<p>updateos.pl <b>--swapon</b></p>

<p>updateos.pl <b>--report-swap-size</b></p>

<p>updateos.pl <b>--report-architecture</b></p>

<h1 id="OPTIONS12">OPTIONS</h1>

<dl>

<dt id="version13"><b>--version</b></dt>
<dd>

<p>Output the version number of the script and exit.</p>

</dd>
<dt id="help13"><b>--help</b></dt>
<dd>

<p>Output a short help message and exit.</p>

</dd>
<dt id="verbose4"><b>--verbose</b></dt>
<dd>

<p>For some operations, output more information.</p>

</dd>
<dt id="baremetal"><b>--baremetal</b></dt>
<dd>

<p>Perpare a system to be ready for installation of a POS, either Daisy or RTI. It is assumed that the system has been kickstarted but has had no other prep.</p>

</dd>
<dt id="rti14"><b>--rti14</b></dt>
<dd>

<p>Assumes that the system has only had a kickstart and <code>updateos.pl --baremetal</code> run on it. Verify that the system is ready for installation of the RTI Point of Sales system and further prepare for the installation of RTI. Do not install Java, BBj, or BLM.</p>

</dd>
<dt id="no-rti14-truncated"><b>--[no]rti14-truncated</b></dt>
<dd>

<p>The default action for <b>--rti14</b> is a truncated RTI install, i.e. <b>--rti14-truncated</b> is the default. To perform a full RTI install, specify <b>--rti14 --norti14-truncated</b>.</p>

</dd>
<dt id="daisy4"><b>--daisy</b></dt>
<dd>

<p>Install the Daisy POS onto a system. It is assumed that the system has been kickstarted and only had <b>--baremetal</b> run on it.</p>

</dd>
<dt id="daisy-start"><b>--daisy-start</b></dt>
<dd>

<p>Start the Daisy POS application - assumes it is stopped.</p>

</dd>
<dt id="daisy-stop"><b>--daisy-stop</b></dt>
<dd>

<p>Stop the Daisy POS application - system will be at runlevel 4 after running this option.</p>

</dd>
<dt id="daisy-shopcode"><b>--daisy-shopcode</b></dt>
<dd>

<p>Output the Daisy shopcode.</p>

</dd>
<dt id="daisy-shopname"><b>--daisy-shopname</b></dt>
<dd>

<p>Output the Daisy shopname.</p>

</dd>
<dt id="rti-shopcode"><b>--rti-shopcode</b></dt>
<dd>

<p>Output the RTI shopcode.</p>

</dd>
<dt id="rti-shopname"><b>--rti-shopname</b></dt>
<dd>

<p>Output the RTI shopname.</p>

</dd>
<dt id="ospatches"><b>--ospatches</b></dt>
<dd>

<p>Configure yum to allow kernel updates. Then, purge old kernels. Finally, run a <code>yum clean</code> and then a <code>yum update</code> command.</p>

</dd>
<dt id="ostools"><b>--ostools</b></dt>
<dd>

<p>Download the OSTools install script <code>install-ostool.pl</code> from the Teleflora Managed Services web site and execute it to install the latest version of OSTools. The <b>--norun-harden-linux</b> is specified on the install script command line so that the new <code>harden_linux.pl</code> script is installed but not executed.</p>

</dd>
<dt id="java"><b>--java</b></dt>
<dd>

<p>Install the latest version of the Oracle Java JRE package.</p>

</dd>
<dt id="java-version-s"><b>--java-version=s</b></dt>
<dd>

<p>Install the version of the Oracle Java JRE package specified.</p>

</dd>
<dt id="ipaddr-s"><b>--ipaddr=s</b></dt>
<dd>

<p>Change the IP address of the system.</p>

</dd>
<dt id="nameserver-s"><b>--nameserver=s</b></dt>
<dd>

<p>Change the DNS name server of the system.</p>

</dd>
<dt id="i18n-gen-i18n-conf"><b>--(i18n|gen-i18n-conf)</b></dt>
<dd>

<p>Generate a new instance of the internationalization config file.</p>

</dd>
<dt id="locale"><b>--locale</b></dt>
<dd>

<p>Set the system locale to &quot;en_US&quot;.</p>

</dd>
<dt id="yum"><b>--yum</b></dt>
<dd>

<p>Edit the yum config file so that kernel updates will be perfomed.</p>

</dd>
<dt id="ups---ups-serial---ups-usb"><b>--ups (--ups-serial|--ups-usb)</b></dt>
<dd>

<p>Download and install the APC UPS software, generate an appropriate config file, and install an &quot;APC on battery&quot; script.</p>

</dd>
<dt id="cupsconf"><b>--cupsconf</b></dt>
<dd>

<p>Edit several values in the <i>/etc/cups/cupsd.conf</i> file.</p>

</dd>
<dt id="cupstmp"><b>--cupstmp</b></dt>
<dd>

<p>Remove all zero sized files from <i>/var/spool/cups/tmp</i>.</p>

</dd>
<dt id="purgeprint"><b>--purgeprint</b></dt>
<dd>

<p>Remove ALL regular files recursively starting from <i>/var/spool/cups</i>.</p>

</dd>
<dt id="purgerpms"><b>--purgerpms</b></dt>
<dd>

<p>Remove all old kernel RPMs older than the last 8 (default). The value of the number of old kernels saved may be changed via the <b>--keepkernels=n</b> command line option.</p>

</dd>
<dt id="keepkernels-n"><b>--keepkernels=n</b></dt>
<dd>

<p>The number of kernels saved saved via <b>--ospatches</b> and <b>--purgerpms</b> may be set via the <b>--keepkernels=s</b> commandline option. The minimum value is 2. If the script is run on is a Dell T300 system, then the number of kernels saved is automatically set to the minimum due to limited space in the <code>/boot</code> partition.</p>

</dd>
<dt id="inittab-default-runlevel"><b>--(inittab|default-runlevel)</b></dt>
<dd>

<p>Configure the default runlevel in the <i>/etc/inittab file</i>.</p>

</dd>
<dt id="default-target"><b>--default-target</b></dt>
<dd>

<p>Configure the systemd default target to &quot;multi-user&quot;.</p>

</dd>
<dt id="default-password-hash"><b>--default-password-hash</b></dt>
<dd>

<p>Configure the default password hash &quot;sha512&quot;.</p>

</dd>
<dt id="syslog-mark-n"><b>--syslog-mark=n</b></dt>
<dd>

<p>Configure the syslog mark message period.</p>

</dd>
<dt id="kernel-msg-console-string"><b>--kernel-msg-console=string</b></dt>
<dd>

<p>Configure syslog to direct kernel messages to specified tty device.</p>

</dd>
<dt id="samba-gen-conf-or---samba"><b>--samba-gen-conf</b> or <b>--samba</b></dt>
<dd>

<p>Generate a Samba conf file appropriate to the POS installed.</p>

</dd>
<dt id="samba-set-passdb"><b>--samba-set-passdb</b></dt>
<dd>

<p>Configure samba to use a &quot;passdb backend&quot; of &quot;smbpasswd&quot;.</p>

</dd>
<dt id="samba-rebuild-passdb"><b>--samba-rebuild-passdb</b></dt>
<dd>

<p>Rebuild the samba &quot;smbpasswd&quot; file.</p>

</dd>
<dt id="bbj-gen-settings-file"><b>--bbj-gen-settings-file</b></dt>
<dd>

<p>Generate a BBj settings file.</p>

</dd>
<dt id="bbj-gen-properties-file"><b>--bbj-gen-properties-file</b></dt>
<dd>

<p>Generate a BBj properties file.</p>

</dd>
<dt id="configure-grub2"><b>--configure-grub2</b></dt>
<dd>

<p>For RHEL7 systems, enable verbose boot messages by editing the GRUB2 config file and then running the <code>grub2-mkconfig</code> utility.</p>

</dd>
<dt id="init-console-res"><b>--init-console-res</b></dt>
<dd>

<p>Initialize the console resolution by editing the GRUB config file. All kernel lines in the config file that have not already been appropriately modified will be changed.</p>

</dd>
<dt id="enable-boot-msgs"><b>--enable-boot-msgs</b></dt>
<dd>

<p>Enable verbose boot messages by editing the GRUB config file. All kernel lines in the config file that have not already been appropriately modified will be changed.</p>

</dd>
<dt id="disable-kms"><b>--disable-kms</b></dt>
<dd>

<p>Disable kernel (video) mode setting by editing the GRUB config file. All kernel lines in the config file that have not already been appropriately modified will be changed.</p>

</dd>
<dt id="uninstall-readahead"><b>--uninstall-readahead</b></dt>
<dd>

<p>If platform is &quot;RHEL6&quot;, uninstall the &quot;readahead&quot; RPM package.</p>

</dd>
<dt id="sub-mgr-identity"><b>--sub-mgr-identity</b></dt>
<dd>

<p>Report the subscription manager system identity.</p>

</dd>
<dt id="sub-mgr-register"><b>--sub-mgr-register</b></dt>
<dd>

<p>Register the system via subscription manager.</p>

</dd>
<dt id="sub-mgr-unregister"><b>--sub-mgr-unregister</b></dt>
<dd>

<p>Unregister the system via subscription manager.</p>

</dd>
<dt id="sub-mgr-status"><b>--sub-mgr-status</b></dt>
<dd>

<p>Report the subscription manager status.</p>

</dd>
<dt id="audit-system-configure"><b>--audit-system-configure</b></dt>
<dd>

<p>Configure the audit system by installing a rules file in <i>/etc/audit/rules.d</i> and restarting the <b>auditd</b> system service.</p>

</dd>
<dt id="audit-system-rules-file-s"><b>--audit-system-rules-file=s</b></dt>
<dd>

<p>Specify an audit system rules file for use by the <b>--audit-system-configure</b> option.</p>

</dd>
<dt id="swapon"><b>--swapon</b></dt>
<dd>

<p>For RTI systems only, enable swap space.</p>

</dd>
<dt id="report-swap-size"><b>--report-swap-size</b></dt>
<dd>

<p>Report suggested sawp partition size in GB for the current installed RAM size according to Red Hat recommendations.</p>

</dd>
<dt id="report-architecture"><b>--report-architecture</b></dt>
<dd>

<p>Report the system architecture. Values are either &quot;i386&quot; or &quot;x86_64&quot;.</p>

</dd>
</dl>

<h1 id="DESCRIPTION13">DESCRIPTION</h1>

<p>This <i>updateos.pl</i> script provides many essential methods used to setup and configure a Red Hat Linux system for use as a Teleflora POS server.</p>

<h2 id="COMMAND-LINE-OPTIONS2">COMMAND LINE OPTIONS</h2>

<p>The <b>&quot;--java&quot;</b> command line option downloads and installs the Oracle Java SE JRE package. The Java package file for RHEL 32-bit servers is downloaded from <i>&quot;http://rtihardware.homelinux.com/ks/jre-latest-linux-i586-rpm.bin&quot;</i>, and for RHEL 64-bit servers is downloaded from <i>&quot;http://rtihardware.homelinux.com/ks/jre-latest-linux-x64-rpm.bin&quot;</i>.</p>

<p>The <b>&quot;--java-version=s&quot;</b> command line option may be used to specify a specific version of the Java SE JRE package. For example, to install the version of the Java JRE from package file <i>&quot;jre-6u31-linux-x64-rpm.bin&quot;</i> on a 64-bit server, specify <code>&quot;--java-version=6u31&quot;</code>. The default version is &quot;latest&quot;.</p>

<p>The <b>&quot;--daisy&quot;</b> command line option can be specified to make system configuration changes appropriate for Daisy 8.0 and later systems. These changes include the following:</p>

<dl>

<dt id="o">o</dt>
<dd>

<p>IP addr</p>

<p>Check the method of booting in <i>/etc/sysconfig/network-scripts/ifcfg-eth0</i> and if it&#39;s &quot;DHCP&quot;, log an error and exit.</p>

</dd>
<dt id="o1">o</dt>
<dd>

<p>File System Remounting</p>

<p>The <i>/teleflora</i> file system is remounted as the <i>/d</i> file system.</p>

</dd>
<dt id="o2">o</dt>
<dd>

<p>Mount Options</p>

<p>On RHEL7 systems, the &quot;nofail&quot; mount option is added to the entry for <i>/d</i>.</p>

</dd>
<dt id="o3">o</dt>
<dd>

<p>CDROM</p>

<p>On RHEL5 and RHEL6 systems, add an <i>/etc/fstab</i> entry for the CD-ROM.</p>

</dd>
<dt id="o4">o</dt>
<dd>

<p>Mount Points</p>

<p>Make mount points <i>/mnt/cdrom</i> and <i>/mnt/usb</i> if they do not exist.</p>

</dd>
<dt id="o5">o</dt>
<dd>

<p>Samba</p>

<p>If Samba has not been configured, generate and install a Samba config file appropriate for Daisy.</p>

</dd>
<dt id="o6">o</dt>
<dd>

<p>Standard users</p>

<p>Make the standard Daisy users.</p>

</dd>
<dt id="o7">o</dt>
<dd>

<p>Locale</p>

<p>On RHEL5 and RHEL6 systems, generate a new <i>/etc/sysconfig/i18n</i> file. On RHEL7 systems, set the system locale.</p>

</dd>
</dl>

<p>The <b>&quot;--rti14&quot;</b> command line option can be specified to make system configuration changes appropriate for RTI version 14. These changes include the following:</p>

<dl>

<dt id="o8">o</dt>
<dd>

<p>Red Hat Network</p>

<p>Verify that the system is registered with the Red Hat Network. If not, log an error message and exit.</p>

</dd>
<dt id="o9">o</dt>
<dd>

<p>IP addr</p>

<p>Check the method of booting in <i>/etc/sysconfig/network-scripts/ifcfg-eth0</i> and if it&#39;s &quot;DHCP&quot;, log an error and exit. The default network device name is &quot;eth0&quot; but an alternate network device name may be specified with the <code>--ifname</code> command line option.</p>

</dd>
<dt id="o10">o</dt>
<dd>

<p>File System Remounting</p>

<p>The <i>/teleflora</i> file system is remounted as the <i>/usr2</i> file system.</p>

</dd>
<dt id="o11">o</dt>
<dd>

<p>Mount Options</p>

<p>On RHEL7 systems, the &quot;nofail&quot; mount option is added to the entry for <i>/usr2</i>.</p>

</dd>
<dt id="o12">o</dt>
<dd>

<p>Red Hat Package Installation</p>

<p>On RHEL5, RHEL6, and RHEL7 platforms, install the <code>apache</code>, <code>fetchmail</code>, and <code>ksh</code> packages. On RHEL5 platforms, install the <code>uucp</code> package.</p>

</dd>
<dt id="o13">o</dt>
<dd>

<p>Default RTI Users</p>

<p>Add the default RTI groups: &quot;rti&quot; and &quot;rtiadmins&quot;. Add the default RTI user accounts: &quot;tfsupport&quot; and &quot;rti&quot;. Add the default RTI samba accounts: &quot;odbc&quot; and &quot;delivery&quot;.</p>

</dd>
<dt id="o14">o</dt>
<dd>

<p>Samba Configuration</p>

<p>If the Samba configuration has not already been modified, generate the RTI Samba configuration file. Add the RTI users &quot;rti&quot;, &quot;odbc&quot;, and &quot;delivery&quot; to the Samba password file.</p>

</dd>
<dt id="o15">o</dt>
<dd>

<p>RTI Package Installation</p>

<p>If only the <b>--rti14</b> option is specified, then no further actions are performed. If the <b>--rti14 --norti14-trunc</b> is specified, then additionally Java, BBj, BBj config files, BLM and BLM config files are installed.</p>

</dd>
</dl>

<p>The <b>&quot;--ipaddr=s&quot;</b> command line option may be used to change the IP address of any specified ethernet interface. By default, the ethernet interface config file for the ethernet interface named &quot;eth0&quot; is edited; the path to that file is <i>/etc/sysconfig/network-scripts/ifcfg-eth0</i>. Along with ifcfg file, the system hosts file <i>/etc/hosts</i> is also updated. An alternate ifcfg file may be specified via the <b>&quot;--ifname=s&quot;</b> command line option. If the IP address specified is not the default value of &quot;192.168.1.21&quot;, then the <b>&quot;--netmask=s&quot;</b> and the <b>&quot;--gateway=s&quot;</b> command line options must also be specified. In order for the new IP address to take effect, either the &quot;network&quot; service must be restarted or the system must be rebooted.</p>

<p>The <b>&quot;--nameserver=s&quot;</b> command line option actually generates entirely new contents for the <i>/etc/resolv.conf</i> file. The previous contents are removed so if you need to save them, make a copy of the file before running this command. The specified IP address is used as the IP address of the DNS name server.</p>

<p>The <b>&quot;--(i18n|gen-i18n-conf)&quot;</b> command line option actually generates entirely new contents for the <i>/etc/sysconfig/i18n</i> config file. The previous contents are removed so if you need to save them, make a copy of the file before running this command. This option is only valid on RHEL5 and RHEL6 systems.</p>

<p>The <b>&quot;--locale&quot;</b> command line option issues the <i>localectl set-locale</i> command to set the system locale to &quot;en_US&quot;. This command also updates the system locale config file <i>/etc/locale/conf</i> with the new value so it is preserved across reboots. This command line option is only supported on RHEL7 platforms.</p>

<p>The <b>&quot;--yum&quot;</b> command line option checks the contents of <i>/etc/yum.conf</i>. If the line &quot;exclude=kernel&quot; appears, the file is edited to comment out that line.</p>

<p>The <b>&quot;--(inittab|default-runlevel)&quot;</b> command line option edits the <i>/etc/inittab</i> file if there is one, and sets the default system runlevel to &quot;3&quot;, ie multi-user. This option is only valid on RHEL5 and RHEL6 systems.</p>

<p>The <b>&quot;--default-target&quot;</b> command line option sets the systemd default target to &quot;multi-user&quot;. This option is only valid on RHEL7 systems.</p>

<p>The <b>&quot;--syslog-mark&quot;</b> command line option can be specified to configure <i>syslog</i> on RHEL5 systems and <i>rsyslog</i> on RHEL6 systems to write a &quot;mark&quot; message to the syslog log file at the specified period.</p>

<p>For <i>rsyslog</i> on RHEL6:</p>

<p>The following 2 lines must be added to the beginning of the <i>/etc/syslog.conf</i> conf file:</p>

<p>$ModLoad immark.so $MarkMessagePeriod 1200</p>

<p>The &quot;$ModLoad&quot; line is a directive to load the input module &quot;immark.so&quot; which provides the mark message feature. The &quot;$MarkMessagePeriod&quot; line is a directive to specify the number of seconds between mark messages. This directive is only available after the &quot;immark&quot; input module has been loaded. Specifying 0 is possible and disables mark messages. In that case, however, it is more efficient to NOT load the &quot;immark&quot; input module. In general, the last directive to appear in file wins.</p>

<p>For <i>syslog</i> on RHEL5:</p>

<p>In the <i>/etc/sysconfig/syslog</i> conf file, the &quot;SYSLOGD&quot; variable must have the &quot;-m&quot; option changed to have a non-zero value if it appears. If the &quot;-m&quot; option does not appear, then the default value for the mark message period is 20 minutes. If the value specified with the &quot;-m&quot; option is 0, then the mark message is not written.</p>

<p>The <b>&quot;--kernel-msg-console&quot;</b> command line option can be specified to configure <i>syslog</i> on RHEL5 systems and <i>rsyslog</i> on RHEL6 systems to direct kernel messages to specified tty device. The syslog system service will be restarted after a succeful change to the config file.</p>

<p>The <b>&quot;--samba-gen-conf&quot;</b> command line option generates an entirely new Samba conf file appropriate to POS installed, either &quot;RTI&quot; or &quot;Daisy&quot;. The &quot;RTI&quot; and &quot;Daisy&quot; version of the Samba conf file are considerably different. If a new Samba conf file is generated, the Samba system service &quot;smb&quot; is restarted.</p>

<p>The <b>&quot;--samba-set-passdb&quot;</b> command line option can be used to configure samba to use a &quot;passdb backend&quot; of &quot;smbpasswd&quot;. It does this by editing the existing Samba conf file, adding the parameter &quot;passdb backend = smbpasswd&quot; to the &quot;[global]&quot; section of the Samba conf file. If the Samba conf file is already so configured, then no change is done. If the Samba conf file is modified, the Samba system service &quot;smb&quot; is restarted.</p>

<p>The <b>&quot;--samba-rebuild-passdb&quot;</b> command line option can be used to rebuild the samba &quot;smbpasswd&quot; file. The only field updated in &quot;smbpasswd&quot; file is the &quot;UID&quot; field: if the value in the &quot;UID&quot; field of the &quot;smbpasswd&quot; file does not match the &quot;UID&quot; field in the &quot;/etc/passwd&quot; file for the username in the &quot;username&quot; field of the &quot;smbpasswd&quot; file, then the UID from the &quot;/etc/passwd&quot; file is substituted for the value in the &quot;smbpasswd&quot; file.</p>

<p>The <b>--bbj-gen-settings-file</b> command line option is useful for system stagers and OSTools testers to see what the contents of the BBj settings file would be when produced for the <b>--rti14</b> option. The BBj settings file is written to the current working directory and is available for inspection but is not used or incorporated into the RTI system in any way.</p>

<p>The <b>--bbj-gen-properties-file</b> command line option is useful for system stagers and OSTools testers to see what the contents of the BBj properties file would be when produced for the <b>--rti14</b> option. The BBj properties file is written to the current working directory and is available for inspection but is not used or incorporated into the RTI system in any way.</p>

<p>The <b>&quot;--disable-kms&quot;</b> command line option is used to disable kernel (video) mode setting. For Daisy customers that use the console of the Daisy server as a workstation, disabling KMS is required or Daisy application screens do not appear correctly on the virtual consoles. The code for this option is also executed when the <code>--baremetal</code> option is specified.</p>

<p>Specifying the <b>&quot;--cupsconf&quot;</b> command line option will cause <i>udpateos.pl</i> to edit the values of several variables in the <i>/etc/cups/cupsd.conf</i> CUPS config file. The code for this option is also executed when the <b>&quot;--baremetal&quot;</b> option is specified. The following variables are set to the specified values:</p>

<dl>

<dt id="o16">o</dt>
<dd>

<p>MaxJobs is set to 10000</p>

</dd>
<dt id="o17">o</dt>
<dd>

<p>PreserveJobHistory is set to &quot;No&quot;</p>

</dd>
<dt id="o18">o</dt>
<dd>

<p>PreserveJobFiles is set to &quot;No&quot;</p>

</dd>
<dt id="o19">o</dt>
<dd>

<p>If the platform is &quot;RHEL5&quot;, Timeout is set to 0. If the platform is &quot;RHEL6&quot;, Timeout is set to 300.</p>

</dd>
<dt id="o20">o</dt>
<dd>

<p>ErrorPolicy is set to &quot;retry-job&quot;</p>

</dd>
</dl>

<h2 id="Linux-Audit-System-Configuration">Linux Audit System Configuration</h2>

<p>The <b>&quot;--audit-system-configure&quot;</b> command line option provides a method of configuring the Linux Audit System with an appropriate config file and restarting the <b>auditd</b> system service. If the audit system is already configured, then no configuration is performed.</p>

<p>The <b>&quot;--audit-system-rules-file=path&quot;</b> command line option can be used in conjunction with <b>&quot;--audit-system-configure&quot;</b> to explicitly specify a &quot;rules&quot; file to be used as a configuration file for the audit system, ie, it is copied to <i>/etc/audit/rules.d</i> and the &quot;auditd&quot; system service is restarted. Before the path specified with <b>&quot;--audit-system-rules-file=path&quot;</b> is used, it is checked for security issues and if verified &quot;OK&quot;, it will be used to configure the audit system. If there are issues with the path, eg there are illegal characters in the file name, a warning is output and no configuration is performed.</p>

<p>If <b>&quot;--audit-system-configure&quot;</b> is specifed without <b>&quot;--audit-system-rules-file=path&quot;</b>, then the following strategy will be used to determine where to find the rules file in the following order:</p>

<dl>

<dt id="from-the-environment">(1) from the environment</dt>
<dd>

<p>if the rules file is specified in the environement via the variable `AUDIT_SYSTEM_RULES_FILE`, the value will be verified as secure and used as the rule file.</p>

</dd>
<dt id="from-the-OSTools-config-dir">(2) from the OSTools config dir</dt>
<dd>

<p>if on RTI systems, there is a rules file in the ostools config dir named <i>rti.rules</i> or if on Daisy systems there is a rules file in the ostools config dir named <i>daisy.rules</i>, it will be used as the rule file.</p>

</dd>
<dt id="from-a-remote-server">(3) from a remote server</dt>
<dd>

<p>if on RTI systems, there is a rules file at the URL <i>&quot;http://rtihardware.homelinux.com/ostools/rti.rules&quot;</i> or if on Daisy systems, there is a rules file at URL <i>&quot;http://rtihardware.homelinux.com/ostools/daisy.rules&quot;</i>, then it will be used as the rule file.</p>

</dd>
<dt id="rules-generated-by-script">(4) rules generated by script</dt>
<dd>

<p>a default rules file appropriate to the POS will be generated and used as the rule file.</p>

</dd>
</dl>

<h1 id="EXAMPLES4">EXAMPLES</h1>

<dl>

<dt id="Perform-a-truncated-RTI-install">Perform a truncated RTI install</dt>
<dd>

<pre><code> $ sudo updateos.pl --rti14</code></pre>

</dd>
<dt id="Perform-a-full-RTI-install">Perform a full RTI install</dt>
<dd>

<pre><code> $ sudo updateos.pl --rti14 --norti14-trunc</code></pre>

</dd>
<dt id="Change-IP-address-of-network-device-eth0-to-192.168.2.32">Change IP address of network device &quot;eth0&quot; to 192.168.2.32</dt>
<dd>

<pre><code> $ sudo updateos.pl --ipaddr=192.168.2.32 --netmask=255.255.255.0 --gateway=192.168.2.1</code></pre>

</dd>
<dt id="Change-IP-address-of-network-device-eth1-to-192.168.2.33">Change IP address of network device &quot;eth1&quot; to 192.168.2.33</dt>
<dd>

<pre><code> $ sudo updateos.pl --ipaddr=192.168.2.33 --ifname=eth1 --netmask=255.255.255.0 --gateway=192.168.2.1</code></pre>

</dd>
<dt id="Get-Status-of-Ungregistred-System-with-Subscription-Manager">Get Status of Ungregistred System with Subscription Manager</dt>
<dd>

<pre><code> $ sudo updateos.pl --sub-mgr-status
 [sub-mgr] subscription manager status: Unknown</code></pre>

</dd>
<dt id="Register-System-with-the-Subscription-Manager">Register System with the Subscription Manager</dt>
<dd>

<pre><code> $ sudo updateos.pl --sub-mgr-register
 The system has been registered with ID: 2c1e0459-a8c3-42a4-92bf-d802a742c736 
 Installed Product Current Status:
 Product Name: Red Hat Enterprise Linux Server
 Status:       Subscribed

 [sub-mgr] system registered via subscription manager</code></pre>

</dd>
<dt id="Get-Status-of-Registred-System-with-Subscription-Manager">Get Status of Registred System with Subscription Manager</dt>
<dd>

<pre><code> $ sudo updateos.pl --sub-mgr-status
 [sub-mgr] subscription manager status: Current</code></pre>

</dd>
<dt id="Get-Identity-of-Registered-System-with-Subscription-Manager">Get Identity of Registered System with Subscription Manager</dt>
<dd>

<pre><code> $ sudo updateos.pl --sub-mgr-identity
 [sub-mgr] subscription manager system identity: 2c1e0459-a8c3-42a4-92bf-d802a742c736</code></pre>

</dd>
<dt id="Unregister-System-with-the-Subscription-Manager">Unregister System with the Subscription Manager</dt>
<dd>

<pre><code> $ sudo updateos.pl --sub-mgr-unregister
 1 subscription removed at the server.
 1 local certificate has been deleted.
 System has been unregistered.
 [sub-mgr] system unregistered via subscription manager</code></pre>

</dd>
</dl>

<h1 id="FILES13">FILES</h1>

<dl>

<dt id="usr2-bbx-log-RTI-Patches.log"><i>/usr2/bbx/log/RTI-Patches.log</i></dt>
<dd>

<p>Logfile for RTI systems.</p>

</dd>
<dt id="d-daisy-log-RTI-Patches.log"><i>/d/daisy/log/RTI-Patches.log</i></dt>
<dd>

<p>Logfile for Daisy systems.</p>

</dd>
<dt id="boot-grub-grub.conf"><i>/boot/grub/grub.conf</i></dt>
<dd>

<p>The GRUB config file.</p>

</dd>
<dt id="etc-default-grub"><i>/etc/default/grub</i></dt>
<dd>

<p>For RHEL7 systems, the GRUB2 config file.</p>

</dd>
<dt id="etc-sysconfig-syslog"><i>/etc/sysconfig/syslog</i></dt>
<dd>

<p>The configuration file for the syslog system service that needs to be edited for configuring the heartbeat. This is for RHEL5 only.</p>

</dd>
<dt id="etc-rsyslog.conf"><i>/etc/rsyslog.conf</i></dt>
<dd>

<p>For RHEL6 systems, the configuration file for the syslog system service that needs to be edited for configuring the heartbeat.</p>

</dd>
<dt id="etc-samba-smb.conf1"><i>/etc/samba/smb.conf</i></dt>
<dd>

<p>The Samba configuration file.</p>

</dd>
<dt id="etc-samba-smbpasswd"><i>/etc/samba/smbpasswd</i></dt>
<dd>

<p>The Samba password file when the &quot;passdb backend = smbpasswd&quot; is specified in the Samba conf file.</p>

</dd>
<dt id="var-lib-samba-private-smbpasswd"><i>/var/lib/samba/private/smbpasswd</i></dt>
<dd>

<p>For RHEL6 and RHEL7 systems, the Samba password file when the &quot;passdb backend = smbpasswd&quot; is specified in the Samba conf file.</p>

</dd>
<dt id="jre-latest-linux-i586-rpm.bin"><i>jre-latest-linux-i586-rpm.bin</i></dt>
<dd>

<p>The latest version of the Java SE JRE package file for RHEL 32-bit servers.</p>

</dd>
<dt id="jre-latest-linux-x64-rpm.bin"><i>jre-latest-linux-x64-rpm.bin</i></dt>
<dd>

<p>The latest version of the Java SE JRE package file for RHEL 64-bit servers.</p>

</dd>
<dt id="etc-cups-cupsd.conf"><i>/etc/cups/cupsd.conf</i></dt>
<dd>

<p>The values of several variables are set.</p>

</dd>
<dt id="var-spool-cups"><i>/var/spool/cups</i></dt>
<dd>

<p>Directory containing files which represent completed and in-process CUPS print jobs.</p>

</dd>
<dt id="etc-sysconfig-network-scripts-ifcfg-eth01"><i>/etc/sysconfig/network-scripts/ifcfg-eth0</i></dt>
<dd>

<p>This file is edited when the <b>&quot;--ipaddr=s&quot;</b> command line option is specified.</p>

</dd>
<dt id="etc-hosts"><i>/etc/hosts</i></dt>
<dd>

<p>This file is edited when the <b>&quot;--ipaddr=s&quot;</b> command line option is specified.</p>

</dd>
<dt id="etc-resolv.conf"><i>/etc/resolv.conf</i></dt>
<dd>

<p>A new instance of this file is generated when the <b>&quot;--nameserver=s&quot;</b> command line option is specified.</p>

</dd>
<dt id="etc-sysconfig-i18n1"><i>/etc/sysconfig/i18n</i></dt>
<dd>

<p>For RHEL5 and RHELl6 platforms only, a new instance of this file is generated when the <b>&quot;--(i18n|gen-i18n-conf)&quot;</b> command line option is specified. Also, a new instance is generated as part of all the other the changes when <i>--daisy</i> is specified.</p>

</dd>
<dt id="etc-yum.conf"><i>/etc/yum.conf</i></dt>
<dd>

<p>If the line &quot;exclude=kernel&quot; appears in this file, the line will be commented out by <b>&quot;--yum&quot;</b>.</p>

</dd>
<dt id="etc-locale.conf"><i>/etc/locale.conf</i></dt>
<dd>

<p>On RHEL7 systems, this config file is edited to set the system locale.</p>

</dd>
<dt id="etc-inittab"><i>/etc/inittab</i></dt>
<dd>

<p>On RHEL5 and RHEL6 systems, this config file is edited to set the default runlevel of the system.</p>

</dd>
<dt id="etc-systemd-system-default.target"><i>/etc/systemd/system/default.target</i></dt>
<dd>

<p>On RHEL7 systems, this symlink is edited to set the default target of the system to &quot;multi-user&quot;.</p>

</dd>
<dt id="etc-fstab1"><i>/etc/fstab</i></dt>
<dd>

<p>On RHEL7 systems, the &quot;nofail&quot; mount option is added to the entries for <i>/usr2</i> and <i>/d</i>.</p>

</dd>
<dt id="etc-audit-rules.d-daisy.rules1"><i>/etc/audit/rules.d/daisy.rules</i></dt>
<dd>

<p>The Linux Audit System rules file for Daisy systems.</p>

</dd>
<dt id="etc-audit-rules.d-rti.rules"><i>/etc/audit/rules.d/rti.rules</i></dt>
<dd>

<p>The Linux Audit System rules file for RTI systems.</p>

</dd>
<dt id="proc-meminfo"><i>/proc/meminfo</i></dt>
<dd>

<p>The contents of this file is used for getting the size of RAM.</p>

</dd>
<dt id="bbjinstallsettings.txt"><i>bbjinstallsettings.txt</i></dt>
<dd>

<p>The BBj settings file generated for the <b>--rti14</b> option and only used during staging.</p>

</dd>
<dt id="usr2-basis-cfg-BBj.properties"><i>/usr2/basis/cfg/BBj.properties</i></dt>
<dd>

<p>The BBj properties file.</p>

</dd>
</dl>

<h1 id="DIAGNOSTICS11">DIAGNOSTICS</h1>

<dl>

<dt id="Exit-status-0-EXIT_OK7">Exit status 0 ($EXIT_OK)</dt>
<dd>

<p>Successful completion.</p>

</dd>
<dt id="Exit-status-1-EXIT_COMMAND_LINE6">Exit status 1 ($EXIT_COMMAND_LINE)</dt>
<dd>

<p>In general, there was an issue with the syntax of the command line.</p>

</dd>
<dt id="Exit-status-2-EXIT_MUST_BE_ROOT4">Exit status 2 ($EXIT_MUST_BE_ROOT)</dt>
<dd>

<p>For all command line options other than &quot;--version&quot; and &quot;--help&quot;, the user must be root or running under &quot;sudo&quot;.</p>

</dd>
<dt id="Exit-status-3-EXIT_SAMBA_CONF">Exit status 3 ($EXIT_SAMBA_CONF)</dt>
<dd>

<p>During the execution of &quot;--samba-set-passdb&quot; or &quot;--samba-rebuild-passdb&quot;, either the Samba conf file is missing, or can&#39;t be modified.</p>

</dd>
<dt id="Exit-status-4-EXIT_GRUB_CONF">Exit status 4 ($EXIT_GRUB_CONF)</dt>
<dd>

<p>An unexpected error occurred during editing the GRUB config file. The original GRUB config file will be left unchanged.</p>

</dd>
<dt id="Exit-status-5-EXIT_ARCH">Exit status 5 ($EXIT_ARCH)</dt>
<dd>

<p>The machine architecture of the system is unsupported (should not happen).</p>

</dd>
<dt id="Exit-status-6-EXIT_NO_SWAP_PARTITIONS">Exit status 6 ($EXIT_NO_SWAP_PARTITIONS)</dt>
<dd>

<p>There were no swap partitions found on either <i>/dev/sda</i> or <i>/dev/sdb</i> when attempting to enable swapping via <b>--swapon</b>.</p>

</dd>
<dt id="Exit-status-7-EXIT_MODIFY_FSTAB">Exit status 7 ($EXIT_MODIFY_FSTAB)</dt>
<dd>

<p>Could not update the <i>/etc/fstab</i> file when attempting to enable swapping via <b>--swapon</b>.</p>

</dd>
<dt id="Exit-status-8-EXIT_RAMINFO">Exit status 8 ($EXIT_RAMINFO)</dt>
<dd>

<p>Could not open the <i>/proc/meminfo</i> file for getting the size of RAM.</p>

</dd>
<dt id="Exit-status-10-EXIT_JAVA_VERSION">Exit status 10 ($EXIT_JAVA_VERSION)</dt>
<dd>

<p>The name of the Java JRE package to be downloaded from <b>&quot;rtihardware.homelinux.com&quot;</b> could not be determined.</p>

</dd>
<dt id="Exit-status-11-EXIT_JAVA_DOWNLOAD">Exit status 11 ($EXIT_JAVA_DOWNLOAD)</dt>
<dd>

<p>The Java JRE package from <b>&quot;rtihardware.homelinux.com&quot;</b> could not be downloaded.</p>

</dd>
<dt id="Exit-status-12-EXIT_JAVA_INSTALL">Exit status 12 ($EXIT_JAVA_INSTALL)</dt>
<dd>

<p>The RPM from the download of the Java JRE package from <b>&quot;rtihardware.homelinux.com&quot;</b> could not be installed.</p>

</dd>
<dt id="Exit-Status-13-EXIT_RTI14">Exit Status 13 ($EXIT_RTI14)</dt>
<dd>

<p>The &quot;--rti14&quot; command line option was run and the system was not configured with a static IP address.</p>

</dd>
<dt id="Exit-Status-15-EXIT_READAHEAD">Exit Status 15 ($EXIT_READAHEAD)</dt>
<dd>

<p>The &quot;--uninstall-readahead&quot; command line option was specified on a RHEL6 system, and the &quot;readahead&quot; RPM could not be removed.</p>

</dd>
<dt id="Exit-Status-17-EXIT_SAMBA_PASSDB">Exit Status 17 ($EXIT_SAMBA_PASSDB)</dt>
<dd>

<p>Could not rebuild the Samba password database file.</p>

</dd>
<dt id="Exit-Status-18-EXIT_KEEPKERNELS_MIN">Exit Status 18 ($EXIT_KEEPKERNELS_MIN)</dt>
<dd>

<p>The value specified with <b>--keepkernels=s</b> was less than the minimum.</p>

</dd>
<dt id="Exit-Status-19-EXIT_PURGE_KERNEL_RPM">Exit Status 19 ($EXIT_PURGE_KERNEL_RPM)</dt>
<dd>

<p>Could not purge an old kernel rpm.</p>

</dd>
<dt id="Exit-Status-21-EXIT_WRONG_PLATFORM">Exit Status 21 ($EXIT_WRONG_PLATFORM)</dt>
<dd>

<p>A command line option was run on an unsupported platform.</p>

</dd>
<dt id="Exit-status-22-EXIT_RHWS_CONVERT">Exit status 22 ($EXIT_RHWS_CONVERT)</dt>
<dd>

<p>The &quot;--ospatches&quot; option was run on a Red Hat Workstation 5 system and the conversion from &quot;workstation&quot; to &quot;server&quot; failed.</p>

</dd>
<dt id="Exit-status-23-EXIT_UP2DATE">Exit status 23 ($EXIT_UP2DATE)</dt>
<dd>

<p>The &quot;--ospatches&quot; option was run on a RHEL 4 server system and the &quot;up2date&quot; process failed.</p>

</dd>
<dt id="Exit-status-24-EXIT_YUM_UPDATE">Exit status 24 ($EXIT_YUM_UPDATE)</dt>
<dd>

<p>The &quot;--ospatches&quot; option was run on a RHEL 5 or 6 server system and the &quot;yum&quot; process failed.</p>

</dd>
<dt id="Exit-status-25-EXIT_DIGI_DRIVERS">Exit status 25 ($EXIT_DIGI_DRIVERS)</dt>
<dd>

<p>The &quot;--ospatches&quot; option was run and the installation of the Digi Drivers failed.</p>

</dd>
<dt id="Exit-status-26-EXIT_INITSCRIPTS">Exit status 26 ($EXIT_INITSCRIPTS)</dt>
<dd>

<p>The &quot;--ospatches&quot; option was run and the &quot;fixup&quot; required for RHEL6 Daisy systems failed. This &quot;fixup&quot; is only required when there is the installation of any updated &quot;initscripts&quot; pacakges; however, the &quot;fixup&quot; is run anytime the &quot;--ospatches&quot; option is run and the &quot;yum&quot; command which runs returns successful exit status. (the &quot;fixup&quot; merely consists of removing two files if they exist: <i>/etc/init/start-ttys.conf</i> and <i>/etc/init/tty.conf</i>)</p>

</dd>
<dt id="Exit-status-27-EXIT_RHN_NOT_REGISTERED">Exit status 27 ($EXIT_RHN_NOT_REGISTERED)</dt>
<dd>

<p>The system is not registered with the Red Hat Network, and thus patches can not be dowloaded from Red Hat.</p>

</dd>
<dt id="Exit-status-30-EXIT_HOSTNAME_CHANGE">Exit status 30 ($EXIT_HOSTNAME_CHANGE)</dt>
<dd>

<p>The attempt to change the hostname of the system failed.</p>

</dd>
<dt id="Exit-status-31-EXIT_MOTD">Exit status 31 ($EXIT_MOTD)</dt>
<dd>

<p>Could not truncate the &quot;Message of the Day&quot; (aka login banner) file.</p>

</dd>
<dt id="Exit-status-32-EXIT_RTI_SHOPNAME">Exit status 32 ($EXIT_RTI_SHOPNAME)</dt>
<dd>

<p>Could not get the RTI shop name.</p>

</dd>
<dt id="Exit-status-33-EXIT_RTI_SHOPCODE">Exit status 33 ($EXIT_RTI_SHOPCODE)</dt>
<dd>

<p>Could not get the RTI shop code.</p>

</dd>
<dt id="Exit-status-34-EXIT_DAISY_SHOPCODE">Exit status 34 ($EXIT_DAISY_SHOPCODE)</dt>
<dd>

<p>Could not get the DAISY shop code.</p>

</dd>
<dt id="Exit-status-35-EXIT_CUPS_CONF_MISSING">Exit status 35 ($EXIT_CUPS_CONF_MISSING)</dt>
<dd>

<p>The CUPS config file does not exist. Some commands edit this file and if it does not exist, it is considered an error.</p>

</dd>
<dt id="Exit-status-36-EXIT_CUPS_CONFIGURE">Exit status 36 ($EXIT_CUPS_CONFIGURE)</dt>
<dd>

<p>The &quot;--cupsconf&quot; option was specified and there was an error rewriting the CUPS config file.</p>

</dd>
<dt id="Exit-status-37-EXIT_CUPS_SERVICE_STOP">Exit status 37 ($EXIT_CUPS_SERVICE_STOP)</dt>
<dd>

<p>Could not stop the CUPS system service.</p>

</dd>
<dt id="Exit-status-38-EXIT_CUPS_SERVICE_START">Exit status 38 ($EXIT_CUPS_SERVICE_START)</dt>
<dd>

<p>Could not start the CUPS system service.</p>

</dd>
<dt id="Exit-status-39-EXIT_DAISY_START">Exit status 39 ($EXIT_DAISY_START)</dt>
<dd>

<p>Could not start the Daisy POS application.</p>

</dd>
<dt id="Exit-status-40-EXIT_SUB_MGR_IDENTIFICATION">Exit status 40 ($EXIT_SUB_MGR_IDENTIFICATION)</dt>
<dd>

<p>The subscription manager identity could not be obtained.</p>

</dd>
<dt id="Exit-status-41-EXIT_SUB_MGR_REGISTRATION">Exit status 41 ($EXIT_SUB_MGR_REGISTRATION)</dt>
<dd>

<p>The system could not be registered via the subscription manager.</p>

</dd>
<dt id="Exit-status-42-EXIT_SUB_MGR_UNREGISTRATION">Exit status 42 ($EXIT_SUB_MGR_UNREGISTRATION)</dt>
<dd>

<p>The system could not be un-registered via the subscription manager.</p>

</dd>
<dt id="Exit-status-43-EXIT_SUB_MGR_CONDITION">Exit status 43 ($EXIT_SUB_MGR_CONDITION)</dt>
<dd>

<p>The subscription manager status could not be obtained.</p>

</dd>
<dt id="Exit-status-44-EXIT_DAISY_STOP">Exit status 44 ($EXIT_DAISY_STOP)</dt>
<dd>

<p>Could not stop the Daisy POS application.</p>

</dd>
<dt id="Exit-status-46-EXIT_DAISY_INSTALL_DHCP">Exit status 46 ($EXIT_DAISY_INSTALL_DHCP)</dt>
<dd>

<p>In order to configure the system with <b>--daisy</b>, the network configuration must not be booting via DHCP.</p>

</dd>
<dt id="Exit-status-47-EXIT_DAISY_SHOPNAME">Exit status 47 ($EXIT_DAISY_SHOPNAME)</dt>
<dd>

<p>Could not get Daisy shop name</p>

</dd>
<dt id="Exit-status-48-EXIT_AUDIT_SYSTEM_CONFIGURE">Exit status 48 ($EXIT_AUDIT_SYSTEM_CONFIGURE)</dt>
<dd>

<p>Could not configure the Linux Audit System.</p>

</dd>
<dt id="Exit-status-49-EXIT_CONFIGURE_DEF_PASSWORD_HASH">Exit status 49 ($EXIT_CONFIGURE_DEF_PASSWORD_HASH)</dt>
<dd>

<p>The default password hash of the system could not be changed.</p>

</dd>
<dt id="Exit-status-50-EXIT_CONFIGURE_IP_ADDR">Exit status 50 ($EXIT_CONFIGURE_IP_ADDR)</dt>
<dd>

<p>The IP address of the system could not be changed.</p>

</dd>
<dt id="Exit-status-51-EXIT_CONFIGURE_HOSTNAME">Exit status 51 ($EXIT_CONFIGURE_HOSTNAME)</dt>
<dd>

<p>The hostname of the system could not be changed.</p>

</dd>
<dt id="Exit-status-52-EXIT_CONFIGURE_NAMESERVER">Exit status 52 ($EXIT_CONFIGURE_NAMESERVER)</dt>
<dd>

<p>Could not generate a new nameserver file, ie <i>/etc/resolv.conf</i>.</p>

</dd>
<dt id="Exit-status-53-EXIT_CONFIGURE_I18N">Exit status 53 ($EXIT_CONFIGURE_I18N))</dt>
<dd>

<p>Could not generate a new i18n config file, ie <i>/etc/sysconfig/i18n</i>.</p>

</dd>
<dt id="Exit-status-54-EXIT_CONFIGURE_YUM">Exit status 54 ($EXIT_CONFIGURE_YUM)</dt>
<dd>

<p>Could not configure yum to do kernel updates.</p>

</dd>
<dt id="Exit-status-55-EXIT_CONFIGURE_LOCALE">Exit status 55 ($EXIT_CONFIGURE_LOCALE)</dt>
<dd>

<p>Could not configure the system wide locale.</p>

</dd>
<dt id="Exit-status-56-EXIT_CONFIGURE_DEF_RUNLEVEL">Exit status 56 ($EXIT_CONFIGURE_DEF_RUNLEVEL)</dt>
<dd>

<p>Could not configure the default runlevel.</p>

</dd>
<dt id="Exit-status-57-EXIT_CONFIGURE_DEF_TARGET">Exit status 57 ($EXIT_CONFIGURE_DEF_TARGET)</dt>
<dd>

<p>Could not configure the systemd default target.</p>

</dd>
<dt id="Exit-status-58-EXIT_EDIT_FSTAB">Exit status 58 ($EXIT_EDIT_FSTAB)</dt>
<dd>

<p>Could not edit the fstab.</p>

</dd>
<dt id="Exit-status-60-EXIT_APCUPSD_INSTALL">Exit status 60 ($EXIT_APCUPSD_INSTALL)</dt>
<dd>

<p>Could not install the APCUPSD rpm.</p>

</dd>
<dt id="Exit-status-61-EXIT_BBJ_INSTALL">Exit status 61 ($EXIT_BBJ_INSTALL)</dt>
<dd>

<p>Could not install BBj.</p>

</dd>
<dt id="Exit-status-62-EXIT_BLM_INSTALL">Exit status 62 ($EXIT_BLM_INSTALL)</dt>
<dd>

<p>Could not install the Basis license manager.</p>

</dd>
<dt id="Exit-status-70-EXIT_SYSLOG_CONF_MISSING">Exit status 70 ($EXIT_SYSLOG_CONF_MISSING)</dt>
<dd>

<p>The syslog config file does not exist.</p>

</dd>
<dt id="Exit-status-71-EXIT_SYSLOG_CONF_CONTENTS">Exit status 71 ($EXIT_SYSLOG_CONF_CONTENTS)</dt>
<dd>

<p>The contents of the syslog conf file are non-standard and thus can not be updated.</p>

</dd>
<dt id="Exit-status-72-EXIT_SYSLOG_KERN_PRIORITY_VALUE">Exit status 72 ($EXIT_SYSLOG_KERN_PRIORITY_VALUE)</dt>
<dd>

<p>The value of the kernel log priority was out of range.</p>

</dd>
<dt id="Exit-status-73-EXIT_SYSLOG_KERN_PRIORITY">Exit status 73 ($EXIT_SYSLOG_KERN_PRIORITY)</dt>
<dd>

<p>The kernel log priority could not be configured.</p>

</dd>
<dt id="Exit-status-74-EXIT_SYSLOG_MARK_VALUE">Exit status 74 ($EXIT_SYSLOG_MARK_VALUE)</dt>
<dd>

<p>The syslog mark value was out of range.</p>

</dd>
<dt id="Exit-status-75-EXIT_SYSLOG_MARK_PERIOD">Exit status 75 ($EXIT_SYSLOG_MARK_PERIOD)</dt>
<dd>

<p>The syslog mark period could not be configured.</p>

</dd>
<dt id="Exit-status-76-EXIT_SYSLOG_KERN_TARGET_VALUE">Exit status 76 ($EXIT_SYSLOG_KERN_TARGET_VALUE)</dt>
<dd>

<p>The syslog kernel message target was the empty string.</p>

</dd>
<dt id="Exit-status-77-EXIT_SYSLOG_KERN_TARGET">Exit status 77 ($EXIT_SYSLOG_KERN_TARGET)</dt>
<dd>

<p>The syslog kernel message tarkget could not be configured.</p>

</dd>
<dt id="Exit-status-78-EXIT_SYSLOG_RESTART">Exit status 78 ($EXIT_SYSLOG_RESTART)</dt>
<dd>

<p>The syslog system service could not be restarted.</p>

</dd>
<dt id="Exit-status-79-EXIT_GRUB2_CONFIGURE">Exit status 79 ($EXIT_GRUB2_CONFIGURE)</dt>
<dd>

<p>There was an error rewriting the GRUB2 config file.</p>

</dd>
<dt id="Exit-status-80-EXIT_GRUB2_CONF_MISSING">Exit status 80 ($EXIT_GRUB2_CONF_MISSING)</dt>
<dd>

<p>The grub2 config file is missing.</p>

</dd>
</dl>

<h1 id="SEE-ALSO13">SEE ALSO</h1>

<p>RTI Admin Guide</p>

<h1 id="POD-ERRORS">POD ERRORS</h1>

<p>Hey! <b>The above document had some coding errors, which are explained below:</b></p>

<dl>

<dt id="Around-line-12425">Around line 12425:</dt>
<dd>

<p>=back doesn&#39;t take any parameters, but you said =back 4</p>

</dd>
<dt id="Around-line-12474">Around line 12474:</dt>
<dd>

<p>=back doesn&#39;t take any parameters, but you said =back 4</p>

</dd>
<dt id="Around-line-12491">Around line 12491:</dt>
<dd>

<p>=back doesn&#39;t take any parameters, but you said =back 4</p>

</dd>
</dl>


</body>

</html>


