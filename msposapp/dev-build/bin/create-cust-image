#!/bin/bash

#echo -n "rhel or centos?: "
#read OS
OS=rhel
echo -n "SHOPCODE: "
read SHOPCODE
#OS=$1
CONTAINER=`docker run -d -it --name=$SHOPCODE.teleflora.com --rm --privileged -w="/usr/local/bin" -i ${OS}7-rti-16.1.3 /usr/sbin/init`

#save/export container
docker commit $CONTAINER $SHOPCODE.teleflora.com
#EXPORT CONTAINER to IMAGE before AWS import?
echo "$SHOPCODE.teleflora.com image ready!"

echo ""
echo ""
echo ""
docker exec $CONTAINER /usr/local/bin/bin/updateos.pl --version
#docker exec $CONTAINER cat /etc/redhat-release
CONTAINER_IP=`nmap -sS -p 22 172.17.0.1/24 | grep 172 | cut -d" " -f5 | sort | tail -1`
rm -f ~/.ssh/known_hosts
ssh tfsupport@$CONTAINER_IP
docker commit $CONTAINER $SHOPCODE.teleflora.com
exit 0
