#!/bin/bash

# TF POS rti yum repo file install.

# verify root
ID=`/usr/bin/id -u`
[ $ID -ne 0 ] && echo "You must be root to run $0." && exit 1

# disable subscription manager
sed -i '/enabled=1/enabled=0' /etc/yum/pluginconf.d/subscription-manager.conf
[ $? -ne 0 ] && echo "Could not disable subscription manager." && exit 2

# create rti repos file
cat > /etc/yum.repos.d/rtirepos.repo <<EOF
[RTIRepo]
name=RTIRepo
enabled=1
gpgcheck=1
baseurl=https://tfrhelrepo.centralus.cloudapp.azure.com/rhel-7-server-rpms/
EOF
[ $? -ne 0 ] && echo "Could not create rtirepo file." && exit 3

# update system
yum -y update
[ $? -ne 0 ] && echo "Could not install updates." && exit 4

exit 0
